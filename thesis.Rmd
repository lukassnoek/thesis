---
### Title page
title: "Towards prediction"
subtitle: Studying the mind and brain in the age of machine learning

author: "Lukas Snoek"
date: "maandag 21 oktober 2021"
aula: false 
time: "14.00"
birthplace: "Hoevelaken"

### Colophon 
# This paragraph begins with "This thesis was typeset using (R) Markdown, \LaTeX\ and the \verb+bookdown+ R-package"
# and is optionally followed by:
ISBN: "xxx-xx-xxxx-xxx-x"
printing: "Acme Press, Inc."
#cover: "Designed by Phil Henry Doctor" # optional, otherwise this bit is omitted
thesis_url: "https://lukas-snoek.com/thesis"
license: "CC BY" # optional, otherwise this bit is omitted

### Committee
promotores: 
- title: dr.
  initials: H.S.
  surname: Scholte
  affiliation: Universiteit van Amsterdam
one_promotor: true

copromotores:
- title: dr. 
  initials: S.
  surname: Oosterwijk
  affiliation: Universiteit van Amsterdam 
one_copromotor: true

members:
- title: prof. dr.
  initials: P.G.
  surname: Schyns
  affiliation: University of Glasgow
- title: prof. dr.
  initials: R.W.
  surname: Goebel
  affiliation: Maastricht University
- title: prof. dr.
  initials: B.U.
  surname: Forstmann
  affiliation: Universiteit van Amsterdam
- title: prof. dr.
  initials: A.H.
  surname: Fischer
  affiliation: Universiteit van Amsterdam
- title: prof. dr.
  initials: D.
  surname: Borsboom
  affiliation: Universiteit van Amsterdam
- title: prof. dr.
  initials: C.
  surname: Keysers
  affiliation: Universiteit van Amsterdam

faculty: Faculteit der Maatschappij- en Gedragswetenschappen

### Book settings
documentclass: memoir
book_size: true # "true" if you want to render a pdf for printing as a book; "false" if you want to print loose pages
           # if book_size is set to false, forces A4 paper size, and the "oneside" classoption
           # if book_size is set to true, forces standard "thesis B5 size" (170mm wide by 240mm high), and the "twoside" classoption
# geometry: "left=2.5cm, right=2.5cm, top=2.5cm, bottom=2.5cm" # use this if you want to change the margins
            # 2.5cm equal margins are often recommended by printers (so when book_size: true)
fontsize: 11pt # 12pt is recommened when book_size is false; 10 or 11pt is recommended when book_size is true
lang: en-US # default language for the thesis. Change to en-GB or en-US if you want a specific flavor of English (or to nl for Dutch)
site: bookdown::bookdown_site # to get a "Build" button in RStudio to render the book
output:
  # HTML
  bookdown::gitbook:
    css: css/style.css
    pandoc_args: [ "--csl", "bib/apa.csl" ]
    sharing:
      facebook: no
      github: yes
      twitter: yes
      all: ['facebook', 'twitter', 'linkedin']

    config:
      toc: 
        #this text will print on top ("before") or at the bottom ("after") of the table of contents
        before: | 
          <li><a href="./">PhD thesis of Lukas Snoek</a></li>
        after: |
          <li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
          
  # PDF through Latex
  bookdown::pdf_book: 
    template: template.tex
    keep_tex: yes
    pandoc_args: [ "--csl", "bib/apa.csl" ]
    latex_engine: xelatex  # for the fontspec package
    #citation_package: biblatex
    #includes:
    #  in_header: tex/preamble.tex

indent: false # indent new paragraphs, instead of leaving whitespace
links-as-notes: true # in the pdf, print hyperlink URLS as footnotes (as they can't be clicked on)
bibliography:
  - bib/introduction_discussion.bib
  - bib/misc.bib
  - bib/shared-states.bib
  - bib/confounds-decoding.bib
  - bib/aomic.bib
  - bib/morbid-curiosity.bib
  - bib/static-vs-dynamic.bib

citation_package: none
biblio-style: "apa"
citecolor: gray
link-citations: true # make clickable hyperlinks from in-text citations to bibliography at the end
---

```{r, include = FALSE, child = if (knitr::is_html_output()) '_00-preface.Rmd'}
```

<!--chapter:end:index.Rmd-->

---
nocite: | 
  @Newell1973-no
---

```{r setup-intro, include=FALSE}
library(tufte)
```

# Introduction

> "Science advances by playing twenty questions with nature.
> The proper tactic is to frame a general question, hopefully binary, 
> that can be attacked experimentally. Having settled that bits-worth, 
> one can proceed to the next. The policy appears optimal – one never risks much, 
> there is feedback from  nature at every step, and progress is inevitable. 
> Unfortunately, the questions never seem to be really answered, 
> the strategy does not seem to work."
> 
> `r tufte::quote_footer('--- Allen Newell (1973)')`

Almost fifty years ago, the artificial intelligence pioneer and cognitive psychologist Allen Newell summarized his discontent with the field of psychology with the sentence “you cannot play twenty questions with nature and win”. In a game of “twenty questions”, one player thinks of a person or object and the other player attempts to guess it by asking up to twenty questions, such as “is it a person?”, “is he a man?”. Only questions that require a binary (yes/no) answer are allowed. Newell argued that most (cognitive) psychology research attempts to understand human behavior and cognition in a manner analogous to a game of twenty questions; that is, by repeatedly asking and trying to answer “binary” research questions — such as “Does cognition impact perception?” and “Are emotional facial expressions innate?” — researchers attempt to gradually explore and reduce the space of possible scientific explanations in the hope to, ultimately, converge on the “the right answer”. Almost fifty years after Newell’s twenty questions article, most of the research in both psychology and cognitive neuroscience still revolves around asking binary research questions about the mind and brain, framed as hypotheses that are evaluated using an ever increasingly sophisticated toolbox of statistical significance tests. Newell, however, believed that in order to gain a fundamental understanding of how the mind and brain work, we need to go beyond asking binary questions and try to investigate human behavior and cognition in all its complexity using quantitative, predictive models that implement human cognitive capacities and behaviors. I believe that this argument is still as relevant today as it was almost fifty years ago.

In this thesis, I explore a different, complementary approach to the traditional methodology of hypothesis testing used in psychology and cognitive neuroscience research. Although this alternative approach has deep roots in psychology and is thus by no means new, the version I advocate and have used in this thesis extends it with ideas and techniques from the rapidly growing field of artificial intelligence and specifically machine learning. As I will describe in more detail in the next section, the crucial difference between the “hypothesis testing approach” and the “predictive approach”, as advocated by Newell, is the way they go about trying to explain and understand a particular cognitive capacity or behavior [@Breiman2001-lf]. Although I believe that both approaches have their merits, I think that the predictive approach may be particularly promising given the increasing availability of large datasets and rapid advances in artificial intelligence and machine learning [@Halevy2009-cv; @Yarkoni2017-om].

This thesis features research that applies, adapts, and contributes to machine learning techniques and methods in the context of predictive models of behavior and neuroimaging data. Specifically, chapters in this thesis describe both examples of predictive models applied to neuroimaging data (chapter \@ref(shared-states)) and behavior (chapter \@ref(hypothesis-kernel-analysis) and \@ref(static-vs-dynamic) as well as elements that facilitate and enrich the predictive modelling framework, such as the value of making datasets publicly accessible [chapter \@ref(aomic); @Adjerid2018-vs; @Poldrack2014-ov], and a method to aid interpretation of predictive models (chapter \@ref(confounds-decoding)). Note that the studies contained in this thesis do not all fall squarely in the predictive approach. For example, chapter \@ref(morbid-curiosity) features a study that revolved around a confirmatory (and preregistered) hypothesis and chapter \@ref(shared-states) describes a study that in fact tests a very specific hypothesis using a predictive model. In what follows, I will argue that the predictive approach represents a useful and promising way of doing research that complements the traditional hypothesis testing approach with respect to their common goal of explanation and gaining understanding of the brain and mind. But first, I will illustrate that these two approaches can be thought of as different inferences from the same model which helps to identify their relative (dis)advantages later.

## Inference done differently


<!--chapter:end:01-introduction.Rmd-->

# Shared states: using MVPA to test neural overlap between self-focused emotion imagery and other-focused emotion understanding {#shared-states}
\chaptermark{Shared states}

\vspace*{\fill}

---

```{r setup-chapter-02, include=FALSE}
knitr::opts_chunk$set(results = 'hide', echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(kableExtra)
```

\small
\noindent
_This chapter has been published as_: Oosterwijk, S.\*, Snoek, L.\*, Rotteveel, M., Barrett, L. F., & Scholte, H. S. (2017). Shared states: using MVPA to test neural overlap between self-focused emotion imagery and other-focused emotion understanding. *Social cognitive and affective neuroscience, 12*(7), 1025-1035.

\* Shared first authorship
\newpage
\normalsize

`<p><strong>Abstract</strong></p>`{=html}
`\begin{abstract}`{=latex}
The present study tested whether the neural patterns that support imagining "performing an action", "feeling a bodily sensation" or "being in a situation" are directly involved in understanding *other people’s* actions, bodily sensations and situations. Subjects imagined the content of short sentences describing emotional actions, interoceptive sensations and situations (self-focused task), and processed scenes and focused on *how* the target person was expressing an emotion, *what* this person was feeling, and *why* this person was feeling an emotion (other-focused task). Using a linear support vector machine classifier on brain-wide multi-voxel patterns, we accurately decoded each individual class in the self-focused task. When generalizing the classifier from the self-focused task to the other-focused task, we also accurately decoded whether subjects focused on the emotional actions, interoceptive sensations and situations of *others*. These results show that the neural patterns that underlie self-imagined experience are involved in understanding the experience of other people. This supports the theoretical assumption that the basic components of emotion experience and understanding share resources in the brain.
`\end{abstract} \newpage`{=latex}

## Introduction {#shared-states-introduction}

To navigate the social world successfully it is crucial to understand other people. But how do people generate meaningful representations of other people’s actions, sensations, thoughts and emotions? The dominant view assumes that representations of other people’s experiences are supported by the same neural systems as those that are involved in generating experience in the self [e.g., @gallese2004unifying; see for an overview @singer2012past]. We tested this principle of self-other neural overlap directly, using multi-voxel pattern analysis (MVPA), across three different aspects of experience that are central to emotions: actions, sensations from the body and situational knowledge.

In recent years, evidence has accumulated that suggests a similarity between the neural patterns representing the self and others. For example, a great variety of studies have shown that observing actions and sensations in other people engages similar neural circuits as acting and feeling in the self [see for an overview @bastiaansen2009evidence]. Moreover, an extensive research program on pain has demonstrated an overlap between the experience of physical pain and the observation of pain in other people, utilizing both neuroimaging techniques [e.g., @lamm2011meta] and analgesic interventions [e.g., @rutgen2015placebo; @mischkowski2016painkiller]. This process of "vicarious experience" or "simulation" is viewed as an important component of empathy [@carr2003neural; @decety2011dissecting; @keysers2014dissociating]. In addition, it is argued that mentalizing (e.g. understanding the mental states of other people) involves the same brain networks as those involved in self-generated thoughts [@uddin2007self; @waytz2011two]. Specifying this idea further, a constructionist view on emotion proposes that both emotion experience and interpersonal emotion understanding are produced by the same large-scale distributed brain networks that support the processing of sensorimotor, interoceptive and situationally relevant information [@barrett2013large; @oosterwijk2014embodiment]. An implication of these views is that the representation of self- and other-focused emotional actions, interoceptive sensations and situations overlap in the brain.

Although there is experimental and theoretical support for the idea of self-other neural overlap, the present study is the first to directly test this process using MVPA across three different aspects of experience (i.e. actions, interoceptive sensations and situational knowledge). Our experimental design consisted of two different tasks aimed at generating self- and other-focused representations with a relatively large weight given to either action information, interoceptive information or situational information.

In the *self-focused* emotion imagery task (SF-task) subjects imagined performing or experiencing actions (e.g., *pushing someone away*), interoceptive sensations (e.g., *increased heart rate*) and situations (e.g., *alone in a park at night*) associated with emotion. Previous research has demonstrated that processing linguistic descriptions of (emotional) actions and feeling states can result in neural patterns of activation associated with, respectively, the representation and generation of actions and internal states [@pulvermuller2010active; @oosterwijk2015concepts]. Furthermore, imagery-based inductions of emotion have been successfully used in the MRI scanner before [@wilson2011grounding; @oosterwijk2012states], and are seen as robust inducers of emotional experience [@lench2011discrete]. In the *other-focused* emotion understanding task (OF-task), subjects viewed images of people in emotional situations and focused on actions (i.e., *How* does this person express his/her emotions?), interoceptive sensations (i.e., *What* does this person feel in his/her body) or the situation (i.e., *Why* does this person feel an emotion?). This task is based on previous research studying the neural basis of emotion oriented mentalizing [@spunt2012integrative].

With MVPA, we examined to what extent the SF- and OF-task evoked similar neural patterns. MVPA allows researchers to assess whether the neural pattern associated with one set of experimental conditions can be used to distinguish between another set of experimental conditions. This relatively novel technique has been successfully applied to the field of social neuroscience in general [e.g., @gilbert2012evaluative; @brosch2013implicit; @parkinson2014common], and the field of self-other neural overlap in particular. For example, several MVPA studies recently assessed whether experiencing pain and observing pain in others involved similar neural patterns [@corradi2016cross; @krishnan2016somatic]. Although there is an ongoing discussion about the specifics of shared representation in pain based on these MVPA results [see for an overview  @zaki2016anatomy], many authors emphasize the importance of this technique in the scientific study of self-other neural overlap [e.g., @corradi2016cross; @krishnan2016somatic].

MVPA is an analysis technique that decodes latent categories from fMRI data in terms of multi-voxel patterns of activity [@norman2006beyond]. This technique is particularly suited for our research question for several reasons. First of all, although univariate techniques can demonstrate that tasks activate the same brain regions, only MVPA can statistically test for shared representation [@lamm2015role]. We will evaluate whether multivariate brain patterns that distinguish between mental events in the SF-task can be used to distinguish, above chance level, between mental events in the OF-task. Second, MVPA analyses are particularly useful in research that is aimed at examining distributed representations [@singer2012past]. Based on our constructionist framework, we indeed hypothesize that the neural patterns that will represent self- and other focused mental events are distributed across large-scale brain networks. To capture these distributed patterns, we used MVPA in combination with data-driven univariate feature selection on whole-brain voxel patterns, instead of limiting our analysis to specific regions-of-interest [@haynes2015primer]. And third, in contrast to univariate analyses that aggregate data across subjects, MVPA can be performed within-subjects and is thus able to incorporate individual variation in the representational content of multivariate brain patterns. In that aspect within-subject MVPA is sensitive to individual differences in how people imagine actions, sensations and situations, and how they understand others. In short, for our purpose to explicitly test the assumption that self and other focused processes share neural resources, MVPA is the designated method.

We tested the following two hypotheses. First, we tested whether we could classify *self-imagined* actions, interoceptive sensations and situations above chance level. Second, we tested whether the multivariate pattern underlying this classification could also be used to classify the how, what and why condition in the *other-focused* task.

## Methods {#shared-states-methods}

### Subjects {#shared-states-methods-subjects}

In total, we tested 22 Dutch undergraduate students from the University of Amsterdam (14 females; M~age~ = 21.48, s.d.~age~ = 1.75). Of those 22 subjects, 13 subjects were tested twice in 2 sessions about 1 week apart. Half of those sessions were used for the model optimization procedure. The other half of the sessions, combined with an additional nine subjects (who were tested only once), constituted the model validation set (see Model optimization procedure section). In total, two subjects were excluded from the model validation dataset: one subject was excluded because there was not enough time to complete the experimental protocol and another subject was excluded due to excessive movement (>3 mm within data acquisition runs).

All subjects signed informed consent prior to the experiment. The experiment was approved by the University of Amsterdam’s ethical review board. Subjects received 22.50 euro per session. Standard exclusion criteria regarding MRI safety were applied and people who were on psychopharmacological medication were excluded a priori.

### Experimental design {#shared-states-methods-experimental-design}

#### Self-focused emotion imagery task {#shared-states-methods-experimental-design-sf-task}

The self-focused emotion imagery task (SF-task) was created to preferentially elicit *self-focused* processing of action, interoceptive or situational information associated with emotion. Subjects processed short linguistic cues that described actions (e.g., *pushing someone away*; *making a fist*), interoceptive sensations (e.g., *being out of breath*; *an increased heart rate*), or situations (e.g., *alone in a park at night*; *being falsely accused*) and were instructed to imagine performing or experiencing the content. The complete instruction is presented in the Supplementary Materials; all stimuli used in the SF-task are presented in Supplementary Table \@ref(tab:tab-shared-states-S1). Linguistic cues were selected from a pilot study performed on an independent sample of subjects (*n* = 24). Details about this pilot study are available on request. The descriptions generated in this pilot study were used as qualitative input to create short sentences that described actions, sensations or situations that were associated with negative emotions, without including discrete emotion terms. The cues did not differ in number of words, nor in number of characters (*F* < 1).

The SF-task was performed in two runs subsequent to the other-focused task using the software package Presentation (Version 16.4, [www.neurobs.com](www.neurobs.com)). Each run presented 60 sentences on a black background (20 per condition) in a fully randomized event-related fashion, with a different randomization for each subject. Note that implementing a separate randomization for each subject prevents inflated false positive pattern correlations between trials of the same condition, which may occur in single-trial designs with short inter-stimulus intervals [@mumford2014impact]. A fixed inter-trial–interval of 2 seconds separating trials; 12 null-trials (i.e. a black screen for 8 seconds) were mixed with the experimental trials at random positions during each run (see Figure \@ref(fig:fig-shared-states-1)).

```{r fig-shared-states-1, fig.cap='Overview of the self-focused and other-focused task.', results='show'}
knitr::include_graphics("_bookdown_files/shared-states-files/figures/figure_1.png", auto_pdf = TRUE)
```

#### Other-focused emotion understanding task {#shared-states-methods-experimental-design-of-task}

The other-focused emotion understanding task (OF-task) was created to preferentially elicit *other-focused* processing of action, interoceptive or situational information associated with emotion. Subjects viewed images of people in negative situations (e.g. a woman screaming at a man, a man held at gunpoint). A red rectangle highlighted the face of the person that the subjects should focus on to avoid ambiguity in images depicting more than one person. Image blocks were preceded by a cue indicating the strategy subjects should use in perceiving the emotional state of the people in the images [@spunt2012integrative]. The cue *How* instructed the subjects to identify actions that were informative about the person’s emotional state (i.e., *How* does this person express his/her emotions?). The cue *What* instructed subjects to identify interoceptive sensations that the person could experience (i.e., *What* does this person feel in his/her body). The cue *Why* instructed subjects to identify reasons or explanations for the person’s emotional state (i.e., *Why* does this person feel an emotion?). The complete instruction is presented in the [Supplementary Materials](#shared-states-supplement).

Stimuli for the OF-task were selected from the International Affective Picture System database [IAPS; @lang2005international; @lang1997international], the image set developed by the Kveraga lab [[http://www.kveragalab.org/stimuli.html](http://www.kveragalab.org/stimuli.html); @kveraga2015if] and the internet (Google images). We selected images based on a pilot study, performed on an independent sample of subjects (*n* = 22). Details about this pilot study are available on request.

The OF-task was presented using the software package Presentation. The task presented thirty images on a black background in blocked fashion, with each block starting with a what, why or how cue (see Figure \@ref(fig:fig-shared-states-1)). Each image was shown three times, once for each cue type. Images were presented in blocks of six, each lasting 6 seconds, followed by a fixed inter trial interval of 2 seconds. Null-trials were inserted at random positions within the blocks. Both the order of the blocks and the specific stimuli within and across blocks were fully randomized, with a different randomization for each subject.

### Procedure {#shared-states-methods-procedure}

Each experimental session lasted about 2 hours. Subjects who underwent two sessions had them on different days within a time span of 1 week. On arrival, subjects gave informed consent and received thorough task instructions, including practice trials (see the [Supplementary Materials](#shared-states-supplement) for a translation of the task instructions). The actual time in the scanner was 55 minutes, and included a rough 3D scout image, shimming sequence, 3-min structural T1-weighted scan, one functional run for the OF-task and two functional runs for the SF-task. We deliberately chose to present the SF-task after the OF-task to exclude the possibility that the SF-task affected the OF-task, thereby influencing the success of the decoding procedure.

After each scanning session, subjects rated their success rate for the SF-task and OF-task (see Supplementary Figure \@ref(fig:fig-shared-states-S1)). In the second session, subjects filled out three personality questionnaires that will not be further discussed in this paper and were debriefed about the purpose of the study.

### Image acquisition {#shared-states-methods-image-acquisition}

Subjects were tested using a Philips Achieva 3T MRI scanner and a 32-channel SENSE headcoil. A survey scan was made for spatial planning of the subsequent scans. Following the survey scan, a 3-min structural T1-weighted scan was acquired using 3D fast field echo (TR: 82 ms, TE: 38 ms, flip angle: 8°, FOV: 240 × 188 mm, 220 slices acquired using single-shot ascending slice order and a voxel size of 1.0 × 1.0 × 1.0 mm). After the T1-weighted scan, functional T2*-weighted sequences were acquired using single shot gradient echo, echo planar imaging (TR = 2000 ms, TE = 27.63 ms, flip angle: 76.1°, FOV: 240 × 240 mm, in-plane resolution 64 × 64, 37 slices (with ascending acquisition), slice thickness 3 mm, slice gap 0.3 mm, voxel size 3 × 3 × 3 mm), covering the entire brain. For the SF-task, 301 volumes were acquired; for the OF-task 523 volumes were acquired.

## Model optimization procedure {#shared-states-methods-model-optimization-procedure}

As MVPA is a fairly novel technique, no consistent, optimal MVPA pipeline has been established [@etzel2011impact]. Therefore, we adopted a validation strategy in the present study that is advised in the pattern classification field [@kay2008identifying; @kriegeskorte2009circular]. This strategy entailed that we separated our data into an optimization dataset to find the most optimal parameters for preprocessing and analysis, and a validation dataset to independently verify classification success with those optimal parameters. We generated an optimization and validation dataset by running the SF-task and OF-task twice, in two identical experimental sessions for a set of thirteen subjects. The sessions were equally split between the optimization and validation set (see Figure 2A); first and second sessions were counterbalanced between the two sets. Based on a request received during the review process, we added nine new subjects to the validation dataset. Ultimately, the optimization-set held 13 sessions and the validation-set, after exclusion of 2 subjects (see Subjects section), held 20 sessions.

```{r fig-shared-states-2, fig.cap='(ref:caption-fig-shared-states-2)', results='show'}
knitr::include_graphics("_bookdown_files/shared-states-files/figures/figure_2.png", auto_pdf = TRUE)
```

(ref:caption-fig-shared-states-2) Schematic overview of the cross-validation procedures. **A**) The partitioning of the dataset into an optimization-set (used for tuning of preprocessing and MVPA hyperparameters) and a validation-set (used to get a fully cross-validated, unbiased estimate of classification performance). The preprocessing and MVPA hyperparameters yielded from the optimization procedure were subsequently applied to the preprocessing and MVPA pipeline of the validation-set. **B**) The within-subject MVPA pipeline of the self- and cross-analysis implemented in a repeated random subsampling scheme with 100,000 iterations. In each iteration, 90% of the self-data trials (i.e. train-set) were used for estimating the scaling parameters, performing feature selection and fitting the SVM. These steps of the pipeline (i.e. scaling, feature selection, SVM fitting) were subsequently applied to the independent test-set of both the self-data trials and the other-data trials.

In the optimization-set, we explored how different preprocessing options and the so-called ‘hyperparameters’ in the MVPA pipeline affected the performance of the (multivariate) analyses (visualized in Figure \@ref(fig:fig-shared-states-2)B; see [MVPA pipeline] subsection for more details). Thus, we performed the self- and cross-analyses *on the data of the optimization set* multiple times with different preprocessing options (i.e., smoothing kernel, low-pass filter and ICA-based denoising strategies) and MVPA hyperparameter values (i.e., univariate feature selection *threshold* and train/test size ratio during cross-validation). We determined the optimal parameters on the basis of classification performance, which was operationalized as the mean precision value after a repeated random subsampling procedure with 1000 iterations. A list with the results from the optimization procedure can be found in Supplementary Table \@ref(tab:tab-shared-states-S2) and Supplementary Figure \@ref(fig:fig-shared-states-S2). The optimal parameters were then used for preprocessing and the self- and cross-analysis within the validation-set, in which the findings from the optimization-set were replicated. All findings discussed in the \@ref(shared-states-results) section follow from the validation-set (see Supplementary Figure \@ref(fig:fig-shared-states-S3) for an overview of the findings from the optimization-set).

### Preprocessing and single-trial modeling {#shared-states-methods-preprocessing}

Functional and structural data were preprocessed and analyzed using FSL 5.0 [@jenkinson2012fsl] and MATLAB (2012b; [www.mathworks.com/products/matlab](www.mathworks.com/products/matlab)), using an in-house developed preprocessing pipeline and the parameters established in the optimization procedure. Functional data were corrected for motion (using FSL MCFLIRT) and slice timing and was spatially smoothed (5 mm isotropic kernel). After preprocessing, individual time series were modeled using a double-gamma hemodynamic response function in a single-trial GLM design using FSL’s FEAT. Resulting beta values were converted to *t*-values [@misaki2010comparison], constituting a whole-brain pattern of *t*-values per trial. Subsequently, the data were indexed by a gray-matter mask (excluding most white-matter, CSF and brainstem voxels). Thus, the data points for the MVPA consist of whole-brain (gray matter) *t*-value patterns per trial. For the optimization analyses, the data were transformed to standard space (MNI152, 2 mm) using FSL’s FNIRT. To reduce computation time for the validation data, and in particular its corresponding permutation analysis, analyses on the validation dataset were performed on data in native (functional) space.

### Multi-voxel pattern analysis {#shared-states-methods-mvpa}

#### MVPA pipeline {#shared-states-methods-mvpa-pipeline}

Within the optimization and validation dataset, we implemented an iterated cross-validation scheme that separated the data into a train-set and a test-set (this procedure is described in more detail in the next section). Before fitting the classifier on the train-set in each iteration of the cross-validation scheme, standardization and voxel selection were estimated and applied to the train-set. Standardization ensured that each feature (i.e., voxel) had zero mean and unit variance across trials. After standardization, voxel selection was performed in each iteration on the train-set by extracting the voxels with the highest average pairwise Euclidian distance across classes, which will be subsequently referred to as a voxel's differentiation score. More specifically, differentiation scores were calculated by subtracting the mean value across trials per class from each other (i.e., action—interoception, action—situation, interoception—situation), normalizing these values across voxels (yielding "z-scores"), and taking their absolute value. The three resulting values per voxel were averaged and the most differentiating voxels (z-score threshold: 2.3, as determined by the optimization procedure; see [Model optimization procedure](#shared-states-methods-model-optimization-procedure) section) were extracted and used as features when fitting the classifier. Importantly, the standardization parameters (voxel mean and variance) and voxel indices (i.e. which voxels had differentiation scores above threshold) were estimated from the train-set only and subsequently applied to the test-set to ensure independence between the train- and test-set (see Figure 2B). After standardization and voxel selection in each iteration, a support vector classifier (SVC) was fit on the train-set and cross-validated on the test-set, generating a class probability for each trial in the test-set. Our classifier of choice was the SVC implementation from the scikit-learn `svm` module [@pedregosa2011scikit] with a linear kernel, fixed regularization parameter (*C*) of 1.0, one-vs-one multiclass strategy, estimation of class probability output (instead of discrete class prediction) and otherwise default parameters.

#### Cross-validation scheme and bagging procedure {#shared-states-methods-mvpa-cv-and-bagging}

Cross-validation of the classification analysis was implemented using a repeated random subsampling cross-validation scheme (also known as Monte Carlo cross-validation), meaning that, for each iteration of the analysis, the classification pipeline (i.e., standardization, voxel selection and SVM fitting) was applied on a random subset of data points (i.e., the train-set) and cross-validated on the remaining data (i.e., the test-set). Each trial belonged to one out of three classes: action, interoception or situation. Following the results from the parameter optimization process, we selected four trials per class for testing, amounting to 12 test-trials per iteration.

Per iteration, the classifier was fit on the train-set from the SF-data. Subsequently, this classifier was cross-validated on 12 test SF-trials (test-set "self-analysis") and 12 test OF-trials (test-set "cross-analysis"; see Figure 2B). This process was subsequently iterated 100 000 times to generate a set of class distributions for each trial. After all iterations, the final predicted class of each trial was determined by its highest summed class probability across iterations (also known as "soft voting"; see Supplementary Figure \@ref(fig:fig-shared-states-S4)). This strategy of a random sub-sampling cross-validation scheme in combination with majority (soft) voting is more commonly known as "bagging" [@breiman1996bagging]. An important advantage of bagging is that it reduces model overfitting by averaging over an ensemble of models, which is especially useful for multi-voxel pattern analyses because fMRI data is known to display high variance [@varoquaux2018cross].

After generating a final prediction for all trials using the soft voting method, we constructed confusion matrices for both the self- and cross-analysis. In each raw confusion matrix with prediction counts per class, cells were normalized by dividing prediction counts by the sum over rows (i.e., the total amount of predictions per class), yielding precision-scores (also known as positive predictive value). In other words, this metric represents the ratio of true positives to the sum of true positives and false positives (see Supplementary Figure \@ref(fig:fig-shared-states-S5) for a description of the results expressed as *recall* estimates, or the ratio of true positives to the total number of samples in that class). This classification pipeline generated subject-specific confusion matrices that were subsequently averaged to generate the final classification scores.

#### Statistical evaluation {#shared-states-methods-mvpa-statistical-evaluation}

To evaluate the statistical significance of the observed average precision-scores in the confusion matrices, we permuted the original self- and cross-analysis 1300 times per subject with randomly shuffled class labels, yielding 1300 confusion matrices (with precision-scores). We then averaged the confusion matrices across subjects, yielding 1300 permuted confusion matrices reflecting the null-distribution of each cell of the matrix (which is centered around chance level classification, i.e., 33%). For each cell in the diagonal of the observed confusion matrix, *p*-values were calculated as the proportion of instances of values in the permuted matrix which were higher than the values in the observed matrix [@nichols2002nonparametric]. To correct for multiple comparisons, *p*-values were tested against a Bonferroni-corrected threshold. The distribution of precision-scores and the relationship between precision-scores in the self- and cross-analysis is reported in Supplementary Figure \@ref(fig:fig-shared-states-S6).

#### Spatial representation {#shared-states-methods-mvpa-spatial-representation}

To visualize the classifier feature weights, we plotted the absolute feature weights averaged over iterations, subjects and pairwise classifiers (action *vs* interoception, action *vs* situation, interoception *vs* situation) that underlie our multiclass classification analysis. We chose to visualize the spatial representation of our model by plotting the average absolute feature weights, because the absolute value of feature weights in linear SVMs can be interpreted as how important the weights are in constructing the model's decision hyperplane [@guyon2002gene; @ethofer2009decoding; @stelzer2014prioritizing]. To correct for a positive bias in plotting absolute weights, we ran the main classification analysis again with permuted labels to extract the average absolute feature weights that one would expect by chance. Subsequently, a voxel-wise independent *t*-test was performed for all feature weights across subjects, using the average permuted feature weights as the null-hypothesis, yielding an interpretable *t*-value map (see the supplementary code notebook on our Github repository for computational details).

### Additional analyses {#shared-states-methods-additional-analyses}

In addition to the self-analysis and the self-to-other cross-analysis presented in the main text, we also performed a within-subjects other-to-self cross-analysis [see for a similar approach @corradi2016cross] and a between-subjects self-analysis and self-to-other cross-analysis. These analyses forward largely similar results as the analyses presented in the main text. Due to space constraints, we present these additional analyses in the [Supplementary Materials](#shared-states-supplement). Supplementary Figure \@ref(fig:fig-shared-states-S7) represents confusion matrices with precision and recall estimates for the other-to-self cross-analysis. Supplementary Figure \@ref(fig:fig-shared-states-S8) presents the results of MVPA analyses using condition-average voxel patterns across subjects instead of single-trial patterns within subjects.

### Univariate analysis {#shared-states-methods-univariate-analysis}

To be complete, we also report a set of univariate analyses performed on the SF-task and the OF-task data. The univariate analyses were performed on the validation dataset, and were subject to the same preprocessing steps as the MVPA analysis, except that we did not model each trial, but each condition as a separate regressor. The group-level analysis was performed with FSL's FLAME1 option. To examine differences in neural activity between conditions, we calculated contrasts between the three classes in the SF-task (self-action *vs* self-interoception; self-action *vs* self-situation and self-interoception *vs* self-situation) and the three classes in the OF-task (other-action *vs* other-interoception; other-action *vs* other-situation and other-interoception *vs* other-situation). We report clusters that were corrected using cluster-correction with a voxel-wise threshold of 0.005 (*z* = 2.7) and a cluster-wise *p*-value threshold of 0.05.

### Code availability {#shared-states-methods-code-availability}

The MVPA-analysis and subsequent (statistical) analyses were implemented using custom Python scripts, which depend heavily on the skbold package, a set of tools for machine learning analyses of fMRI data developed in-house (see [https://github.com/lukassnoek/skbold](https://github.com/lukassnoek/skbold)). The original scripts were documented and are hosted at the following Github repository: [https://github.com/lukassnoek/SharedStates](https://github.com/lukassnoek/SharedStates).

## Results {#shared-states-results}

### Multi-voxel pattern analysis {#shared-states-results-mvpa}

The analyses of the SF-task demonstrated that voxel patterns reflecting imagined self-focused actions, interoceptive sensations and situations associated with emotion could be decoded accurately for each individual class (all *p* < 0.001, see Figure \@ref(fig:fig-shared-states-3)). Furthermore, when we generalized the classifier based on the SF-task to the data from the OF-task (i.e. cross-analysis), we found that neural representations of emotional actions, interoceptive sensations and situations of others could also be reliably decoded above chance (all *p* < 0.001; see Figure \@ref(fig:fig-shared-states-3)). Supplementary Table \@ref(tab:tab-shared-states-S3) presents mean precision-scores across classes for each subject separately. As predicted, our findings demonstrate that *self-imagined* actions, interoceptive sensations and situations are associated with distinct neural patterns. Furthermore, and as predicted, our findings demonstrate that the patterns associated with self-imagined actions, sensations and situations can be used to decode *other-focused* actions, interoceptive sensations and situations (see Supplementary Figure \@ref(fig:fig-shared-states-S7) for the complementary other-to-self cross-analysis).

```{r fig-shared-states-3, fig.cap='(ref:caption-fig-shared-states-3)', results='show'}
knitr::include_graphics("_bookdown_files/shared-states-files/figures/figure_3.png", auto_pdf = TRUE)
```

(ref:caption-fig-shared-states-3) Confusion matrices for the self- (left diagram) and cross-analysis (right diagram). Values indicate precision-scores, representing the proportion of true positives given all predictions for a certain class. Note that action and interoception columns in the cross-analysis confusion matrix do not add up to 1, which is caused by the fact that, for some subjects, no trials were predicted as action or interoception, rendering the calculation of precision ill-defined (i.e., division by zero). In this case, precision scores were set to zero.

To visualize which neural regions were involved in the successful decoding of the three classes in the OF-task and SF-task, we display in Figure \@ref(fig:fig-shared-states-4) the averaged absolute values of the SVM feature weights. Note that Figure \@ref(fig:fig-shared-states-4) only displays one feature map, as both the self and cross-analysis depend on the same model. Regions displaying high and consistent feature weights across subjects were frontal pole (including parts of the dorsomedial prefrontal cortex and ventromedial prefrontal cortex), orbitofrontal cortex (OFC), inferior frontal gyrus (IFG), superior frontal gyrus (SFG), middle frontal gyrus (MFG), insular cortex, precentral gyrus, postcentral gyrus, posterior cingulate cortex/precuneus, superior parietal lobule (SPL), supramarginal gyrus (SMG), angular gyrus (AG), middle temporal gyrus (MTG), temporal pole (TP), lateral occipital cortex (lOC) and occipital pole (see Supplementary Table \@ref(tab:tab-shared-states-S4) for an overview of all involved regions).

```{r fig-shared-states-4, fig.cap='(ref:caption-fig-shared-states-4)', results='show'}
knitr::include_graphics("_bookdown_files/shared-states-files/figures/figure_4.png", auto_pdf = TRUE)
```

(ref:caption-fig-shared-states-4) Uncorrected *t*-value map of average feature weights across subjects; *t*-values were calculated by dividing the average absolute feature weights, which was corrected for positive bias by subtracting the mean permuted absolute weight across all iterations, by the standard error across subjects. Only voxels belonging to clusters of 20 or more voxels are shown.

### Univariate analyses {#shared-states-results-univariate}

Figure \@ref(fig:fig-shared-states-5) displays the pattern of neural activity revealed by univariate contrasts between the three different classes in the SF-task and the OF-task. For the sake of brevity, we summarize the most relevant univariate results here. Please see the [Supplementary Materials](#shared-states-supplement) and the study’s Github repository for an overview of all clusters.

```{r fig-shared-states-5, fig.cap='Univariate contrasts for the self-focused and other-focused task.', results='show'}
knitr::include_graphics("_bookdown_files/shared-states-files/figures/figure_5.png", auto_pdf = TRUE)
```

In the SF-task, action was associated with increased involvement of the MFG, SFG, AG, SMG, lOC and middle temporal gyrus (temporo-occipital) when compared with interoception, and increased involvement of the IFG, MFG, SFG, anterior cingulate cortex (ACC), supplementary motor area (SMA), precentral gyrus, postcentral gyrus, insular cortex, SMG, SPL, lOC and middle temporal gyrus (temporo-occipital) when compared with situation. Interoception was associated with increased involvement of the insular cortex, precentral gyrus, postcentral gyrus and central operculum when compared with action, and increased involvement of the insular cortex, central operculum, parietal operculum, IFG, frontal pole, ACC, SMA, precentral gyrus, postcentral gyrus, SMG, SPL and putamen when compared with situation. The situation *vs* action contrast and the situation *vs* interoception contrast forwarded clusters in similar regions, including the temporal pole, superior/middle temporal gyrus, IFG, SFG, frontal pole, medial prefrontal cortex (mPFC), OFC, precuneus, posterior cingulate cortex (PCC), lOC, fusiform gyrus, hippocampus and lingual gyrus.

In the OF-task, action was associated with increased involvement of the IFG, MFG, SFG, precentral gyrus, postcentral gyrus, SMG, SPL, middle/inferior temporal gyrus (temporo-occipital), lOC and fusiform gyrus, when compared with interoception, and increased involvement of the IFG, MFG, SFG, frontal pole, precentral gyrus, postcentral gyrus, SMG, SPL, middle/inferior temporal gyrus (temporo-occipital) and lOC, when compared with situation. Interoception was associated with increased involvement of the left frontal pole when compared with action, and increased involvement of the SMG, SPL, precentral gyrus, postcentral gyrus, PCC, IFG and frontal pole, when compared with situation. The situation *vs* action contrast and the situation *vs* interoception contrast forwarded clusters in similar regions, including the temporal pole, superior/middle temporal gyrus, frontal pole, mPFC, PCC, precuneus, AG, lOC, occipital pole, fusiform gyrus and lingual gyrus.

## Discussion {#shared-states-discussion}

In this study, we investigated the neural overlap between self-focused emotion imagery and other-focused emotion understanding using a decoding approach. The results confirmed our hypothesis that other-focused representations of emotion-related actions, bodily sensations and situations can be decoded from neural patterns associated with accessing similar sources of information in a self-focused task. This cross-classification was successful even though the tasks employed different stimulus materials and instructions. Thus, the observed neural overlap between the underlying processes in the SF-task and OF-task cannot be attributed to similarities in stimulus dimensions or task instructions. Rather, we conclude from our findings that emotion experience and emotion understanding have basic psychological processes in common.

Although we could successfully classify the interoception class in the SF-task (across both datasets), and in the OF-task in the validation dataset, we were not able to successfully classify the interoception class in the OF-task in the optimization dataset. Furthermore, although precision and recall metrics demonstrated similar results for the action and situation cross-classification in the validation dataset, these metrics demonstrated different results for the classification of the interoception class (see Supplementary Figure \@ref(fig:fig-shared-states-S5)). This difference was partly driven by the fact that trials were very infrequently classified as interoception in the cross-classification analysis. The finding that subjects reported lower success rates for the *what* trials in which they were asked to identify interoceptive sensations in other people than for the *how* (action) and *why* (situation) trials may point to a possible explanation for the inconsistent findings regarding interoception. Although speculative, it may be relatively easy to recognize (and represent) interoceptive sensations when they are described in words (as in the SF-task), but relatively hard to deduce these sensations when only diffuse cues about someone’s internal state are available (e.g. posture, frowning facial expression, as in the OF-task).

An exploration of the spatial characteristics of the distributed neural pattern associated with successful decoding of the SF-task and OF-task revealed regions that are commonly active during self- and other-focused processing. First, we found that successful classification was associated with voxels in the precentral gyrus, IFG, SMA and SPL. These same regions were also revealed by the univariate analyses, in particular for the action and interoception classes. These regions are part of the so-called "mirror" network, which is argued to support both action planning and action understanding [@gallese2004unifying; @bastiaansen2009evidence; @van2009understanding; @spunt2012integrative]. Furthermore, we found that successful classification was associated with voxels in the lateral occipital cortex and fusiform gyrus, which have been linked in the literature to the processing of both concrete and abstract action [@wurm2015decoding] and the (visual) processing of emotional scenes, faces and bodies [@de2010standing; @sabatinelli2011emotional]. The univariate analyses demonstrated activity in the lOC and the fusiform gyrus in particular for the situation class, both when subjects viewed images of other people in emotional situations, and when subjects imagined being in an emotional situation themselves.

Second, we found that successful classification was associated with voxels in regions associated with somatosensory processing (postcentral gyrus) and the representation of interoceptive sensations [insular cortex, see @craig2009you; @medford2010conjoint]. Univariate analyses of the SF-task also demonstrated involvement of these regions for both the action and interoception classes. This pattern of activation is consistent with embodied cognition views that propose that thinking about or imagining bodily states is grounded in simulations of somatosensory and interoceptive sensations [@barsalou2009simulation]. In contrast to previous work on interoceptive simulation when observing pain or disgust in other people [cf. @bastiaansen2009evidence; @lamm2011meta], the univariate analyses of the OF-task did not demonstrate insular cortex activation for the interoception class.

And third, we found that successful classification was associated with voxels in the middle temporal gyrus (including the temporal pole), PCC/precuneus, dmPFC and vmPFC. These regions are part of the so-called "mentalizing" network (or "default" network). This same network was also revealed by the univariate analyses, in particular for the situation class. Meta-analyses have demonstrated that the mentalizing network is commonly active during tasks involving emotion experience and perception [@lindquist2012brain], mentalizing/theory of mind [@spreng2009common; @van2009understanding], judgments about the self and others [@denny2012meta] and semantic/conceptual processing in general [@binder2009semantic]. Moreover, this network contributes to the representation of emotion knowledge [@peelen2010supramodal] and is involved in both empathy [@zaki2012neuroscience; @keysers2014dissociating] and self-generated thought [@andrews2014default]. We propose that this network supports the implementation of situated knowledge and personal experience that is necessary to generate rich mental models of emotional situations, both when experienced individually, and when understood in someone else [cf. @barrett2013large; @oosterwijk2014embodiment].

The most important contribution of our study is that it provides direct evidence for the idea of shared neural resources between self-and other focused processes. It is important, however, to specify what we think this "sharedness" entails. In research on pain, there is an ongoing discussion about whether experiencing pain and observing pain in others are distinct processes [@krishnan2016somatic], or whether experiencing and observing pain involve a shared domain-specific representation [e.g., a discrete pain-specific brain state; @corradi2016cross] and/or the sharing of domain-general processes [e.g. general negative affect; @zaki2016anatomy]. Connecting to this discussion, we think that it is unlikely that our decoding success reflects the sharing of discrete experiential states between the SF-task and OF-task. After all, unlike in studies on pain, the stimuli in our tasks referred to a large variety of different actions, sensations and situations. Instead, decoding success in our study is most likely due to shared brain state configurations, reflecting the similar engagement of domain-general processes evoked by self- and other-focused instances of action (or interoceptive sensation or situation). This interpretation is consistent with views that suggests that global processes are shared between pain experience and pain observation [@lamm2011meta; @zaki2016anatomy] or between self- and other-focused tasks in general [e.g., @legrand2009self]. Moreover, this interpretation is consistent with the suggestion that neural re-use is a general principle of brain functioning [e.g., @anderson2016precis].

In our constructionist view, we posit that emotion imagery and understanding share basic psychological processes [cf. @oosterwijk2014embodiment]. More specifically, both emotion imagery and understanding are "conceptual acts" in which the brain generates predictions based on concept knowledge (including sensorimotor and interoceptive predictions) that are meaningful within a particular situational context [@barrett2012emotions; @barrett2015interoceptive]. Based on accumulating evidence, we propose that these predictions are implemented in domain-general brain networks [cf. @oosterwijk2012states; @barrett2013large]. The relative contribution of these networks depends on the demands of the situational context. Specifically, in contexts where people are focused on actions and expressions (their own or someone else’s) a network that supports the representation of sensorimotor states (i.e., the mirror system) may contribute relatively heavily; in contexts where people are focused on bodily states (their own or someone else’s) a network that supports the representation of interoceptive states (i.e., the salience network) may contribute relatively heavily; and in contexts where people are focused on interpreting a situation (their own or someone else’s) a network that supports a general inferential meaning-making function (i.e., the mentalizing network) may contribute relatively heavily [see also @oosterwijk2015concepts]. We believe that it is likely that our ability to successfully distinguish between classes in the self-task relies on the relatively *different* patterns of activity across these networks for actions, interoceptive sensations and situations. Regarding our ability to successfully generalize from the self- to the other-focused task, we believe that this relies on the relatively *similar* pattern of activity across these networks when people generate self-focused or other-focused instances of action (or interoceptive sensation or situation).

Our explicit manipulation of the weight of action, interoceptive and situational information in the SF-task and the OF-task tests the possibility of shared representation in a novel way. Although this procedure may seem artificial, social neuroscience studies support the notion that there is contextual variety in the contribution of action, interoceptive, and situation information when understanding other people [@van2009understanding; @oosterwijk2015concepts]. Moreover, this weighting may mimic the variability with which these sources of information contribute to different instances of subjective emotional experience in reality [@barrett2012emotions]. In future directions, it may be relevant to apply the current paradigm to the study of individuals in which access to these sources of information is disturbed (e.g., individuals with different types of psychopathology) or facilitated (e.g., individuals with high interoceptive sensitivity).

In short, the present study demonstrates that the neural patterns that support imagining "performing an action", "feeling a bodily sensation" or "being in a situation" are directly involved in understanding other people’s actions, sensations and situations. This supports our prediction that self- and other-focused emotion processes share resources in the brain.

<!--chapter:end:02-shared-states.Rmd-->

---
nocite: | 
  @Diedrichsen2017-ab
---
```{r setup-confounds-decoding, include=FALSE}
knitr::opts_chunk$set(results = 'hide', echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(kableExtra)
```

# How to control for confounds in decoding analyses of neuroimaging data {#confounds-decoding}
\chaptermark{Confounds in decoding analyses}

\vspace*{\fill}

---

\small
\noindent
_This chapter has been published as_: Snoek, L.\*, Miletić, S.\*, & Scholte, H.S. (2019). How to control for confounds in decoding analyses of neuroimaging data. _NeuroImage_, 184, 741-760.

\* Shared first authorship

\newpage
\normalsize

`<p><strong>Abstract</strong></p>`{=html}
`\begin{abstract}`{=latex}
Over the past decade, multivariate "decoding analyses" have become a popular alternative to traditional mass-univariate analyses in neuroimaging research. However, a fundamental limitation of using decoding analyses is that it remains ambiguous which source of information drives decoding performance, which becomes problematic when the to-be-decoded variable is confounded by variables that are not of primary interest. In this study, we use a comprehensive set of simulations as well as analyses of empirical data to evaluate two methods that were previously proposed and used to control for confounding variables in decoding analyses: post hoc counterbalancing and confound regression. In our empirical analyses, we attempt to decode gender from structural MRI data while controlling for the confound "brain size". We show that both methods introduce strong biases in decoding performance: post hoc counterbalancing leads to better performance than expected (i.e., positive bias), which we show in our simulations is due to the subsampling process that tends to remove samples that are hard to classify or would be wrongly classified; confound regression, on the other hand, leads to worse performance than expected (i.e., negative bias), even resulting in significant below chance performance in some realistic scenarios. In our simulations, we show that below chance accuracy can be predicted by the variance of the distribution of correlations between the features and the target. Importantly, we show that this negative bias disappears in both the empirical analyses and simulations when the confound regression procedure is performed in every fold of the cross-validation routine, yielding plausible (above chance) model performance. We conclude that, from the various methods tested, cross-validated confound regression is the only method that appears to appropriately control for confounds which thus can be used to gain more insight into the exact source(s) of information driving one's decoding analysis.
`\end{abstract} \newpage`{=latex}

## Introduction {#confounds-decoding-introduction}

In the past decade, multivariate pattern analysis (MVPA) has emerged as a popular alternative to traditional univariate analyses of neuroimaging data [@Haxby2012-sd; @Norman2006-bt]. The defining feature of MVPA is that it considers patterns of brain activation instead of single units of activation (i.e., voxels in MRI, sensors in MEG/EEG). One of the most-often used type of MVPA is "decoding", in which machine learning algorithms are applied to neuroimaging data to predict a particular stimulus, task, or psychometric feature. For example, decoding analyses have been used to successfully predict various experimental conditions within subjects, such as object category from fMRI activity patterns [@Haxby2001-os] and working memory representations from EEG data [@LaRocque2013-sh], as well between-subject factors such as Alzheimer's disease (vs. healthy controls) from structural MRI data [@Cuingnet2011-hv] and major depressive disorder (vs. healthy controls) from resting-state functional connectivity [@Craddock2009-kz]. One reason for the popularity of MVPA, and especially decoding, is that these methods appear to be more sensitive than traditional mass-univariate methods in detecting effects of interest. This increased sensitivity is often attributed to the ability to pick up multidimensional, spatially distributed representations which univariate methods, by definition, cannot do [@Jimura2012-lv]. A second important reason to use decoding analyses is that they allow researchers to make predictions about samples beyond the original dataset, which is more difficult using traditional univariate analyses [@Hebart2017-jn].

In the past years, however, the use of MVPA has been criticized for a number of reasons, both statistical [@Allefeld2016-xp; @Davis2014-lw; @Gilron2017-tl; @Haufe2014-el] and more conceptual [@Naselaris2015-jn; @Weichwald2015-aj] in nature. For the purposes of the current study, we focus on the specific criticism put forward by @Naselaris2015-jn , who argue that decoding analyses are inherently ambiguous in terms of what information they use [see @popov2018practices for a similar argument in the context of encoding analyses]. This type of ambiguity arises when the classes of the to-be-decoded variable systematically vary in more than one source of information [see also @Carlson2015-bz; @Ritchie2017-gl; @Weichwald2015-aj]. The current study aims to investigate how decoding analyses can be made more interpretable by reducing this type of "source ambiguity".

To illustrate the problem of source ambiguity, consider, for example, the scenario in which a researcher wants to decode gender.^[The terms "gender" and "sex" are both used in the relevant research literature. Here, we use the term gender because we refer to self-reported identity in the data described below.] (male/female) from structural MRI with the aim of contributing to the understanding of gender differences --- an endeavor that generated considerable interest and controversy [@Chekroud2016-tc; @Del_Giudice2016-ns; @Glezerman2016-xl; @Joel2016-uo; @Rosenblatt2016-oy]. By performing a decoding analysis on the MRI data, the researcher hopes to capture meaningful patterns of variation in the data of male and female participants that are predictive of the participant's gender. The literature suggests that gender dimorphism in the brain is manifested in two major ways [@OBrien2011-lj; @Good2001-ak]. First, there is a *global* difference between male and female brains: men have on average about 15% larger intracranial volume than women, which falls in the range of mean gender differences in height (8.2%) and weight [18.7%; @Gur1999-qj; @Luders2002-ms].^[Note that information related to global brain size persists when researchers analyze the structural MRI data in a common, normalized brain space, because spatial registration "squeezes" relatively large brains into a smaller template, increasing voxel statistics (e.g., gray matter density in VBM analyses), and vice versa [@Douaud2007-sw]. This effect of global brain size similarly affects functional MRI analyses [@brodtmann2009regional].] Second, brains of men and women are known to differ *locally*: some specific brain areas are on average larger in women than in men [e.g., in superior and middle temporal cortex; @Good2001-ak] and vice versa [e.g., in frontomedial cortex; @Goldstein2001-dy]. One could argue that, given that one is interested in explaining behavioral or mental gender differences, global differences are relatively uninformative, as it reflects the fact than male *bodies* are on average larger than female bodies [@Gur1999-qj; @Sepehrband2018-dy]. As such, our hypothetical researcher is likely primarily interested in the *local* sources of variation in the neuroanatomy of male and female brains.

Now, supposing that the researcher is able to decode gender from the MRI data significantly above chance, it remains unclear on which source of information the decoder is capitalizing: the (arguably meaningful) local difference in brain structure or the (in the context of this question arguably uninteresting) global difference in brain size? In other words, the data contain more than one source of information that may be used to predict gender. In the current study, we aim to evaluate methods that improve the interpretability of decoding analyses by controlling for "uninteresting" sources of information.

### Partitioning effects into *true* signal and *confounded* signal {#confounds-decoding-introduction-true-vs-confounded}

Are multiple sources of information necessarily problematic? And what makes a source of information interesting or uninteresting? The answers to these questions depend on the particular goal of the researcher using the decoding analysis [@Hebart2017-jn]. In principle, multiple sources of information in the data do not pose a problem if a researcher is only interested in accurate *prediction*, but not in *interpretability* of the model [@Bzdok2017-li; @Haufe2014-el; @Hebart2017-jn]. In brain-computer interfaces (BCI), for example, accurate prediction is arguably more important than interpretability, i.e., knowing which sources of information are driving the decoder. Similarly, if the researcher from our gender decoding example is only interested in accurately predicting gender regardless of model interpretability, source ambiguity is not a problem.^[However, if accurate prediction is the only goal in this scenario, we would argue that there are probably easier and less expensive methods than neuroimaging to predict a participant's gender.] In most scientific applications of decoding analyses, however, model interpretability is important, because researchers are often interested in the relative contributions of different sources of information to decoding performance. Specifically, in most decoding analyses, researchers often (implicitly) assume that the decoder is *only* using information in the neuroimaging data that is related to the variable that is being decoded [@Ritchie2017-gl]. In this scenario, source ambiguity (i.e., the presence of *multiple* sources of information) *is* problematic as it violates this (implicit) assumption. Another way to conceptualize the problem of source ambiguity is that, using the aforementioned example, (global) brain size is *confounding* the decoding analysis of gender. Here, we define a confound as *a variable that is not of primary interest, correlates with the to-be-decoded variable (the target), and is encoded in the neuroimaging data.*

To illustrate the issue of confounding variables in the context of decoding clinical disorders, suppose one is interested in building a classifier that is able to predict whether subjects are suffering from schizophrenia or not based on the subjects’ gray matter data. Here, the variable "schizophrenia-or-not" is the variable of interest, which is assumed to be encoded in the neuroimaging data (i.e., the gray matter) and can thus be decoded. However, there are multiple factors known to covary with schizophrenia, such as gender [i.e., men are more often diagnosed with schizophrenia than women; @McGrath2008-oj] and substance abuse [@Dixon1999-kl], which are also known to affect gray matter [@Bangalore2008-kc; @Gur1999-qj; @Van_Haren2013-iv]. As such, the variables gender and substance abuse can be considered confounds according to our definition, because they are both correlated with the target (schizophrenia or not) and are known to be encoded in the neuroimaging data (i.e., the effect of these variables is present in the gray matter data). Now, if one is able to classify schizophrenia with above-chance accuracy from gray matter data, one cannot be sure which source of information within the data is picked up by the decoder: information (uniquely) associated with schizophrenia or (additionally) information associated with gender or substance abuse? If one is interested in more than mere accurate *prediction* of schizophrenia, then this ambiguity due to confounding sources of information is problematic.

Importantly, as our definition suggests, what *is* or *is not* regarded as a confound is relative --- it depends on whether the researchers deems it of (primary) interest or not. In the aforementioned hypothetical schizophrenia decoding study, for example, one may equally well define the severity of substance abuse as the to-be-decoded variable, in which the variable "schizophrenia-or-no"” becomes the confounding variable. In other words, one researcher's signal is another researcher's confound. Regardless, if decoding analyses of neuroimaging data are affected by confounds, the data thus contain two types of information: the "true signal" (i.e., variance in the neuroimaging data related to the target, but unrelated to the confound) and the "confounded signal" (i.e., variance in the neuroimaging data related to the target that is also related to the confound; see Figure \@ref(fig:fig-confounds-decoding-1)). In other words, source ambiguity arises due to the presence of both true signal and confounded signal and, thus, controlling for confounds (by removing the confounded signal) provides a crucial methodological step forward in improving the interpretability of decoding analyses.

```{r fig-confounds-decoding-1, fig.cap='(ref:caption-fig-confounds-decoding-1)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_1.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-1) Visualization of how variance in brain data ($X$) can partitioned into "True signal" and "Confounded signal", depending on the correlation structure between the brain data ($X$), the confound ($C$), and the target ($y$). Overlapping circles indicate a non-zero (squared) correlation between the two variables.

In the decoding literature, various methods have been applied to control for confounds. We next provide an overview of these methods, highlight their advantages and disadvantages, and discuss their rationale and the types of research settings they can be applied in. Subsequently, we focus on two of these methods to test whether these methods succeed in controlling for the influence of confounds.

### Methods for confound control {#confounds-decoding-introduction-methods}

In decoding analyses, one aims to predict a certain target variable from patterns of neuroimaging data. Various methods discussed in this section are supplemented with a mathematical formalization; for consistency and readability, we define the notation we will use in Table \@ref(tab:tab-confounds-decoding-1).

```{r tab-confounds-decoding-1, results='asis'}
data = read_csv('_bookdown_files/confounds-decoding-files/table_1_data.csv')
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T, escape = F, caption = 'Notation.') %>%
    kable_styling(full_width = T, font_size = 10) %>%
    column_spec(column = c(1, 2), width = "3em") %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F,
             general = 'Format based on Diedrichsen and Kriegeskorte (2017). For the correlations ($r$), we assume that $P = 1$ and thus that the correlations in the table reduce to a scalar.')
```

#### A priori counterbalancing {#confounds-decoding-introduction-methods-apriori-counterbalancing}

Ideally, one would prevent confounding variables from influencing the results as much as possible before the acquisition of the neuroimaging data.^[In the context of behavioral data, a priori counterbalancing is often called "matching" or a employing a "case-control design" @[Cook2002-hb].] One common way do this (in both traditional "activation-based" and decoding analyses) is to make sure that potential confounding variables are *counterbalanced* in the experimental design [@Gorgen2017-sy]. In experimental research, this would entail randomly assigning subjects to design cells (e.g., treatment groups) such that there is no structural correlation between characteristics of the subjects and design cells. In observational designs (e.g., in the gender/brain size example described earlier), it means that the sample is chosen such that there is no correlation between the confound (brain size) and *observed* target variable (gender). That is, given that men on average have larger brains than women, this would entail including only men with relatively small brains and women with relatively large brains.^[Note that the counterbalancing process is the same for both traditional univariate (activation-based) studies and decoding studies, but the direction of analysis is reversed in univariate (e.g., gender → brain) and decoding studies (e.g., brain → gender). As such, in univariate studies the confound (e.g., brain size) is counterbalanced with respect to the predictor(s) (e.g., gender) while in decoding studies the confound (e.g., brain size) is counterbalanced with respect to the target (e.g., gender).] The distinction between experimental and observational studies is important because the former allow the researcher to randomly draw samples from the population, while the latter require the researcher to choose a sample that is not representative of the population, which limits the conclusions that can be drawn about the population (we will revisit this issue in the [Discussion](#confounds-decoding-discussion) section).

Formally, in decoding analyses, a design is counterbalanced when the confound $C$ and the target $y$ are statistically independent. In practice, this often means that the sample is chosen so that there is no significant correlation coefficient between $C$ and $y$ (although this does not necessarily imply that $C$ and $y$ are actually independent). To illustrate the process of counterbalancing, let's consider another hypothetical experiment: suppose one wants to set up an fMRI experiment in which the goal is to decode abstract object category (e.g., faces vs. houses) from the corresponding fMRI patterns [cf. @Haxby2001-os], while controlling for the potential confounding influence of low-level or mid-level stimulus features, such as luminance, spatial frequency, or texture [@Long2017-fb]. Proper counterbalancing would entail making sure that the images used for this particular experiments have similar values for these low-level and mid-level features across object categories [see for details @Gorgen2017-sy]. Thus, in this example, low-level and mid-level stimulus features should be counterbalanced with respect to object category, such that above chance decoding of object category cannot be attributed to differences in low-level or mid-level stimulus features (i.e., the confounds).

A priori counterbalancing of potential confounds is, however, not always feasible. For one, the exact measurement of a potentially confounding variable may be impossible until data acquisition. For example, the brain size of a participant is only known after data collection. Similarly, @Todd2013-sd found that their decoding analysis of rule representations was confounded by response times of to the to-be-decoded trials. Another example of a "data-driven" confound is participant motion during data acquisition [important in, for example, decoding analyses applied to data from clinical populations such as ADHD; @Yu-Feng2007-sg]. In addition, a priori counterbalancing of confounds may be challenging because of the limited size of populations of interest. Especially in clinical research settings, researchers may not have the luxury of selecting a counterbalanced sample due to the small number of patient subjects available for testing. Lastly, researchers may simply discover confounds after data acquisition.

Given that a priori counterbalancing is not possible or undesirable in many situations, it is paramount to explore the possibilities of controlling for confounding variables after data acquisition for the sake of model interpretability, which we discuss next.

#### Include confounds in the data {#confounds-decoding-introduction-methods-include-in-data}

One perhaps intuitive method to control for confounds in decoding analyses is to include the confound(s) in the data [i.e., the neuroimaging data, $X$; see, e.g., @Sepehrband2018-dy] used by decoding model. That is, when applying a decoding analysis to neuroimaging data, the confound is added to the data as if it were another voxel (or sensor, in electrophysiology). This intuition may stem from the analogous situation in univariate (activation-based) analyses of neuroimaging data, in which confounding variables are controlled for by including them in the design matrix together with the stimulus/task regressors. For example, in univariate analyses of functional MRI, movement of the participant is often controlled for by including motion estimates in the design matrix of first-level analyses [@Johnstone2006-tn]; in EEG, some control for activity due to eye-movements by including activity measured by concurrent electro-oculography as covariates in the design-matrix [@Parra2005-um]. Usually, the general linear model is then used to estimate each predictor's influence on the neuroimaging data. Importantly, the parameter estimates ($\hat{\beta}$) are often interpreted as reflecting the unique contribution^[However, parameter estimates only reflect unique variance when ordinary, weighted, or generalized least squares is used to find the model parameters. Other (regularized) linear models, such as ridge regression or LASSO, are not guaranteed to yield parameters that explain unique proportions of variance.] of each predictor variable, independent from the influence of the confound.

Contrary to general linear models as employed in univariate (activation-based) analyses, including confound variables in the data as predictors for *decoding* models is arguably problematic. If a confound is included in the data in the context of decoding models, the parameter estimates of the features (often called "feature weights", $w$, in decoding models) may be corrected for the influence of the confound, but the *model performance* [usually measured as explained variance, $R^2$, or classification accuracy; @Hebart2017-jn] is not. That is, rather than providing an estimate of decoding performance "controlled for" a confound, one obtains a measure of performance when explicitly *including* the confound as an interesting source of variance that the decoder is allowed to use. This is problematic because research using decoding analyses generally does not focus on parameter estimates but on statistics of model performance. Model performance statistics (e.g., $R^2$, classification accuracy) alone cannot disentangle the contribution of different sources of information as they only represent a single summary statistic of model fit [@Ritchie2017-gl]. One might, then, argue that additionally inspecting feature weights of decoding models may help in disambiguating different sources of information [@Sepehrband2018-dy]. However, it has been shown that feature weights cannot be reliably mapped to specific sources of information, i.e., as being task-related or confound-related [e.g., features with large weights may be completely uncorrelated with the target variable; @Haufe2014-el; @Hebart2017-jn]. As such, it does not make sense to include confounds in the set of predictors when the goal is to disambiguate the different sources of information in decoding analyses.

Recently, another approach similar to including confounds in the data has been proposed, which is based on the idea of a dose-response curve [@alizadeh2017decoding]. In this method, instead of adding the confound(s) to the model directly, the relative contribution of true and confounded signal is systematically controlled. The authors show that this approach is able to directly quantify the unique contribution of each source of information, thus effectively controlling for confounded signal. However, while sophisticated in its approach, this method only seems to work for categorical confounds, as it is difficult (if not impossible) to systematically vary the proportion of confound-related information when dealing with continuous confounds or when dealing with more than one confound.

#### Control for confounds during pattern estimation {#confounds-decoding-introduction-methods-pattern-estimation}

Another method that was used in some decoding studies on functional MRI data aims to control for confounds in the initial procedure of estimating activity patterns of the to-be-decoded events, by leveraging the ability of the GLM to yield parameter estimates reflecting unique variance [@Woolgar2014-jb]. In this method, an initial "first-level" (univariate) analysis models the fMRI time series ($s$) as a function of both predictors-of-interest ($X$) and the confounds ($C$), often using the GLM^[Note that $X$ and $C$, here, refer to (usually HRF-convolved) predictors of the time series signal ($s$) for a single voxel. In the rest of the article, $X$ and $C$ refer to features that are defined across samples (not time).]:

\begin{equation}
s = X\beta_{x} + C\beta_{c} + \epsilon
\end{equation}

Then, only the estimated parameters ($\hat{\beta}$, or normalized parameters, such as *t*-values or *z*-values) corresponding to the predictors-of-interest ($\hat{\beta}_{x}$) are used as activity estimates (i.e., the  used for predicting the target $y$) in the subsequent decoding analyses. This method thus takes advantage of the shared variance partitioning in the pattern estimation step to control for potential confounding variables. However, while elegant in principle, this method is not applicable in between-subject decoding studies [e.g., clinical decoding studies; @Van_Waarde2014-sh; @Cuingnet2011-hv], in which confounding variables are defined across subjects, or in electrophysiology studies, in which activity patterns do not have to be^[Note that, technically, one could use the "Control for confounds during pattern estimation" method in electrophysiology as well, by first fitting a univariate model explaining the neuroimaging data ($X_{j}$ for $j = 1 \dots K$) as a function of both the target ($y$) and the confound ($C$) and subsequently only using the parameter estimates of the target-predictor ($\hat{\beta}_{x}$) as patterns in the subsequent decoding analysis.] estimated in a first-level model, thus limiting the applicability of this method.

#### Post hoc counterbalancing of confounds {#confounds-decoding-introduction-methods-posthoc-counterbalancing}

When a priori counterbalancing is not possible, some have argued that post hoc counterbalancing might control for the influence of confounds [@Rao2017-bw, p. 24, 38]. In this method, given that there is some sample correlation between the target and confound ($r_{Cy} \neq 0$) in the entire dataset, one takes a subset of samples in which there is no empirical relation between the confound and the target (e.g., when $r_{Cy} \approx 0$). In other words, post hoc counterbalancing is a way to *decorrelate* the confound and the target by subsampling the data. Then, subsequent decoding analysis on the subsampled data can only capitalize on true signal, as there is no confounded signal anymore (see Figure \@ref(fig:fig-confounds-decoding-2)). While intuitive in principle, we are not aware of whether this method has been evaluated before and whether it yields unbiased performance estimates.

```{r fig-confounds-decoding-2, fig.cap='(ref:caption-fig-confounds-decoding-2)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_2.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-2) A schematic visualization how the main two confound control methods evaluated in this article deal with the "confounded signal", making sure decoding models only capitalize on the "true signal".

#### Confound regression {#confounds-decoding-introduction-methods-confound-regression}

The last and perhaps most common method to control for confounds is removing the variance that can be explained by the confound (i.e., the confounded signal) from the neuroimaging data directly [@Abdulkadir2014-bh; @Dukart2011-aq; @Kostro2014-cm; @Rao2017-bw; @Todd2013-sd] --- a process we refer to as *confound regression* [also known as "image correction"; @Rao2017-bw]. In this method, a (usually linear) regression model is fitted on each feature in the neuroimaging data (i.e., a single voxel or sensor) with the confound(s) as predictor(s). Thus, each feature  in the neuroimaging data $X$ is modelled as a linear function of the confounding variable(s), $C$:

\begin{equation}
X_{j} = C\beta + \epsilon
\end{equation}

We can estimate the parameter(s)  for feature  using, for example, ordinary least squares as follows [for an example using a different model, see @Abdulkadir2014-bh]:

\begin{equation}
\hat{\beta}_{j} = (C^{T}C)^{-1}C^{T}X_{j}
\end{equation}

Then, to remove the variance of (or "regress out") the confound from the neuroimaging data, we can subtract the variance in the data associated with confound ($C\hat{\beta}_{j}$) from the original data:

\begin{equation}
X_{j,\mathrm{corr}} = X_{j} - C\hat{\beta}_{j}
\end{equation}

In which $X_{j,\mathrm{corr}}$ represents the neuroimaging feature $X_{j}$ from which all variance of the confound is removed (including the variance shared with $y$, i.e., the confounded signal; see Figure \@ref(fig:fig-confounds-decoding-2)). When subsequently applying a decoding analysis on this corrected data, one can be sure that the decoder is not capitalizing on signal that is correlated with the confound, which thus improves interpretability of the decoding analysis.

Confound regression has been applied in several decoding studies. @Todd2013-sd were, as far as the current authors are aware, the first to use this method to control for a confound (in their case, reaction time) that was shown to correlate with their target variable (rule A vs. rule B). Notably, they both regressed out reaction time from the first-level time series data (similar to the "Control for confounds during pattern estimation" method) *and* regressed out reaction time from the trial-by-trial activity estimates (i.e., confound regression as described in this section). They showed that controlling for reaction time in this way completely eliminated the above chance decoding performance. Similarly, @Kostro2014-cm observe a substantial drop in classification accuracy when controlling for scanner site in the decoding analysis of Huntington's disease, but only when scanner site and disease status were actually correlated. Lastly, @Rao2017-bw found that, in contrast to Kostro et al. and Todd et al., confound regression yielded similar (or slightly lower, but still significant) performance compared to the model without confound control, but it should be noted that this study used a regression model (instead of a classification model) and evaluated confound control in the specific situation when the training set is confounded, but the test set is not.^[Note that we did not discuss studies that implement a different confound regression procedure [e.g., @Abdulkadir2014-bh; @Dukart2011-aq], in which confound regression is only estimated on the samples from a single class of the target variable (e.g., in our gender decoding example, this would mean that confound regression models are only estimated on the data from male, or female, subjects). As this form of confound regression does not disambiguate the sources of information driving the decoder, it is not discussed further in this article.] In sum, while confound regression has been used before, it has yielded variable results, possibly due to slightly different approaches and differences in the correlation between the confounding variable and the target.

### Current study {#confounds-decoding-introduction-current-study}

In summary, multiple methods have been proposed to deal with confounds in decoding analyses. Often, these methods have specific assumptions about the nature or format of the data (such as "A priori counterbalancing" and "Confound control during pattern estimation"), differ in their objective (e.g., *prediction* vs. *interpretation*, such as in "Include confounds in the data"), or have yielded variable results (such as "Confound regression"). Therefore, given that we are specifically interested in interpreting decoding analyses, the current study evaluates the two methods that are applicable in most contexts: post hoc counterbalancing and confound regression (but see [Supplementary Materials](#confounds-decoding-supplement) for a tentative evaluation of this method based on simulated functional MRI data). In addition to these two methods, we propose a third method --- a modified version of confound regression —-- which we show yields plausible, seemingly unbiased, and interpretable results.

To test whether these methods are able to effectively control for confounds and whether they yield plausible results, we apply them to empirical data, as well as to simulated data in which the ground truth with respect to the signal in the data (i.e., the proportion of true signal and confounded signal) is known. For our empirical data, we enact the previously mentioned hypothetical study in which participant gender is decoded from structural MRI data. We use a large dataset ($N = 217$) of structural MRI data and try to predict subjects' gender (male/female) from gray and white matter patterns while controlling for the confound of "brain size" using the aforementioned methods, which we compare to a baseline model in which confounds are not controlled for. Given the previously reported high correlations between brain size and gender [@Barnes2010-pu; @Smith2018-th], we expect that successfully controlling for brain size yields lower decoding performance than using uncorrected data, but not below chance level. Note that higher decoding performance after controlling for confounds is theoretically possible when the correlation between the confound and variance in the data *unrelated* to the target (e.g., noise) is sufficiently high to cause suppressor effects [see Figure 1 in @Haufe2014-el; @Hebart2017-jn]. However, because our confound, brain size, is known to correlate strongly with our target gender [approx. $r = 0.63$; @Smith2018-th], it is improbable that it also correlates highly with variance in brain data that is unrelated to gender. It follows then that classical suppression effects are unlikely and we thus expect lower model performance after controlling for brain size.

However, shown in detail below, both post hoc counterbalancing and confound regression lead to unexpected results in our empirical analyses: counterbalancing fails to reduce model performance while confound regression consistently yields low model performance up to the point of significant below chance accuracy. In subsequent analyses of simulated data, we show that both methods lead to *biased* results: post hoc counterbalancing yields inflated model performance (i.e., positive bias) because subsampling selectively selects a subset of samples in which features correlate more strongly with the target variable, suggesting (indirect) circularity in the analysis [@Kriegeskorte2009-yz]. Furthermore, our simulations show that negative bias (including significant below chance classification) after confound regression on the entire dataset is due to reducing the signal below what is expected by chance [@jamalabadi2016classification], which we show is related to and can be predicted by the standard deviation of the empirical distribution of correlations between the features in the data and the target. We propose a minor but crucial addition to the confound regression procedure, in which we cross-validate the confound regression models (which we call "cross-validated confound regression", CVCR), which solves the below chance accuracy issue and yields plausible model performance in both our empirical and simulated data.

## Methods {#confounds-decoding-methods}

### Data {#confounds-decoding-methods-data}

For the empirical analyses, we used voxel-based morphometry (VBM) data based on T1-weighted scans and tract-based spatial statistics (TBSS) data based on diffusion tensor images from 217 participants (122 women, 95 men), acquired with a Philips Achieva 3T MRI-scanner and a 32-channel head coil at the Spinoza Centre for Neuroimaging (Amsterdam, The Netherlands).

#### VBM acquisition & analysis {#confounds-decoding-methods-data-vbm}

The T1-weighted scans with a voxel size of 1.0 × 1.0 × 1.0 mm were acquired using 3D fast field echo (TR: 8.1 ms, TE: 3.7 ms, flip angle: 8°, FOV: 240 × 188 mm, 220 slices). We used "FSL-VBM" protocol [@Douaud2007-sw] from the FSL software package [version 5.0.9; @Smith2004-sc]; using default and recommended parameters (including non-linear registration to standard space). The resulting VBM-maps were spatially smoothed using a Gaussian kernel (3 mm FWHM). Subsequently, we organized the data in the standard pattern-analysis format of a 2D ($N \times K$) array of shape 217 (subjects) × 412473 (non-zero voxels).

#### TBSS acquisition & analysis {#confounds-decoding-methods-data-tbss}

Diffusion tensor images with a voxel size of 2.0 × 2.0 × 2.0 mm were acquired using a spin-echo echo-planar imaging (SE-EPI) protocol (TR: 7476 ms, TE: 86 ms, flip angle: 90°, FOV: 224 × 224 mm, 60 slices), which acquired a single b = 0 (non-diffusion-weighted) image and 32 (diffusion-weighted) b = 1000 images. All volumes were corrected for eddy-currents and motion (using the FSL command "eddy_correct") and the non-diffusion-weighted image was skullstripped (using FSL-BET with the fractional intensity threshold set to 0.3) to create a mask that was subsequently used in the fractional anisotropy (FA) estimation. The FA-images resulting from the diffusion tensor fitting procedure were subsequently processed by FSL's tract-based spatial statistics (TBSS) pipeline [@Smith2006-sf], using the recommended parameters (i.e., non-linear registration to FSL's 1 mm FA image, construction of mean FA-image and skeletonized mean FA-image based on the data from all subjects, and a threshold of 0.2 for the skeletonized FA-mask). Subsequently, we organized the resulting skeletonized FA-maps into a 2D ($N \times K$) array of shape 217 (subjects) × 128340 (non-zero voxels).

#### Brain size estimation {#confounds-decoding-methods-data-brainsize}

To estimate the values for our confound, global brain size, we calculated for each subject the total number of non-zero voxels in the gray matter and white matter map resulting from the segmentation step in the FSL-VBM pipeline [using FSL's segmentation algorithm "FAST"; @Zhang2001-wa]. The number of non-zero voxels from the gray matter map was used as the confound for the VBM-based analyses and the number of non-zero voxels from the white matter map was used as the confound for the TBSS-based analyses. Note that brain size estimates from total white matter volume and total gray matter volume correlated strongly, $r (216) = 0.93$, $p < 0.001$.

#### Data and code availability {#confounds-decoding-methods-data-data-and-code}

In the Github repository corresponding to this article ([https://github.com/lukassnoek/MVCA](https://github.com/lukassnoek/MVCA)), we included a script (`download_data.py`) to download the data (the 4D VBM and TBSS nifti-images as well as the non-zero 2D samples × features arrays). The repository also contains detailed Jupyter notebooks with the annotated empirical analyses and simulations reported in this article.

### Decoding pipeline {#confounds-decoding-methods-pipeline}

All empirical analyses and simulations used a common decoding pipeline, implemented using functionality from the *scikit-learn* Python package for machine learning [@Abraham2014-ef; @Pedregosa2011-bp]. This pipeline included univariate feature selection (based on a prespecified amount of voxels with highest univariate difference in terms of the ANOVA *F*-statistic), feature-scaling (ensuring zero mean and unit standard deviation for each feature), and a support vector classifier (SVC) with a linear kernel, fixed regularization parameter (*C* = 1), and sample weights set to be inversely proportional to class frequency (to account for class imbalance). In our empirical analyses, we evaluated model performance for different numbers of voxels (as selected by the univariate feature selection). For our empirical analyses, we report model performance as the $F_{1}$ score, which is insensitive to class imbalance (which, in addition to adjusted sample weights, prevents the classifier from learning the relative probabilities of target classes instead of representative information in the features; see also Supplementary Figure \@ref(fig:fig-confounds-decoding-S14) for a replication of part of the results using AUROC, another metric that is insensitive to class imbalance). At chance level classification, the $F_{1}$ score is expected to be 0.5. For our simulations, in which there is no class imbalance, we report model performance using accuracy scores. In figures showing error bars around the average model performance scores, the error bars represent 95% confidence intervals estimated using the "bias-corrected and accelerated" (BCA) bootstrap method using 10,000 bootstrap replications [@efron1987better]. For calculating BCA bootstrap confidence intervals, we used the implementation from the open source "scikits.bootstrap" Python package ([https://github.com/cgevans/scikits-bootstrap](https://github.com/cgevans/scikits-bootstrap)). Statistical significance was calculated using non-parametric permutation tests, as implemented in scikit-learn, with 1000 permutations [@Ojala2010-rc].

### Evaluated methods for confound control {#confounds-decoding-methods-evaluated-methods}

#### Post hoc counterbalancing {#confounds-decoding-methods-evaluated-methods-counterbalancing}

We implemented post hoc counterbalancing in two steps. First, to quantify the strength of relation between the confound and the target in our dataset, we estimated the point-biserial correlation coefficient between the confound, $C$ (brain size), and the target, $y$ (gender) across the entire dataset (including all samples $i = 1 \dots N$). Because of both sampling noise and measurement noise, sample correlation coefficients vary around the population correlation coefficient and are thus improbable to be 0 *exactly*.^[For continuous confounds, it is practically impossible to achieve a correlation with the target of *exactly* zero, which is the reason we subsample until it is smaller than a prespecified threshold. For categorical confounds, however, a correlation between the confound and the target of exactly zero is possible [this amounts to equal proportions of levels of $c$ within each class of $y$; @Gorgen2017-sy], even *necessary*, because it is impossible to find a (*K*-fold) cross-validation partitioning in which each split is counterbalanced w.r.t. the confound if the correlation *in the entire dataset* between the target and the confound is not zero.] Therefore, in the next step, we subsampled the data until the correlation coefficient between  and  becomes non-significant at some significance threshold $\alpha$: $p(r_{Cy}) > \alpha$.

In our analyses, we used an $\alpha$ of 0.1. Note that this is more "strict"^[We refer to a relatively high α as “strict”, here, because we use it here for the purpose of demonstrating no effect.] than the conventionally used threshold ($\alpha = 0.05$), but given that decoding analyses are often more sensitive to signal in the data (whether it is confounded or true signal), we chose to err on the safe side and counterbalance the data using a relatively strict threshold of $\alpha = 0.1$.

Subsampling was done by iteratively removing samples that contribute most to the correlation between the confound and the target until the correlation becomes non-significant. In our empirical data in which brain size is positively correlated with gender (coded as male = 1, female = 0) this amounted to iteratively removing the male subject with the largest brain size and the female subject with the smallest brain size. This procedure optimally balances (1) minimizing the correlation between target and confound and (2) maximizing sample size. As an alternative to this "targeted subsampling", we additionally implemented a procedure which draws random subsamples of a given sample size until it finds a subsample with a non-significant correlation coefficient. If such a subsample cannot be found after 10,000 random draws, sample size is decreased by 1, which is repeated until a subsample is found. This procedure resulted in much smaller subsamples than the targeted subsampling procedure (i.e., a larger power loss) since the optimal subsample is hard to find randomly.^[One could run the "random subsampling" procedure with more than 10,000 draws in order to reduce the aforementioned power loss; but in the extreme, this would result in the same optimal subsample that can be found much faster by targeted subsampling.] In the analyses below, therefore, we used the targeted subsampling procedure. Importantly, even with extreme power loss, random subsampling can cause the same biases as will be described for the targeted subsampling method below (cf. Figure \@ref(fig:fig-confounds-decoding-8) and Figure \@ref(fig:fig-confounds-decoding-10) and Supplementary Figures \@ref(fig:fig-confounds-decoding-S13) and \@ref(fig:fig-confounds-decoding-S14)).

Then, given that the subsampled dataset is counterbalanced with respect to the confound, a random stratified K-fold cross-validation scheme is repeatedly initialized until a scheme is found in which *all* splits are counterbalanced as well [cf. @Gorgen2017-sy]. This particular counterbalanced cross-validation scheme is subsequently used to cross-validate the MVPA pipeline. We implemented this post hoc counterbalancing method as a scikit-learn-style cross-validator class, available from the aforementioned Github repository (in the `counterbalance.py` module).

#### Confound regression

In our empirical analyses and simulations, we tested two different versions of confound regression, which we call "whole-dataset confound regression" (WDCR) and "cross-validated confound regression" (CVCR). In WDCR, we regressed out the confounds from the predictors *from the entire dataset at once*, i.e., before entering the iterative cross-validated MVPA pipeline [the approach taken by @Abdulkadir2014-bh; @dubois2018resting; @Kostro2014-cm; @Todd2013-sd]. Note that we can do this for all $K$ voxels at once using the closed-form OLS solution, in which we first estimated the parameters $\hat{\beta}_{C}$:

\begin{equation}
\hat{\beta}_{C} = (C^{T}C)^{-1}C^{T}X
\end{equation}

where $C$ is an  array in which the first column contained an intercept and the second column contained the confound brain size. Accordingly, $\hat{\beta}_{C}$ is an $2 \times K$ array. We then removed the variance associated with the confound from our neuroimaging data as follows:

\begin{equation}
X_{\mathrm{corr}} = X - C\hat{\beta}_{C}
\end{equation}

Now, $X_{\mathrm{corr}}$ is an array with the same shape as the original $X$ array, but without any variance that can be explained by confound, $C$ (i.e., $X$ is residualized with regard to $C$).

In our proposed cross-validated version of confound regression [which was mentioned but not evaluated by @Rao2017-bw, p. 25], "CVCR", we similarly regressed out the confounds from the neuroimaging data, but instead of estimating $\hat{\beta}_{C}$ on the entire dataset, we estimated this within each fold of training data ($X_{\mathrm{train}}$):

\begin{equation}
\hat{\beta}_{C,\mathrm{train}} = (C^{T}_{\mathrm{train}}C_{\mathrm{train}})^{-1}C^{T}_{\mathrm{train}}X_{\mathrm{train}}
\end{equation}

And we subsequently used these parameters ($\hat{\beta}_{C,\mathrm{train}}$) to remove the variance related to the confound from both the train set ($X_{\mathrm{train}}$ and $C_{\mathrm{train}}$):

\begin{equation}
X_{\mathrm{train, corr}} = X_{\mathrm{train}} - C_{\mathrm{train}}\hat{\beta}_{C,\mathrm{train}}
(\#eq:cvcr-train)
\end{equation}

and the test test ($X_{\mathrm{test}}$ and $C_{\mathrm{test}}$):

\begin{equation}
X_{\mathrm{test, corr}} = X_{\mathrm{test}} - C_{\mathrm{test}}\hat{\beta}_{C,\mathrm{test}}
(\#eq:cvcr-test)
\end{equation}

Thus, essentially, CVCR is the cross-validated version of WDCR. One might argue that regressing the confound from the train set only, i.e., implementing only equation \@ref(eq:cvcr-train), not equation \@ref(eq:cvcr-test), is sufficient to control for confounds as it prevents the decoding model from relying on signal related to the confound. We evaluated this method and report the corresponding results in Supplementary Figure \@ref(fig:fig-confounds-decoding-S10).

We implemented these confound regression techniques as a *scikit-learn* compatible transformer class, available in the open-source *skbold* Python package ([https://github.com/lukassnoek/skbold](https://github.com/lukassnoek/skbold)) and in the aforementioned Github repository.

#### Control for confounds during pattern estimation

In addition to post hoc counterbalancing and confound regression, we also evaluated how well the "control for confounds during pattern estimation" method controls for the influence of confounds in decoding analyses of (simulated) fMRI data. The simulation methods and results can be found in the [Supplementary Materials](#confounds-decoding-supplement).

### Analyses of simulated data

In addition to the empirical evaluation of counterbalancing and confound regression in the gender decoding example, we ran three additional analyses on simulated data. First, we investigated the efficacy of the three confound control methods on synthetic data with known quantities of "true signal" and "confounded signal", in order to detect potential biases. Second, we ran additional analyses on simulated data to investigate the positive bias in model performance observed after post hoc counterbalancing. Third, we ran additional analyses on simulated data to investigate the negative bias in model performance observed after WDCR. In the [Supplementary Materials](#confounds-decoding-supplement), we investigate whether the confound regression results generalize to (simulated) functional MRI data (Supplementary Figure \@ref(fig:fig-confounds-decoding-S1) and \@ref(fig:fig-confounds-decoding-S2)).

#### Efficacy analyses

In this simulation, we evaluated the efficacy of the three methods for confound control on synthetic data with a prespecified correlation between the confound and the target, $r_{Cy}$, and varying amounts of "confounded signal" (i.e., the explained variance in $y$ driven by shared variance between $X$ and $y$). These simulations allowed us to have full control over (and knowledge of) the influence of both signal and confound in the data, and thereby help us diagnose biases associated with post hoc counterbalancing and confound regression.

Specifically, in this efficacy analysis, we generated hypothetical data sets holding the correlation coefficient between $C$ and $y$ constant, while varying the amount of true signal and confounded signal. We operationalized true signal as the squared semipartial Pearson correlation between $y$ and each feature in $X$, controlled for $C$. As such, we will refer to this term as $\mathrm{signal}\ R^{2}$:

\begin{equation}
\mathrm{signal}\ R^{2} = r_{y(X.C)}^{2}
\end{equation}

In the simulations reported and shown in the main article, we used $r_{Cy} = 0.65$, which corresponds to the observed correlation between brain size and gender in our dataset. To generate synthetic data with this prespecified structure, we generated (1) a data matrix $X$ of shape $N\times K$, (2) a target variable $y$ of shape $N \times 1$, and (3) a confound variable $C$ of shape $N \times P$. For all simulations, we used the following parameters: $N = 200$, $K = 5$, and $P = 1$  (i.e., a single confound variable). We generated $y$ as a categorical variable with binary values, $y \in \{0, 1\}$, with equal class probabilities (i.e., 50%), given that most decoding studies focus on binary classification. We generated $C$ as a continuous random variable drawn from a standard normal distribution. We generated each feature $X_{j}$ as a linear combination of $y$ and $C$ plus Gaussian noise. Thus, for each predictor $j = 1 \dots K$ in $X_{j}$:

\begin{equation}
X_{j} = \beta_{y}y + \beta_{C}C + \epsilon, \epsilon \sim \mathcal{N}(0, \gamma)
\end{equation}

in which $\beta_{y}$ represented the weight given to $y$, and $\beta_{C}$ represented the weight given to $C$ in the generation of the feature $X_{j}$, and $\mathcal{N}(0, \gamma)$ is the normal distribution with zero mean and standard deviation $\gamma$. The parameters $\beta_{y}$ and $\beta_{C}$ were both initialized with a value of 1. First, if the difference between the total variance explained and the sum of the desired signal $R^2$ and confound $R^2$ values was larger than 0.01, the standard deviation of the normal distribution from which the errors were drawn (i.e., $\gamma$) was adjusted (decreased with 0.01 when the total $R^2$ is too low, increased with 0.01 when the total $R^2$ is too high), after which  was generated again. This process was iterated until the target total $R^2$ value is found. Then, the total variance explained was partitioned into confound $R^2$ and signal $R^2$. If one or both of these values differed from the targeted values by more than 0.01, the generative parameters $\beta_{y}$ and $\beta_{C}$ were adjusted: if signal $R^2$ is too low,  was increased with 0.01, and decreased with 0.01 otherwise. If confound $R^2$ is too low, $\beta_{C}$ was increased with 0.01, and decreased with 0.01 otherwise. After adjusting these parameters, $X_{j}$ was generated again. This process was iterated until the data contain the desired "true signal" and "confounded signal".

We evaluated the different methods for confound control for two values of signal $R^2$ (0.004, representing plausible null data,^[Note that plausible null data do not reflect a signal $R^2$ of 0, because this statistic is biased towards values larger than 0 (because it represents a squared number) when dealing with noisy data, hence our choice of signal $R^2 = 0.004$.] and 0.1, representing a plausible true effect) and a range of confound $R^2$ values (in steps of 0.05: $0.00, 0.05, 0.10, \dots , 0.35$). This simulation was iterated 10 times (with different partitions of the folds) to ensure the results were not influenced by random noise. Importantly, the specific scenario in which confound $R^2$ equals 0, which represents data without any confounded signal ($r_{yX}^2$), served as “reference model performance” to which we can compare the efficacy the confound control methods. This comparison allowed us to detect potential biases.

After the data were generated, a baseline model (no confound control) and the three methods outlined above (post hoc counterbalancing, WDCR, and CVCR) were applied to the simulated data using the standard pipeline described in the [Decoding pipeline](#confounds-decoding-methods-pipeline) section (but without univariate feature selection) and compared to the reference performance.

#### Analysis of positive bias after post hoc counterbalancing {#confounds-decoding-methods-counterbalancing-bias}

As detailed below, post hoc counterbalancing did not lead to the expected decrease in model performance; instead, there appeared to be a trend towards an *increase* in model performance. To further investigate the cause of this unexpected result, we simulated a multivariate normal dataset with three variables, reflecting our data ($X$), target ($y$), and confound ($C$), with 1000 samples ($N$) and a single feature ($K = 1$). We iterated this data generation process 1000 times and subsequently selected the dataset which yielded the largest (positive) difference between model performance after post hoc counterbalancing versus no confound control. In other words, we used the dataset in which the counterbalancing issue was most apparent. While not necessarily representative of typical (neuroimaging) datasets, this process allowed us to explain and visualize how it is possible that model performance increases after counterbalancing the data.

To generate data from a multivariate normal distribution, we first generated variance-covariance matrices with unit variance for all variables, so that covariances can be interpreted as correlations. The covariances in the matrix were generated as pairwise correlations ($r_{yX}$, $r_{Cy}$, ${r_CX}$), each sampled from a uniform distribution with range $[-0.65, 0.65]$. We generated data using such prespecified correlation structure because the relative increase in model performance after counterbalancing did not appear to occur when generating completely random (normally distributed) data. Moreover, we restricted the range of the uniform distribution from which the pairwise correlations are drawn to $[-0.65, 0.65]$ because a larger range can result in covariance matrices that are not positive-semidefinite. After generating the three variables, we binarized the target variable ($y$) using a mean-split ($y = 0$ if $y < \bar{y}$, $y = 1$ otherwise) to frame the analysis as a classification problem rather than a regression problem.

We then subsampled the selected dataset using our post hoc counterbalancing algorithm and subsequently ran the decoding pipeline (without univariate feature selection) on the subsampled ("retained") data in a 10-fold stratified cross-validation scheme. Notably, we cross-validated our fitted pipeline not only to the left-out *retained* data, but also to the data that did not survive the subsampling procedure (the *rejected* data; see Figure \@ref(fig:fig-confounds-decoding-3)). Across the 10 folds, we kept track of two statistics from the retained and rejected samples: (1) the classification performance, and (2) the signed distance to the decision boundary. Negative distances in binary classification (in simple binary classification with $y \in \{0, 1\}$) reflect a prediction of the sample as $y = 0$, while positive distances reflect a prediction of the sample as $y = 1$. As such, a correctly classified sample of class 0 has a negative distance from the decision boundary, while a correctly classified sample of class 1 has a positive distance from the decision boundary. Here, however, we wanted to count the distance of samples that are on the "incorrect" side of the decision boundary as *negative* distances, while counting the distance of samples that are on the "correct" side of the decision boundary as positive distances. To this end, we used a "re-coded" version of the target variable ($y^{*} = -1$ if $y = 0$, $y^{*} = 1$ otherwise) and multiplied it with the distance. Consequently, negative distances of *correct* samples of condition 0 become positive and positive distances of *incorrect* samples of condition 0 become negative (by multiplying them by $-1$). As such, we calculated the signed distance from the decision boundary ($\delta_{i}$) for any sample $i$ as:

\begin{equation}
\delta_{i} = y^{*}(w^{T}X_{i} + b)
\end{equation}

in which $w$ refers to the feature weights (coefficients) and $b$ refers to the intercept term. Any differences in these two statistics (proportion correctly classified and signed distance to the classification boundary) between the retained and rejected samples may signify biases in model performance estimates (i.e., better cross-validated model performance on the retained data than on the rejected data would confirm positive bias, as it indicates that subsampling tends to reject hard-to-classify samples). We applied this analysis also to the empirical data (separately for the different values of $K$) to show that the effect of counterbalancing, as demonstrated using simulated data, also occurs in the empirical data.

```{r fig-confounds-decoding-3, fig.cap='(ref:caption-fig-confounds-decoding-3)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_3.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-3) Visualization of method to evaluate whether counterbalancing yields unbiased cross-validated model performance estimates.

#### Analysis of negative bias after WDCR

As also detailed below, WDCR can lead to significantly below chance accuracy. To investigate the cause of this below chance performance (and to demonstrate that CVCR does not lead to such results), we performed two follow-up simulations. The first follow-up simulation shows that the occurrence of below chance accuracy depends on the distribution of feature-target correlations [$r_{yX}$; see for a similar argument @jamalabadi2016classification], and the second follow-up simulation shows that WDCR artificially narrows this distribution. This artificial narrowing of the distribution is exacerbated both by an increasing number of features ($K$), as well as higher correlations between the target and confound ($r_{Cy}$).

In the first simulation, we simulated random null data (drawn from a standard normal distribution) with 100 samples ($N$) and 200 features ($K$), as well as a binary target feature ($y \in \{0, 1\}$). We then calculated the cross-validated prediction accuracy using the standard pipeline (without univariate feature selection) described in the [Decoding pipeline](#confounds-decoding-methods-pipeline) section; we iterate this process 500 times. Then, we show that the variance of the cross-validated accuracy is accurately predicted by the standard deviation (i.e., "width") of the distribution of correlations between the features and the target ($r_{yX_{j}}$ with $j = 1 \dots K$), which we will denote by $sd(r_{yX})$. Importantly, we show that below chance accuracy likely occurs when the standard deviation of the feature-target correlation distribution is lower than the standard deviation of the sampling distribution of the Pearson correlation coefficient parameterized with the same number of samples ($N = 200$) and the same effect size (i.e., $\rho = 0$, because we simulated random null data). The sampling distribution of the Pearson correlation coefficient is described by @kendall1973functional. When $\rho = 0$ (as in our simulations), the equation is as follows:

\begin{equation}
f(r; N) = (1 -r^2)^{\frac{N-4}{2}}[\mathcal{B}](\frac{1}{2}, \frac{N-2}{2})^{-1}
\end{equation}

where $\mathcal{B}(a, b)$ represents the Beta-function.

Then, in a second simulation, we similarly simulated null data as in the previous simulation, but now we also generate a continuous confound ($C$) with a varying correlation with the target ($r_{Cy} \in \{0.0, 0.1, 0.2, \dots, 1.0\}$). Before subjecting the data to the decoding pipeline, we regressed out the confound from the data (i.e., WDCR). We did this for different numbers of features ($K \in \{1, 5, 10, 50, 100, 500, 1000\}$). Then, we applied CVCR on the simulated data as well for comparison.

## Results

### Influence of brain size

Before evaluating the different methods for confound control, we determined whether brain size is truly a confound given our proposed definition ("a variable that is not of primary interest, correlates with the target, and is encoded in the neuroimaging data"). We evaluated the relationship between the target and the confound in two ways. First, we calculated the (point-biserial) correlation between gender and brain size, which was significant for both the estimation based on white matter, $r(216) = .645, p < 0.001$, and the estimation based on grey matter, $r(216) = .588, p < 0.001$, corroborating the findings by @Smith2018-th. Second, as recommended by @Gorgen2017-sy, who argue that the potential influence of confounds can be discovered by running a classification analysis using the confound as the (single) feature predicting the target, we ran our decoding pipeline (without univariate feature selection) using brain size as a single feature to predict gender. This analysis yielded a mean classification performance ($F_{1}$ score) of 0.78 (*SD* = .10) when using brain size estimated from white matter and 0.81 (*SD* = .09) when using brain size estimated from gray matter, which are both significant with $p < 0.001$ (see Figure \@ref(fig:fig-confounds-decoding-4)A).

```{r fig-confounds-decoding-4, fig.cap='(ref:caption-fig-confounds-decoding-4)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_4.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-4) A) Model performance when using brain size to predict gender for both brain-size estimated from grey matter (left) and from white matter (right). Points in yellow depict individual $F_{1}$ scores per fold in the 10-fold cross-validation scheme. Whiskers of the box plot are 1.5x the interquartile range. B) Distributions of observed correlations between brain size and voxels ($r_{XC}$), overlayed with the analytic sampling distribution of correlation coefficients when $\rho = 0$ and $N = 217$, for both the VBM data (left) and TBSS data (right). Density estimates are obtained by kernel density estimation with a Gaussian kernel and Scott's rule [@scott1979optimal] for bandwidth selection.

To estimate whether brain size is encoded in the neuroimaging data, we compared the distribution of bivariate correlation coefficients (of each voxel with brain size) with the sampling distribution of correlation coefficients when $\rho = 0$ and $N = 217$ (see section [Analysis of negative bias after WDCR](#confounds-decoding-results-wdcr-bias) for details). Under the null hypothesis that there are no correlations between brain size and voxel intensities, each individual correlation coefficient between a voxel and the confound can be regarded as an independent sample with $N = 217$ (ignoring correlations between voxels for simplicity). Because $K$ is very large for both the VBM and TBSS data, the empirical distribution of correlation coefficients should, under the null hypothesis, approach the analytic distribution of correlation coefficients parametrized by $\rho = 0$ and $N = 217$. Contrarily, the density plots in Fig. \@ref(fig:fig-confounds-decoding-4)B clearly show that the observed correlation coefficients distribution does not follow the sampling distribution (with both an increase in variance and a shift of the mode). This indicates that at least some of the correlation coefficients between voxel intensities and brain size are extremely unlikely under the null hypothesis. Note that this interpretation is contingent on the assumption that the relation between brain size and VBM/TBSS data is linear. In the Supplementary Materials and Results (Supplementary Figures \@ref(fig:fig-confounds-decoding-S7)-\@ref(fig:fig-confounds-decoding-S9)), we provide some evidence for the validity of this assumption.

### Baseline model: no confound control

In our baseline model on the empirical data, for different numbers of voxels, we predicted gender from structural MRI data (VBM and TBSS) without controlling for brain size (see Figure \@ref(fig:fig-confounds-decoding-5)). The results show significant above chance performance of the MVPA pipeline based on both the VBM data and the TBSS data. All performance scores averaged across folds were significant ($p < 0.001$).

```{r fig-confounds-decoding-5, fig.cap='(ref:caption-fig-confounds-decoding-5)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_5.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-5) Baseline scores using the VBM (left) and TBSS (right) data without any confound control. Scores reflect the average $F_{1}$ score across 10 folds; error bars reflect 95% confidence intervals. The dashed black line reflect theoretical chance-level performance and the dashed orange line reflects the average model performance when only brain size is used as a predictor for reference; Asterisks indicates significant performance above chance: *** = $p < 0.001$, ** = $p < 0.01$, * = $p < 0.05$.

These above chance performance estimates replicate previous studies on gender decoding using structural MRI data [@Del_Giudice2016-ns; @Rosenblatt2016-oy; @Sepehrband2018-dy] and will serve as a baseline estimate of model performance to which the confound control methods will be compared.

In the next three subsections, we will report the results from the three discussed methods to control for confounds: post hoc counterbalancing, whole-dataset confound regression (WDCR), and cross-validated confound regression (CVCR).

### Post hoc counterbalancing

#### Empirical results

In order to decorrelate brain size and gender (i.e., $r_{Cy} > 0.1$), our subsampling algorithm selected 117 samples in the VBM data (i.e., a sample size reduction of 46.1%) and 131 samples in the TBSS data (i.e., a reduction of 39.6%). The model performance for different values of  (number of voxels) are shown in Figure \@ref(fig:fig-confounds-decoding-6). Contrary to our expectations, the predictive accuracy of our decoding pipeline after counterbalancing was similar to baseline performance. This is particularly surprising in light of the large reductions in sample size, which results in a substantial loss in power, which in turn is expected to lead to lower model performance.

```{r fig-confounds-decoding-6, fig.cap='(ref:caption-fig-confounds-decoding-6)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_6.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-6) Model performance after counterbalancing (green) versus the baseline performance (blue) for both the VBM (left) and TBSS (right) data (upper row) and the difference in performance between the methods (lower row). Performance reflects the average (difference) $F_{1}$ score across 10 folds; error bars reflect 95% confidence intervals. The dashed black line reflect theoretical chance-level performance (0.5) and the dashed orange line reflects the average model performance when only brain size is used as a predictor. Asterisks indicates significant performance above chance: *** = $p < 0.001$, ** = $p < 0.01$, * = $p < 0.05$.

One could argue that the lack of expected decrease in model performance after counterbalancing can be explained by the possibility that the subsampling and counterbalancing procedure just leads to the selection of different features during univariate feature selection compared to the baseline model. In other words, the increase in model performance may be caused by the feature selection function, which selects "better" voxels (i.e., containing more "robust" signal), resulting in similar model performance in spite of the reduction in sample size. However, this does not explain the similar scores for counterbalancing and the baseline model when using all voxels (the data points at $K \mathrm{voxels} = \dots \mathrm{(all)}$ in Figure \@ref(fig:fig-confounds-decoding-6)). Another possibility for the relative increase in model performance based on the counterbalanced data versus the baseline model is that counterbalancing increased the amount of signal in the data. Indeed, counterbalancing appeared to increase the (absolute) correlations between the data and the target ($r_{yX}$), which is visualized in Figure \@ref(fig:fig-confounds-decoding-7), suggesting an increase in signal.

```{r fig-confounds-decoding-7, fig.cap='(ref:caption-fig-confounds-decoding-7)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_7.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-7) Density plots of the correlations between the target and voxels across all voxels before (blue) and after (green) subsampling for both the VBM and TBSS data. Density estimates are obtained by kernel density estimation with a Gaussian kernel and Scott's rule [@scott1979optimal] for bandwidth selection.

This apparent increase in the correlations between the target and neuroimaging data goes against the intuition that removing the influence of a confound that is highly correlated with the target will reduce decoding performance. To further investigate this, we replicated this effect of post hoc counterbalancing on simulated data, as described in the next section ([Efficacy analyses](#confounds-decoding-results-cb-efficacy)), and additionally investigated the cause of the negative bias observed after WDCR using a separate set of simulations.

#### Efficacy analysis {#confounds-decoding-results-cb-efficacy}

To evaluate the efficacy of the three confound control methods, we simulated data in which we varied the strength of confound $R^2$ and signal $R^2$, after which we applied the three confound control methods to the data. The results of this analysis show that counterbalancing maintains chance-level model performance when there is almost no signal in the data (i.e., signal $R^2 = 0.004$; Figure \@ref(fig:fig-confounds-decoding-8), left graph, green line). However, when there is some signal (i.e., signal $R^2 = 0.1$; Fig. 8, right graph), we observed that counterbalancing yields similar or even higher scores than the baseline model, replicating the effects observed in the empirical analyses.

```{r fig-confounds-decoding-8, fig.cap='(ref:caption-fig-confounds-decoding-8)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_8.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-8) Results from the different confound control methods on simulated data without any experimental effect (signal $R^2 = 0.004$; left graph) and with some experimental effect (signal $R^2 = 0.1$; right graph) for different values of confound $R^2$. The orange line represents the average performance (±1 SD) when confound $R^2 = 0$, which serves as a “reference performance” for when there is no confounded signal in the data. For both graphs, the correlation between the target and the confound, $r_{yC}$, is fixed at 0.65. The results from the WDCR and CVCR methods are explained later.

As is apparent from Figure \@ref(fig:fig-confounds-decoding-8) (right panel), when there is some signal, the counterbalanced data seem to yield better performance than the baseline model only for relatively low confound $R^2$ values (confound $R^2 < 0.15$). As suggested by our findings in the empirical data (see Figure \@(ref:fig-confounds-decoding-7)), we hypothesized that the observed improvement in model performance after counterbalancing was caused by the increase in correlations between the target and features in the neuroimaging data. In support of this hypothesis, Figure \@ref(fig:fig-confounds-decoding-9) illustrates the relations between the strength of the confound (confound $R^2$, color coded), the increase in correlations after post hoc counterbalancing ($\delta r_{yX} = r_{yX}^{\mathrm{after}} - r_{yX}^{\mathrm{after}}$; x-axis) for each confound $R^2$, and the resulting difference in model performance ($\mathrm{ACC}_{\mathrm{CB}} - \mathrm{ACC}_{\mathrm{baseline}}$; y-axis). The figure shows that the increase or decrease in accuracy after counterbalancing (compared to baseline) depends on $\delta r_{yX}$ ($r(79) = .922$, $p < 0.001$), which in turn depends on confound $R^2$ ($r(79) = -0.987$, $p < 0.001$). To reiterate, these differences in model performance are only due to the post hoc counterbalancing procedure and not due to varying signal in the simulated data. The effect of post hoc counterbalancing on model performance thus seems to depend on the strength of the confound.

```{r fig-confounds-decoding-9, fig.cap='(ref:caption-fig-confounds-decoding-9)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_9.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-9) The relationship between the increase in correlations between target and data ($r_{yX}$) after subsampling, confound $R^2$, difference in model performance (here: accuracy) between the counterbalance model and baseline model ($\mathrm{ACC}_{\mathrm{CB}} - \mathrm{ACC}_{\mathrm{baseline}}$).

While this relationship in Figure \@ref(fig:fig-confounds-decoding-9) might be statistically interesting, it does not explain why post hoc counterbalancing tends to increase the correlations between neuroimaging data and target, and even outperforms the baseline model when confound $R^2$ is low and some signal is present. More importantly, it does not tell us whether the post hoc counterbalancing procedure uncovers signal that is truly related to the target --- in which case the procedure suppresses noise --- or inflates performance estimates and thereby introduces positive bias. Therefore, in the next section, we report and discuss results from a follow-up simulation that intuitively shows why post hoc counterbalancing leads to an increase in performance, and furthermore shows that this increase is in fact a positive bias.

#### Analysis of positive bias after post hoc counterbalancing

With this follow-up analysis, we aimed to visualize the scenario in which post hoc counterbalancing leads to a clearly better performance than model performance without confound control. As such, we generated 1000 data sets using a covariance matrix that we knew leads to a large difference between the baseline model and model performance after counterbalancing (i.e., data with a low confound $R^2$). From these 1000 datasets, we selected the dataset that yielded the largest difference for our visualization (see the [Analysis of positive bias after post hoc counterbalancing](#confounds-decoding-methods-counterbalancing-bias) section in the Methods for details).

The data that yielded the largest difference (i.e., a performance increase from 0.613 to 0.804, a 31% increase) are visualized in Figure \@ref(fig:fig-confounds-decoding-10). Each sample's confound value ($C$) is plotted against its feature value ($X$), both before subsampling (upper scatter plot) and after subsampling (lower scatter plot). From visual inspection, it appears that the samples rejected by the subsampling procedure (i.e., the samples with the white border) have relatively large absolute values of the confound variable, which tend to lie close to or on the "wrong" side of the classification boundary (i.e., the dashed black line) in this specific configuration of the data. In other words, subsampling seems to reject samples that are harder to classify or would be incorrectly classified based on the data (here, the single feature of $X$). The density plots in Figure \@ref(fig:fig-confounds-decoding-10) show the same effect in a different way: while the difference in the modes of the distributions of the confound ($C$) between classes is reduced after subsampling (i.e., the density plots parallel to the y-axis), the difference in the modes of the distributions of the data ($X$) between classes is actually increased after subsampling (i.e., the density plots parallel to the x-axis).

```{r fig-confounds-decoding-10, fig.cap='(ref:caption-fig-confounds-decoding-10)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_10.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-10) Both scatterplots visualize the relationship between the data ($X$ with $K=1$, on the x-axis), the confound ($C$, on the y-axis) and the target ($y$). Dots with a white border in the upper scatterplot indicate samples that are rejected in the subsampling process; the lower scatterplot visualizes the data without these rejected samples. The dashed black lines in the scatterplot represent the decision boundary of the SVM classifier; the color of the background shows how samples in that area are classified (a blue background means a prediction of $y = 0$ and a green background means a prediction of $y = 1$). The density plots parallel to the y-axis depict the distribution of the confound ($C$) for the samples in which $y = 0$ (blue) and in which $y = 1$ (green). The density plots parallel to x-axis depict the distribution of the data ($X$) for the samples in which $y = 0$ (blue) and in which $y = 1$ (green). Density estimates are obtained by kernel density estimation with a Gaussian kernel and Scott's rule [@scott1979optimal] for bandwidth selection.

We quantified this effect of subsampling by comparing the signed distance from the decision boundary (i.e., the dashed line in the upper scatter plot) between the retained samples and the rejected (subsampled) samples, in which a larger distance from the decision boundary reflects a higher confidence of the classifier's prediction (see Figure \@ref(fig:fig-confounds-decoding-3) for a visualization of this method). Indeed, we found that samples that are removed by subsampling lie significantly closer to (or on the "wrong" side of) the decision boundary (*M* = -.358, *SD* = .619) than samples that are retained after subsampling (*M* = .506, *SD* = .580), as indicated by a independent samples *t*-test, $t(998) = 22.32$, $p < 0.001$. Also (which follows from the previous observation), samples that would have been removed by subsampling are more often classified incorrectly (75% incorrect) than the samples that would have been retained by subsampling (20% incorrect), as indicated by a chi-squared test, $\chi^{2} = 270.29$, $p < 0.001$.

To show that the same effect (i.e., removing samples that tend to be hard to classify or would be wrongly classified) occurred in the empirical data after counterbalancing as well, we applied the same analysis of comparing model performance and distance to boundary between the retained and rejected samples to the empirical data. Indeed, across all different numbers of voxels ($K$), the retained samples were significantly more often classified correctly (Figure \@ref(fig:fig-confounds-decoding-11)A) and had a significantly larger distance to the classification boundary (Figure \@ref(fig:fig-confounds-decoding-11)B) than the rejected samples. This demonstrates that the same effect of post hoc counterbalancing, as shown in the simulated data, likely underlies the increase in model performance of the counterbalanced data relative to the baseline model in the empirical data.

```{r fig-confounds-decoding-11, fig.cap='(ref:caption-fig-confounds-decoding-11)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_11.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-11) **A**) The proportion of samples classified correctly, separately for the "retained" samples (blue line) and "rejected" samples (green line); the dashed line represents chance level (0.5). **B**) The average distance to the classification boundary for the retained and rejected samples; the dashed line represents the decision boundary, with values below the line representing samples on the "wrong" side of the boundary (and vice versa). Asterisks indicates a significant difference between the retained and rejected samples: *** = $p < 0.001$, ** = $p < 0.01$, * = $p < 0.05$.

One can wonder how much the occurrence of these observed biases in post hoc counterbalancing depends on the specific method of subsampling used. Random subsampling led to qualitatively similar results as targeted subsampling (cf. Supplementary Figures \@ref(fig:fig-confounds-decoding-S13) and \@ref(fig:fig-confounds-decoding-S14) with random subsampling). Instead, the bias is introduced through features that weakly correlate with the target in the whole sample, but strongly in subsamples where there is no correlation between target and the confound (features which, as our results show, exist in the neuroimaging data). That is, the bias is an indirect result of decorrelating target and confound in the sample, which is an essential step in post hoc counterbalancing (in fact, it is the *goal* of counterbalancing). For this reason, we consider it unlikely (but not impossible) that there exists a way to subsample data without introducing biases.

In summary, removing a subset of observations to correct for the influence of a confound can induce substantial bias by removing samples that are harder to classify using the available data. The bias itself can be subtle (e.g., in our empirical results, the predictive performance falls in a realistic range of predictive performances), and could remain undetected when present. Therefore, we believe that post hoc counterbalancing by subsampling the data is an inappropriate method to control for confounds.

### Whole-dataset confound regression (WDCR)

#### Empirical results

In addition to post hoc counterbalancing, we evaluated the efficacy of "whole-dataset confound regression" (WDCR), i.e. regressing out the confound from each feature separately using all samples from the dataset to control for confounds. Compared to the baseline model, WDCR yielded a strong decrease in performance, even dropping (significantly) below chance for all TBSS analyses and a subset of the VBM analyses (see Figure \@ref(fig:fig-confounds-decoding-12)).

```{r fig-confounds-decoding-12, fig.cap='(ref:caption-fig-confounds-decoding-12)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_12.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-12) Model performance after WDCR (orange) versus the baseline performance (blue) for both the VBM (left) and TBSS (right) data. Performance reflects the average $F_{1}$ score across 10 folds; error bars reflect 95% confidence intervals. The dashed black line reflect theoretical chance-level performance (0.5) and the dashed orange line reflects the average model performance when only brain size is used as a predictor. Asterisks indicates performance of the WDCR model that is significantly above or below chance: *** = $p < 0.001$, ** = $p < 0.01$, * = $p < 0.05$.

This strong (and implausible) reduction in model performance after WDCR is investigated in more detail in the next two sections on the results from the simulations.

#### Efficacy analysis

The results from the analyses investigating the efficacy of the confound control methods (see Figure \@ref(fig:fig-confounds-decoding-8)) show that WDCR accurately corrects for the confound in both in data without signal (i.e., when signal $R^2 = 0.004$) and in data with some signal (i.e., when signal $R^2 = 0.1$), as evident from the fact that the performance after WDCR is similar to the reference performance. This result (i.e., plausible performance after confound control) stands in contrast to the results from the empirical analyses, which is why we ran a follow-up analysis on simulated data to investigate this specific issue.

#### Analysis of negative bias after WDCR {#confounds-decoding-results-wdcr-bias}

Inspired by the work of @jamalabadi2016classification on below chance accuracy in decoding analyses, we ran several follow-up analyses to get insight into why WDCR leads to below chance model performance. As Jamalabadi et al. show, below chance model performance occurs when the data contain little signal. In our first follow-up simulation, we sought to refine the explanation of the cause of below chance model performance by linking it to the observed standard deviation of the empirical distribution of correlations between the data ($X$) and the target ($y$). To do so, we simulated random data ($X$) and a binary target ($y \in \{0, 1\}$) and estimated (per fold) the cross-validated classification accuracy using the standard pipeline described in the methods section. We repeated this process 500 times, yielding 500 data sets. The expected *average* predictive accuracy for each dataset is 0.5, but this varies randomly across folds and iterations. We hypothesized that this variance can be explained by the standard deviation ("width") of the initial feature-target correlation distribution, *sd*($r_{Xy}$): narrower distributions may yield relatively lower cross-validated classification accuracy than relatively wider feature-target correlation distributions. Indeed, we find that the initial standard deviation of this distribution is significantly correlated with the cross-validated accuracy, $r(499) = 0.73$, $p < 0.001$ (Figure \@ref(fig:fig-confounds-decoding-13)A). Importantly, we find that this relationship holds for different values of $N$ (see Supplementary Figure \@ref(fig:fig-confounds-decoding-S15), for different sizes of the test set (see Supplementary Figure \@ref(fig:fig-confounds-decoding-S16)), and for different sizes of $K$ (see Supplementary Figure \@ref(fig:fig-confounds-decoding-S17)).

```{r fig-confounds-decoding-13, fig.cap='(ref:caption-fig-confounds-decoding-13)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_13.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-13) **A**) The relationship between the standard deviation of the distribution of feature-target correlations, *sd*($r_{yX}$), and accuracy across iterations of cross-validated classification analyses of null data. The vertical dashed line represents the standard deviation from the sampling distribution parameterized with $\rho = 0$ and $N = 100$ (i.e., the same parameters used to generate the null data); the horizontal dashed line represents the expected accuracy for data with this standard deviation based on the regression line estimated from the data across simulations (see Supplementary Figure \@ref(fig:fig-confounds-decoding-S15) for the same plot with different values for $N$). **B**) The relationship between the proportion of features of which the sign of their correlation with the target ($r_{Xy}$) “flips” between the train-set and the test-set and accuracy. The vertical dashed line represents a proportion of 0.5., i.e., 50% of the features flip their correlation sign, which corresponds approximately with an accuracy of 0.5. **C**) The relationship between the weighted difference between feature-target correlations in the train and test set (see equation \@ref(eq:dataset-shift)) and accuracy.

This observation, then, begs the question: *why* do narrower-than-chance correlation distributions lead to below chance accuracy? One potential explanation of below chance accuracy is that the classifier may learn a particular (linear) relationship between features and the target in the train set (e.g., $r_{Xy} = 0.05$), while the sign of this relationship is "flipped" in the test set [e.g., $r_{Xy} = -0.03$; see @jamalabadi2016classification], which is known in the machine learning literature as "dataset shift" [@Quionero-Candela2009-ge]. This situation would lead classifiers to predict the exact opposite classes for samples in the test set, leading to below chance accuracy. In the results of our simulated data, the standard deviation of the feature-target distribution was indeed significantly negatively correlated with the proportion of features that flipped the sign of their correlation between the train set and test set, $r(499) = -.687$, $p < 0.001$. This means that a higher density of feature-target correlations around 0 (i.e., a narrower width of the corresponding distribution) leads to more "sign flips". This phenomenon of "sign flipping" has been reported before in the context of (a priori) counterbalancing of categorical variables ($X$) with respect to the target ($y$), where it was observed that complete counterbalancing led to consistent "sign flipping" and consequently 0% accuracy [@Gorgen2017-sy]. Similarly, we found that the proportion of features that flip sign was significantly negatively correlated with accuracy, $r = -.565$, $p < 0.001$, indicating that larger proportions of features that flip sign leads to lower accuracy (see Figure \@ref(fig:fig-confounds-decoding-13)B). Interestingly, at a proportion of 0.5, accuracy is approximately at chance level (0.5; dashed lines in Figure \@ref(fig:fig-confounds-decoding-13)B).

This relationship between "sign flipping" and accuracy, however, leaves room for improvement in terms of explaining the variance of accuracy scores. Therefore, we sought to further refine our "model" of accuracy by defining dataset shift not by the proportion of sign flips, but by the average *difference* between the feature-target correlations between the train set and test set. Moreover, because not all features contribute equally strongly to a classifier's prediction (i.e., they are weighted), we furthermore weighed each feature's "shift" by the associated classifier weight ($w_{j}$). Formally, we estimated dataset shift ($\hat{ds}$) thus as follows:

\begin{equation}
\hat{ds} = \frac{1}{K}\sum_{j=1}^{K}(r_{X_{j,\mathrm{train}},y_\mathrm{train}} - r_{X_{j,\mathrm{test}},y_\mathrm{test}})w_{j}
(\#eq:dataset-shift)
\end{equation}

Indeed, the correlation between this particular operationalization of "dataset shift" and accuracy across simulations was much higher than just the proportion of sign flips, $r(499) = −0.934$ (Figure \@ref(fig:fig-confounds-decoding-13)B).

Having established the relation between the standard deviation of the initial feature-target correlation distribution and accuracy, we followed up our simulation by investigating specifically the effect of WDCR on the standard deviation of the correlation distribution. We investigated this by simulating data with different strengths of the correlation between the confound and the target ($r_{Cy}$) and the number of features ($K$). From Figure \@ref(fig:fig-confounds-decoding-14)A, it is clear that, while the expected chance level is 0.5 in all cases, model performance quickly drops below chance for increasing correlations between the target and the confound, as well as for increasing numbers of features; even leading to a model performance of 0% when the confound is perfectly correlated with the target and when using 1000 features. Figure \@ref(fig:fig-confounds-decoding-14)C shows that, indeed, higher values lead to narrower correlation distributions, which is shown in Figure \@ref(fig:fig-confounds-decoding-14)D to yield relatively lower accuracy scores.

```{r fig-confounds-decoding-14, fig.cap='(ref:caption-fig-confounds-decoding-14)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_14.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-14) **A**) The effect of WDCR on data varying in the correlation of the confound with the target ($r_{Cy}$; x-axis) and the number of features ($K$; different lines). **B**) The effect of CVCR on data varying in the correlation of the confound with the target and the number of features. The dashed black line represents chance model performance in subplots A and B. **C**) The relation between the correlation of the confound with the target ($r_{Cy}$) and the standard deviation of the feature-target correlation distribution, *sd*($r_{yX}$) for the WDCR data. The dashed black line represents the standard deviation of the correlation distribution predicted by the sampling distribution. **D**) The relation of the standard deviation of the correlation distribution and accuracy for the WDCR data (only shown for the data when $K = 100$; see Supplementary Figure \@ref(fig:fig-confounds-decoding-S18) for visualizations of this effect for different values of $K$). The data depicted in all panels are null data.

In summary, our simulations show that below chance accuracy is accurately predicted by the standard deviation (i.e., "width") of the distribution of empirical feature-target correlations and that WDCR reduces this standard deviation, which explains why the empirical analyses yielded below chance model performance (especially for larger numbers of voxels).

### Cross-validated confound regression (CVCR)

#### Empirical results

As the results from the empirical analyses and simulations suggest, the use of WDCR is problematic because of the partitioning of the dataset into a separate train set and test set after confound regression. As such, our proposed cross-validated confound regression (CVCR) methods suggests to move the confound regression procedure inside the cross-validation loop, thereby also cross-validating this step. As expected, compared to the baseline model (i.e., no confound control), the results from the empirical analyses using CVCR show reduced (but not below chance) model performance for both VBM and TBSS data, and all different numbers of voxels (see Figure \@ref(fig:fig-confounds-decoding-15)). Notably, for some numbers of voxels, model performance was not significantly above chance level.


```{r fig-confounds-decoding-15, fig.cap='(ref:caption-fig-confounds-decoding-15)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_15.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-15) Model performance after CVCR (pink) versus the baseline performance (blue) for both the VBM (left) and TBSS (right) data. Performance reflects the average $F_{1}$ score across 10 folds; error bars reflect 95% confidence intervals across 1000 bootstrap replications. The dashed black line reflect theoretical chance level performance (0.5) and the dashed orange line reflects the average model performance when only brain size is used as a predictor. Asterisks indicates performance of the CVCR model that is significantly above or below chance: *** = $p < 0.001$, ** = $p < 0.01$, * = $p < 0.05$.

We also evaluated whether regressing the confound from the train set only was sufficient to control for confounds, but found that it does not effectively control for confounds when there is no true signal (i.e., there is positive bias), which is visualized in more detail in Supplementary Figure \@ref(fig:fig-confounds-decoding-S10) (cf. Figure \@ref(fig:fig-confounds-decoding-8)).

#### Efficacy analysis

Similar to WDCR, CVCR yielded plausible and unbiased model performance (see Figure \@ref(fig:fig-confounds-decoding-8), pink line). Moreover, when applied to the simulated null data, CVCR yielded model performance scores at chance level across all levels of the confound-target correlation and numbers of features (see Figure \@ref(fig:fig-confounds-decoding-14)B).

### Summary methods for confound control

In this section, we investigated the effects of different method to control confounds (post hoc counterbalancing, WDCR, and CVCR) on empirical MRI data and simulated data (see Figure \@ref(fig:fig-confounds-decoding-16) for a summary of the empirical results). Post hoc counterbalancing was, at least using the subsampling method described, clearly unable to effectively control for confounding influences, which is putatively caused by indirect circularity in the analysis process due to subsampling. Confound regression showed an expected drop in model performance (but not below chance level), but only when the confound regression step is properly cross-validated (i.e., the CVCR version).

```{r fig-confounds-decoding-16, fig.cap='(ref:caption-fig-confounds-decoding-16)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_16.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-16) An overview of the empirical results on the four different confound methods: None, post hoc counterbalancing, WDCR, and CVCR.

## Discussion {#confounds-decoding-discussion}

Decoding analyses have become a popular alternative to univariate analyses of neuroimaging data. This analysis approach, however, inherently suffers from ambiguity in terms of which source of information is picked up by the decoder [@Naselaris2015-jn]. Given that one is often interested in model interpretability rather than merely accurate prediction [@Hebart2017-jn], one should strive to control for alternative sources of information (i.e., other than the target of interest) that might drive decoding. Effectively controlling for these alternative sources of information, or *confounds*, helps in disambiguating decoding models. In this article, we reviewed and tested two generic, broadly applicable methods that aim to control for confounds in decoding analyses: post hoc counterbalancing and confound regression. Additionally, we proposed a third method that, unlike the other two methods, has shown to effectively control for confounds.

Both when applied to empirical and simulated data, we found that neither post hoc counterbalancing nor (whole-dataset) confound regression yielded plausible and unbiased model performance estimates. First, we found that post hoc counterbalancing leads to *optimistic* (i.e., positively biased) model performance estimates, which is a result of removing samples that are hard to classify or would be wrongly classified, during the subsampling process. Because this subsampling process is applied to the entire dataset at once (i.e., it is not cross-validated), it can be seen as a form of indirect circular analysis [@Kriegeskorte2009-yz], in which the data themselves are used to inform analysis decisions, which can lead to biased generalization estimates. Second, our initial evaluation of confound regression, which was applied on the entire dataset ("WDCR"), yielded pessimistic (i.e., negatively biased) and even significantly below chance model performance estimates. Extending previous research [@jamalabadi2016classification], we show that this negative bias occurs when the "signal" in the data (operationalized as the width of the feature-target correlation distribution) is lower than would be expected by chance, which we link to the sampling distribution of the Pearson correlation coefficient. Importantly, we show that WDCR systematically narrows the width of the correlation distribution --- and thus leads to lower model performance --- which is exacerbated by both higher correlations between target and confound, as well as by a larger number of features.

The negative bias observed in WDCR is caused by the fact that it is performed on the whole dataset at once, leading to statistical dependencies between subsequent train and test partitions. To overcome this negative bias, we propose to cross-validate the confound regression procedure (which we call "Cross-Validated Confound Regression", CVCR). We show that this method yields plausible model performance in the empirical analyses (i.e., significantly above chance model performance) and nearly unbiased model performance in the simulations, for different datasets varying in the amount of features ($K$) and the strength of the confound ($r_{Cy}$). Moreover, initial supplementary simulations suggest that these results generalize to (simulated) fMRI data (Supplementary Figure \@ref(fig:fig-confounds-decoding-S1)), seemingly demonstrating effective control of confounds across different degrees of autocorrelation (Supplementary Figure \@ref(fig:fig-confounds-decoding-S2)). The method may show some negative bias in some scenarios due to the fact that, in the train set, CVCR will remove all variance associated with the confound (even variance *spuriously* correlated with the confound). However, this bias seems, at least in the simulated scenarios, very small. Overall, we believe that our results demonstrate that CVCR is a flexible and effective method to control for confounds in decoding analyses of neuroimaging data.

### Relevance and consequences for previous and future research

#### A priori and post hoc counterbalancing

We believe our results have implications not only for post hoc counterbalancing, but a priori counterbalancing in observational designs in general. In both behavioral research [@Wacholder1992-wb] and neuroimaging research [Gorgen2017-sy], a priori counterbalancing (or case-control "matching") is a common strategy to avoid effects of confounds. However, as we show in the current study, this may unintentionally remove samples that are harder to predict, especially when there is little shared variance between the confound and the other predictors (i.e., when there is low confound $R^2$). Because, conceptually, this represents a form of circular analysis, counterbalancing --- regardless of whether it is applied a priori or post hoc --- can yield biased model performance estimates. To some extent, the bias in the post hoc counterbalancing results should not come as a surprise: as noted in the [Methods](#confounds-decoding-methods) section, counterbalancing in observational research requires the researcher to choose a sample that is not representative of the population [see also @Sedgwick2013-op]. As a result, out-of-sample predictive performance drops significantly, in our case even to chance level.

Since post hoc counterbalancing does not show any positive bias in model performance when there is no signal at all (i.e., signal $R^2$), one could argue that any observed significant above chance effect, while positively biased in terms of effect magnitude, can be interpreted as evidence that there must be signal in the data in the first place. However, we argue against this interpretation for two reasons. First, any above chance predictive performance of models fitted after subsampling is not only positively biased, but also does not cross-validate to the rejected samples (see Figure \@ref(fig:fig-confounds-decoding-11)). That is, the model picks up relations between features and target that are only present in the subsample, and not in the samples left out of the analysis. As a result, it is questionable whether (and if so, how) the model should be interpreted --- after all, we assume that the rejected samples were drawn from the population of interest in a valid way. Second, any possible absence of above chance model performance after subsampling can neither be interpreted as evidence for an *absence* of a true effect, since the subsampling procedure necessarily leads to a (often substantial) power loss. It could still well be that in the original sample there was a true relation between features and target. Thus, interpretation of modelling efforts after subsampling is problematic in case of both *presence* and *absence* of above chance model performances.

#### Confound regression

In contrast to post hoc counterbalancing, confound regression in its uncross-validated form (i.e., WDCR) has been applied widely in the context of decoding analyses [@dubois2018resting; @Kostro2014-cm; @Rao2017-bw; @Todd2013-sd]. Indeed, the first study that systematically investigated the effect of confounds in decoding analyses [@Todd2013-sd] used WDCR to account for the confounding effect of reaction times (RT) on decoding of rule representations and found that WDCR completely eliminated the predictive performance that was found without controlling for RT. This observation, however, can potentially be explained by the negative bias induced by WDCR. This possible explanation is corroborated by a follow-up study that similarly looked into RT confounding the decoding of rule representations [@Woolgar2014-jb], who did not use WDCR but accounted for RT confounding by including it as a covariate during the pattern estimation procedure (see [Supplementary Materials](#confounds-decoding-supplement) for a tentative evaluation of this method), which in contrast to the study by Todd et al. yielded significant decoding performance. Moreover, while not specifically investigated here, we expect a similar negative bias to occur when a confound is removed from a continuous target variable using WDCR --- which may offer an explanation for the null finding of @dubois2018resting, who fail to decode personality characteristics from resting-state fMRI.

#### Relevance to other analysis methods

While this article focuses on controlling for confounds in decoding analyses specifically, we believe that our findings may be relevant for analysis methods beyond decoding analyses as well. In fact, methods for controlling for confounds (or alternative sources of information) have previously been investigated and applied in another type of MVPA named "representational similarity analysis" [RSA; @kriegeskorte2008representational]. In the context of RSA, the explained variance in the neural data is often partitioned into different (model-based) feature sets (i.e., sources of information), which allows one to draw conclusions about the unique influence of each source of information [see, e.g., @Groen2018-qo; @Hebart2018-dz; @Ramakrishnan2014-ki]. Specifically, variance partitioning in RSA is done by removing the variance from the representational dissimilarity matrix (RDM) based on the feature set that needs to be controlled for. Notably, the variance of the RDMs that are not of interest can be removed from only the neural RDM [@Hebart2018-dz; @Ramakrishnan2014-ki] or both from the neural RDM and the RDM of interest [@Groen2018-qo]. While the analysis context is different, the underlying technique is identical to confound regression as described and evaluated in this article. Importantly, the studies employing this variance partitioning technique [@Groen2018-qo; @Hebart2018-dz; @Ramakrishnan2014-ki] similarly report plausible model performances after confound regression (i.e., relatively lower but not below chance performance), corroborating our results with (cross-validated) confound regression. Note that the distinction between WDCR and CVCR in the context of most RSA studies (including the aforementioned studies) is largely irrelevant, as representational similarity analyses are not commonly cross-validated. However, recently, some have proposed to use cross-validated distance measures [such as the cross-validated Mahalanobis distance; @Guggenmos2018-rr; @Walther2016-je] in RSA, which could suffer from negative bias when combined with (not cross-validated) variance partitioning similar to what we observed with WDCR in the context of decoding analyses.

We believe that especially our findings with regard to WDCR and CVCR may be relevant for any cross-validated analysis, regardless of the "direction" of analysis (encoding vs. decoding) and the dimensionality of the neural data (univariate vs. multivariate approaches). In general, our findings with respect to negative bias after WDCR were to be expected, as it introduces dependence between the train set and the test set which violates the crucial assumption of independence of any cross-validated analysis. While a violation of the independence assumption often leads to positive bias such as in "double dipping" [@Kriegeskorte2009-yz], we show here that it may also lead to negative bias. Either way, our findings reinforce the idea that data analysis operations should *never* be applied to the entire dataset before subjecting the data to a cross-validated analysis. Therefore, we believe that our findings with respect to WDCR and CVCR will generalize to any cross-validated analysis [such as cross-validated MANOVA, @allefeld2014searchlight; or cross-validated encoding models, @naselaris2011encoding], but future research is necessary to substantiate this claim.

#### Importance for gender decoding studies

The importance of proper confound control is moreover highlighted by the empirical question we address. Without any optimization of the prediction pipeline, we were able to predict gender with a model performance up to approximately 0.85 without confound control. This is in line with reports from various other studies [@Del_Giudice2016-ns; @Rosenblatt2016-oy; @Sepehrband2018-dy]. However, this predictive performance is driven by a mixture two sources of information: global and local differences in brain structure. With confound control, however, we show that predictive performance using only local differences lies around 0.6 for VBM data and 0.7 for TBSS data --- a substantial drop in performance. Especially because the remaining predictive performance is lower than predictive performance using only brain size, we argue that the use of proper confound control may lead one to draw substantially different conclusions about the differences in brain structure between men and women. For the debate on gender dimorphism, it is thus extremely important to take global brain size into account in the context of decoding analyses [as has been similarly recommended for mass-univariate analyses; @Barnes2010-pu].

### Choosing a confound model: linear vs. nonlinear models

In the present paper, we focused on the use of linear models for confound control. It is crucial to note that the efficacy of confound control depends on the suitability of the confound regression model employed. Removing variance associated with a confound using a linear model removes only the variance of data (features) that is linearly related to the confound. When a confound is nonlinearly related to the data, some variance associated with the confound can remain in the data after a linear confound model is used to regress out variance. It is possible that the decoding model subsequently applied still picks up this residual "confounded" variance. In other words, an unsuitable confound model may control for confounds imperfectly.

The exact relation between confound and (brain) data is hardly ever known a priori. However, it is possible to explore the nature of this relation using the data at hand. For example, a researcher can apply a cross-validated prediction pipeline to predict a feature (e.g., VBM voxel intensity) from the confound. The researcher can then test what type of model (linear or nonlinear) describes the relation between confound and data best. In the [Supplementary Materials](#confounds-decoding-supplement) (section "Linear vs nonlinear confound models: predicting VBM and TBSS data based on brain size"), we provide an example of this approach. We used linear, quadratic, and cubic regression models to predict VBM and TBSS voxel intensity using brain size as feature. In the Supplementary Results, we show that linear models perform equally well as or better than polynomial models for the majority of voxels (Supplementary Figures \@ref(fig:fig-confounds-decoding-S7) and \@ref(fig:fig-confounds-decoding-S9)). Further, for voxels where polynomials outperform linear models, the difference between model performances is minimal (Supplementary Figure \@ref(fig:fig-confounds-decoding-S8)). Thus, in the empirical research question explored in this paper, a linear confound model seems to suit the data very well.

### Practical recommendations

As indicated by the title of this article, we will now outline some practical recommendations for dealing with confounds in decoding analyses of neuroimaging data. First, one needs to obtain an accurate measurement of potential confounds [@westfall2016statistically]. While we assumed the availability of such a measure in this article, this is not always trivial. In experimental settings, for example, reaction times can potentially be identified as a confound [@Todd2013-sd; @Woolgar2014-jb], but arguably, it is not reaction time but rather an unobserved variable related to reaction time (e.g., difficulty or attention) that confounds the analysis. In such scenarios, the best one can do is measure reaction time as a proxy, and be aware that any subsequent confound control method is limited by how well this proxy corresponds to the actual confound. Second, one needs to identify which variables actually confound a decoding analysis. To detect confounds, we recommend using the "same analysis approach" outlined by @Gorgen2017-sy. In short, this method involves trying to predict the target variable using your confound(s) as predictive features (for example, when using only brain size to predict gender). In case of significant above chance decoding performance, and assuming the confounds are actually encoded in the neuroimaging data, the hypothesized confounds will most likely influence the actual decoding analysis. While in the current article we focused on simple univariate confounding effects (i.e., confounding by a single variable), the same analysis approach is not limited to detecting univariate confounds --- it facilitates detecting multivariate (i.e., confounding by multiple variables) or interaction effects (i.e., confounding by interaction effects between variables) as well. For example, if one hypothesizes that the target variable is related to the interaction between confound $C_{1}$ and $C_{2}$ (i.e., $C_{1} \times C_{2}$), one can simply use the interaction term as the potential confound in the same analysis approach to evaluate the potential confounding influence.

Once the specific confound terms have been identified, we recommend regressing out the confound from the data in a cross-validated manner (i.e., using CVCR). Specifically, we recommend including confound regression as the first step in your decoding pipeline to avoid the effect of confounds on other operations in the pipeline [such as univariate feature selection; @chu2012does]. In this article, we used ordinary least squares (OLS) regression to remove the influence of confounds from the data, because a linear model describes the relation between brain size and VBM/TBSS voxel intensities well (see Supplementary Figures \@ref(fig:fig-confounds-decoding-S7)-\@ref(fig:fig-confounds-decoding-S9)). However, not only linear models can be used to remove variance associated with a confound from the data --- it is possible to use nonlinear models (potentially with multiple confounds and interactions between them) if it is clear that the relation between confounds and neuroimaging features is nonlinear (see previous section for details on choosing a confound model). However, as a limitation to the presented results, we did not test whether CVCR also leads to (nearly) unbiased results when used with nonlinear models. We advise, therefore, in such cases, to first test in a simulation study whether CVCR provides an unbiased confound control method with nonlinear models before use with actual data.

## Conclusions

In general, we believe that the contributions of the current study are twofold. First and foremost, it provides a systematic evaluation of widely applicable methods to control for confounds and shows that, of the methods investigated, only one ("cross-validated confound regression") appears to yield plausible and almost unbiased results. The results from this evaluation hopefully prevents researchers from using post hoc counterbalancing and whole-dataset confound regression, which we show may introduce (unintended) biases. Moreover, we made all analyses and preprocessed data openly available ([https://github.com/lukassnoek/MVCA](https://github.com/lukassnoek/MVCA)) and provide a simple implementation for cross-validated confound regression that interfaces with the popular scikit-learn package in the Python programming language. Second, we believe that this study improves understanding of the elusive phenomenon of below chance accuracy [building on previous work by @jamalabadi2016classification]. In general, we hope that this study helps researchers in gaining more insight into their decoding analyses by providing a method that disentangles the contributions of different sources of information that may be encoded in their data.











<!--chapter:end:03-confounds-decoding.Rmd-->

```{r setup-aomic, include=FALSE}
knitr::opts_chunk$set(results = 'hide', echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(kableExtra)
```

# The Amsterdam Open MRI Collection, a set of multimodal MRI datasets for individual difference analyses {#aomic}
\chaptermark{AOMIC}

\vspace*{\fill}

---

\small
\noindent
_This chapter has been published as_: Snoek, L., van der Miesen, M.M., Beemsterboer, T., van der Leij, A., Eigenhuis, A., & Scholte, H.S. (2021). The Amsterdam Open MRI Collection, a set of multimodal MRI datasets for individual difference analyses. _Nature Scientific Data, 8_, 85.

\newpage
\normalsize

`<p><strong>Abstract</strong></p>`{=html}
`\begin{abstract}`{=latex}
We present the Amsterdam Open MRI Collection (AOMIC): three datasets with multimodal (3T) MRI data including structural (T1-weighted), diffusion-weighted, and (resting-state and task-based) functional BOLD MRI data, as well as detailed demographics and psychometric variables from a large set of healthy participants (*N* = 928, *N* = 226, and *N* = 216). Notably, task-based fMRI was collected during various robust paradigms (targeting naturalistic vision, emotion perception, working memory, face perception, cognitive conflict and control, and response inhibition) for which extensively annotated event-files are available. For each dataset and data modality, we provide the data in both raw and preprocessed form (both compliant with the Brain Imaging Data Structure), which were subjected to extensive (automated and manual) quality control. All data is publicly available from the OpenNeuro data sharing platform.
`\end{abstract} \newpage`{=latex}

## Background & summary

It is becoming increasingly clear that robust effects in neuroimaging studies require very large sample sizes [@Button2013-zu; @Yarkoni2009-pz], especially when investigating between-subject effects [@Dubois2016-zz]. With this in mind, we have run several large-scale "population imaging" MRI projects over the past decade at the University of Amsterdam, with the aim to reliably estimate the (absence) of structural and functional correlates of human behavior and mental processes. After publishing several articles using these datasets [@Ramakrishnan2014-ki; @Koolschijn2015-hd; @Snoek2019-my; @Van_Elk2020-xo; @Hoogeveen2020-qp], we believe that making the data from these projects publicly available will benefit the neuroimaging community most. To this end, we present the Amsterdam Open MRI Collection (AOMIC) --- three large-scale datasets with high-quality, multimodal 3T MRI data and detailed demographic and psychometric data, which are publicly available from the OpenNeuro data sharing platform. In this article, we describe the characteristics and contents of these three datasets in a manner that complies with the guidelines of the COBIDAS MRI reporting framework [@Nichols2017-ze].

We believe that AOMIC represents a useful contribution to the growing collection of publicly available population imaging MRI datasets [@Miller2016-oi; @Van_Essen2013-df; @Mendes2019-yh; @Babayan2019-mo]. AOMIC contains a large representative dataset of the general population, "ID1000" (*N* = 928), and two large datasets with data from university students, "PIOP1" (*N* = 216) and "PIOP2" (*N* = 226; *P*opulation *I*maging *o*f *P*sychology). Each dataset contains MRI data from multiple modalities (structural, diffusion, and functional MRI), concurrently measured physiological (respiratory and cardiac) data, and a variety of well-annotated demographics (age, sex, handedness, educational level, etc.), psychometric measures (intelligence, personality), and behavioral information related to the task-based fMRI runs (see Figure \@ref(fig:fig-aomic-1) and Table \@ref(tab:tab-aomic-1) for an overview). Furthermore, AOMIC offers, in addition to the raw data, also preprocessed data from well-established preprocessing and quality control pipelines, all consistently formatted according to the Brain Imaging Data Structure [@Gorgolewski2016-in]. As such, researchers can quickly and easily prototype and implement novel secondary analyses without having to worry about quality control and preprocessing themselves.  

Due to the size and variety of the data in AOMIC, there are many ways in which it can be used for secondary analysis. One promising direction is to use the data for the development of generative and discriminative machine learning-based algorithms, which often need large datasets to train models on. Another, but related, use of AOMIC’s data is to use it as a validation dataset (rather than train-set) for already developed (machine learning) algorithms to assess the algorithm’s ability to generalize to different acquisition sites or protocols. Lastly, due to the rich set of confound variables shipped with each dataset (including physiology-derived noise regressors), AOMIC can be used to develop, test, or validate (novel) denoising methods.

```{r fig-aomic-1, fig.cap='(ref:caption-fig-aomic-1)', results='show'}
knitr::include_graphics("_bookdown_files/aomic-files/figures/figure_1.png", auto_pdf = TRUE)
```

(ref:caption-fig-aomic-1) General overview of AOMIC’s contents. Each dataset (ID1000, PIOP1, PIOP2) contains multimodal MRI data, physiology (concurrent with fMRI acquisition), demographic and psychometric data, as well as a large set of "derivatives", i.e., data derived from the original "raw" data through state-of-the-art preprocessing pipelines.

\newpage
\pagestyle{empty}
\blandscape

```{r tab-aomic-1, results='asis'}
data = suppressWarnings(read_csv('_bookdown_files/aomic-files/table_1_data.csv'))
names(data) = c('', 'ID1000', 'PIOP1', '', '', '', '', '', 'PIOP2', '', '', '')
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T, caption = 'Overview of the number of subjects per dataset and tasks.') %>%
    kable_styling(full_width = T, 
                  font_size = 10) %>%
    column_spec(column = 1, width = "5em") %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T,
             general = 'Mov: movie watching, RS: resting-state, Emo: emotion matching, G-str: gender-stroop, FP: face perception, WM: working memory, Antic: anticipation, Stop: stop-signal. Tasks without this subscript were acquired without multiband acceleration (i.e., "sequential" acquisition).')
```

\elandscape
\newpage

## Methods

In this section, we describe the details of the data acquisition for each dataset in AOMIC. We start with a common description of the MRI scanner used to collect the data. The next two sections describe the participant characteristics, data collection protocols, experimental paradigms (for functional MRI), and previous analyses separately for the ID1000 study and the PIOP studies. Then, two sections describe the recorded subject-specific variables (such as educational level, background socio-economic status, age, etc.) and psychometric measures from questionnaires and tasks (such as intelligence and personality). Finally, we describe how we standardized and preprocessed the data, yielding an extensive set of "derivatives" (i.e., data derived from the original raw data).

### Scanner details and general scanning protocol (all datasets)

Data from all three datasets were acquired on the same Philips 3T scanner (Philips, Best, the Netherlands), but underwent several upgrades in between the three studies. The ID1000 dataset was scanned on the "Intera" version, after which the scanner was upgraded to the "Achieva" version (converting a part of the signal acquisition pathway from analog to digital) on which the PIOP1 dataset was scanned. After finishing the PIOP1 study, the scanner was upgraded to the "Achieva dStream" version (with even earlier digitalization of the MR signal resulting in less noise interference), on which the PIOP2 study was scanned. All studies were scanned with a 32-channel head coil (though the head coil was upgraded at the same time as the dStream upgrade). Although not part of AOMIC, a separate dataset (dStreamUpgrade) with raw and preprocessed data (DWI, T1-weighted, and both resting-state and task-based functional MRI scans) acquired before and after the dStream upgrade using the same sequences and participants in both sessions is available on OpenNeuro [@Gorgolewski2017-uu]. In addition, unthresholded group-level temporal signal-to-noise ratio (tSNR) maps and group-level GLM maps (for both the pre-upgrade and post-upgrade data as well as the post-pre difference) are available on NeuroVault [@Gorgolewski2015-hj].

At the start of each scan session, a low resolution survey scan was made, which was used to determine the location of the field-of-view. For all structural (T1-weighted), fieldmap (phase-difference based B0 map), and diffusion (DWI) scans, the slice stack was not angled. This was also the case for the functional MRI scans of ID1000 and PIOP1, but for PIOP2 the slice stack for functional MRI scans was angled such that the eyes were excluded as much as possible in order to reduce signal dropout in orbitofrontal cortex. While the set of scans acquired for each study is relatively consistent (i.e., at least one T1-weighted anatomical scan, at least one diffusion-weighted scan, and at least one functional BOLD MRI scan), the parameters for a given scan vary slightly between the three studies. Notably, the functional MRI data from the resting-state and faces tasks from PIOP1 were acquired with multi-slice acceleration (factor 3; referred to in the current article as "multiband" acquisition), while all other functional MRI scans, including those from ID1000 and PIOP2, were acquired without multi-slice acceleration (referred to in the current article as "sequential" acquisition). The reason for reverting to sequential (instead of multiband) acquisition of the resting state scan in PIOP2 is that we did not think the reduction in tSNR observed in multiband scans outweighs the increase in number of volumes. In Supplementary Tables \@ref(tab:tab-aomic-S1)-\@ref(tab:tab-aomic-S4), the parameters for the different types of scans across all three studies are listed.

During functional MRI scans, additional physiological data was recorded. Respiratory traces were recorded using a respiratory belt (air filled cushion) bound on top of the subject's diaphragm using a velcro band. Cardiac traces were recorded using a plethysmograph attached to the subject's left ring finger. Data was transferred to the scanner PC as plain-text files (Philips "SCANPHYSLOG" files) using a wireless recorder with a sampling frequency of 496 Hz.

Experimental paradigms for the functional MRI runs were shown on a 61 $\times$ 36 cm screen using a DLP projector with a 60 Hz refresh rate (ID1000 and PIOP1) or on a Cambridge Electronics BOLDscreen 32 IPS LCD screen with a 120 Hz refresh rate (PIOP2), both placed at 113 cm distance from the mirror mounted on top of the head coil. Sound was presented via a MRConfon sound system. Experimental tasks were programmed using Neurobs Presentation (Neurobehavioral Systems Inc, Berkeley, U.S.A.) and run on a Windows computer with a dedicated graphics card. To allow subject responses in experimental tasks (PIOP1 and PIOP2 only), participants used MRI-compatible fibre optic response pads with four buttons for each hand (Cambridge Research Systems, Rochester, United Kingdom).

### ID1000 specifics

In this section, we describe the subject recruitment, subject characteristics, data collection protocol, functional MRI paradigm, and previous analyses of the ID1000 study.

#### Subjects

The data from the ID1000 sample was collected between 2010 and 2012. The faculty’s ethical committee approved this study before data collection started (EC number: 2010-BC-1345). Potential subjects were a priori excluded from participation if they did not pass a safety checklist with MRI contraindications. We recorded data from 992 subjects of which 928 are included in the dataset (see [Technical validation](#aomic-technical-validation) for details on the post-hoc exclusion procedure). Subjects were recruited through a recruitment agency (Motivaction International B.V.) in an effort to get a sample that was representative of the general Dutch population in terms of educational level [as defined by the Dutch government, @Onderwijsindeling2016-tb], but drawn from only a limited age range (19 to 26). We chose this limited age range to minimize the effect of aging on any brain-related covariates. A more detailed description of educational level and other demographic variables can be found in the section "Subject variables".

#### Data collection protocol

Prior to the experiment, subjects were informed about the goal and scope of the research, the MRI procedure, safety measures, general experimental procedures, privacy and data sharing concerns, and voluntary nature of the project (i.e., subjects were told that they could stop with the experiment at any time, without giving a reason for it). Before coming to the scan center, subjects also completed a questionnaire on background information (to determine educational level, which was used to draw a representative sample). If participants were invited they provided informed consent and completed an MRI screening checklist. Subjects then completed an extensive set of questionnaires and tests, including a general demographics questionnaire, the Intelligence Structure Test [@Vorst2010-ex; @Amthauer2001-yg], the "trait" part of the State-Trait Anxiety Inventory [STAI; @Spielberger1970-td], a behavioral avoidance/inhibition questionnaire [BIS/BAS; @Carver1994-wp; @Franken2005-jg], multiple personality questionnaires --- amongst them the MPQ [@Eigenhuis2013-xo] and the NEO-FFI [@Hoekstra1996-kv; @Van_der_Ploeg1980-tq] and several behavioral tasks. The psychometric variables of the tests included in the current dataset are described in the section "Psychometric variables".

Testing took place from 9 AM until 4 PM and on each day two subjects were tested. One subject began with the IST intelligence test, while the other subject started with the imaging part of the experiment. For the MRI part, we recorded three T1-weighted scans, three diffusion-weighted scans, and one functional (BOLD) MRI scan (in that order). The scanning session lasted approximately 60 minutes. Afterwards, the subjects switched and completed the other part. After these initial tasks, the subjects participated in additional experimental tasks, some of which have been reported in other publications [@Gazendam2015-fr; @Pinto2013-kh] and are not included in this dataset. 

#### Functional MRI paradigm

During functional MRI acquisition, subjects viewed a movie clip consisting of a (continuous) compilation of 22 natural scenes taken from the movie Koyaanisqatsi [@Reggio1982-ex] with music composed by Philip Glass. The scenes were selected because they broadly sample a set of visual parameters (textures and objects with different sizes and different rates of movement). Importantly, the focus on variation of visual parameters means, in this case, that the movie lacks a narrative and thus may be inappropriate to investigate semantic or other high-level processes.

The scenes varied in length from approximately 5 to 40 seconds with "cross dissolve" transitions between scenes. The movie clip extended 16 degrees visual angle (resolution 720 $\times$ 576, movie frame rate of 25 Hz). The onset of the movie clip was triggered by the first volume of the fMRI acquisition and had a duration of 11 minutes (which is slightly longer than the fMRI scan, i.e., 10 minutes and 38 seconds). The movie clip is available in the "stimuli" subdirectory of the ID1000 dataset (with the filename `task-moviewatching_desc-koyaanisqatsi_movie.mp4`).

#### Previous analyses

The MRI data of ID1000 has been analyzed previously by two studies. One study [@Ramakrishnan2014-ki] analyzed the functional MRI data of a subset of 20 subjects by relating features from computational models applied to the movie data to the voxelwise time series using representational similarity analysis. Another study [@Koolschijn2015-hd] analyzed the relationship between autistic traits and voxel-based morphometry (VBM, derived from the T1-weighted scans) as well as fractional anisotropy (FA, derived from the DWI scans) in a subset of 508 subjects.

### PIOP1 and PIOP2 specifics

In this section, we describe the subject recruitment, subject characteristics, data collection protocol, functional MRI paradigm, and previous analyses of the PIOP1 and PIOP2 studies. These two studies are described in a common section because their data collection protocols were very similar. Information provided in this section (including sample characteristics, sample procedure, data acquisition procedure and scan sequences) can be assumed to apply to both PIOP1 and PIOP2, unless explicitly stated otherwise. As such, these datasets can be used as train/test (or validation) partitions. The last subsection ("Differences between PIOP1 and PIOP2") describes the main differences between the two PIOP datasets.

#### Subjects

Data from the PIOP1 dataset were collected between May 2015 and April 2016 and data from the PIOP2 dataset between March 2017 and July 2017. The faculty’s ethical committee approved these studies before data collection started (PIOP1 EC number: 2015-EXT-4366, PIOP2 EC number: 2017-EXT-7568). Potential subjects were a priori excluded from participation if they did not pass a safety checklist with MRI contraindications. Data was recorded from 248 subjects (PIOP1) and 242 subjects (PIOP2), of which 216 (PIOP1) and 226 (PIOP2) are included in AOMIC (see [Technical validation](#aomic-technical-validation) for details on the post-hoc exclusion procedure). Subjects from both PIOP1 and PIOP2 were all university students (from the Amsterdam University of Applied Sciences or the University of Amsterdam) recruited through the University websites, posters placed around the university grounds, and Facebook. A description of demographic and other subject-specific variables can be found in the section "Subject variables". 

#### Data collection protocol

Prior to the research, subjects were informed about the goal of the study, the MRI procedure and safety, general experimental procedure, privacy and data sharing issues, and the voluntary nature of participation through an information letter. Each testing day (which took place from 8.30 AM until 1 PM), four subjects were tested. First, all subjects filled in an informed consent form and completed an MRI screening checklist. Then, two subjects started with the MRI part of the experiment, while the other two completed the demographic and psychometric questionnaires (described below) as well as several tasks that are not included in AOMIC.

The MRI session included a survey scan, followed by a T1-weighted anatomical scan. Then, several functional MRI runs (described below) and a single diffusion-weighted scan were recorded. Details about the scan parameters can be found in Supplementary Tables \@ref(tab:tab-aomic-S1)-\@ref(tab:tab-aomic-S4). The scan session lasted approximately 60 minutes. The scans were always recorded in the same order. For PIOP1, this was the following: *faces* (fMRI), *gender-stroop* (fMRI), T1-weighted scan, *emotion matching* (fMRI), *resting-state* (fMRI), *phase-difference* fieldmap (B0) scan, DWI scan, *working memory* (fMRI), *emotion anticipation* (fMRI). For PIOP2, this was the following: T1-weighted scan, *working memory* (fMRI), *resting-state* (fMRI), DWI scan, *stop signal* (fMRI), *emotion matching* (fMRI).

#### Functional MRI paradigms

In this section, we will describe the experimental paradigms used during fMRI acquisition. See Figure \@ref(fig:fig-aomic-2) for a visual representation of each paradigm. None of the designs were optimized for efficiency, except for the emotion anticipation task (which was optimized for efficiency to estimate the effect of each condition). All paradigms during functional MRI were started and synced to the functional MRI acquisition using a transistor-transistor logic (TTL) pulse sent to the stimulus presentation computer. 

```{r fig-aomic-2, fig.cap='(ref:caption-fig-aomic-2)', results='show'}
knitr::include_graphics("_bookdown_files/aomic-files/figures/figure_2.png", auto_pdf = TRUE)
```

(ref:caption-fig-aomic-2) A visual representation of all experimental paradigms during task-based fMRI. ISI: inter-stimulus interval. 

**Emotion matching (PIOP1+2)**. The goal of the "emotion matching" task is to measure processes related to (facial) emotion processing. The paradigm we used was based on @Hariri2000-sc. Trials were presented using a blocked design. In each trial, subjects were presented with either color images of an emotional target face (top) and two emotional probe faces (bottom left and bottom right; "emotion" condition) or a target oval (top) and two probe ovals (bottom left and bottom right; "control" condition) on top of a gray background (RGB: 248, 248, 248) and were instructed to either match the emotional expression of the target face ("emotion" condition) or the orientation or the target oval ("control" condition) as quickly as possible by pushing a button with the index finger of their left or right hand. The target and probes disappeared when the subject responded (or after 4.8 seconds). A new trial always appeared 5 seconds after the onset of each trial. In between the subject’s response and the new trial, a blank screen was shown. Trials were presented in alternating "control" and "emotion" blocks consisting of six stimuli of 5 seconds each (four blocks each, i.e., 48 stimuli in total). Stimuli always belonged to the same block, but the order of stimuli within blocks was randomized across participants. The task took 270 seconds in total (i.e., 135 volumes with a 2 second TR).

The faces always displayed either stereotypical anger or fear. Within trials, always exactly two faces portrayed the same expression. Both male and female faces and white, black, and Asian faces were used, but within a single trial, faces were always of the same sex and ethnicity category (white or Asian/black). Face pictures were derived from the NimStim Face Stimulus set [@Tottenham2009-vn]. The oval stimuli were created by pixelating the face stimuli and were approximately the same area as the face stimuli (making them color and size matched to the face stimuli) and were either presented horizontally (i.e., the long side was horizontally aligned) or vertically (i.e., the long side was vertically aligned). Within trials, always exactly two ovals were aligned in the same way.

The fMRI "event files" (with the identifier *_events*) associated with this task contain information of the trial onset (the moment the faces/ovals appeared on screen, in seconds), duration (how long the faces/ovals were presented, in seconds), trial type (either “control” or “emotion”), response time (how long it took the subject to respond, logged “n/a” in case of no response), response hand (either “left”, “right”, or “n/a” in case of no response), response accuracy (either “correct”, “incorrect”, or “miss”), orientation to match (either “horizontal”, “vertical”, or “n/a” in case of emotion trials), emotion match (either “fear”, “anger”, or “n/a” in case of control trials), gender of the faces (either “male”, “female”, of “n/a” in case of control trials), and ethnicity of the target and probe faces (either “caucasian”, “asian”, “black”, or “n/a” in case of control trials).

**Working memory task (PIOP1+2)**. The goal of the working memory task was to measure processes related to visual working memory. The paradigm we used was based on @Pessoa2002-tb. Trials were presented using a fixed event-related design, in which trial order the same for each subject. Trials belonged to one of three conditions: “active (change)”, “active (no change)”, or “passive”. Each trial consisted of six phases: an alert phase (1 second), an encoding phase (1 second), a retention phase (2 seconds), a test phase (1 second), a response phase (1 second), and an inter-stimulus interval (0-4 seconds). Subjects were instructed to keep focusing on the fixation target, which was shown throughout the entire trial, and completed a set of practice trials before the start of the actual task. The task took 324 seconds in total (i.e., 162 volumes with a 2 second TR).

In all trial types, trials started with an alert phase: a change of color of the fixation sign (a white plus sign changing to green, RGB [0, 255, 0]), lasting for 1 second. In the encoding phase, for “active” trials, an array of six white bars with a size of 2 degrees visual angle with a random orientation (either 0, 45, 90, or 135 degrees) arranged in a circle was presented for 1 second. This phase of the trial coincided with a change in background luminance from black (RGB: [0, 0, 0]) to gray (RGB: [120, 120, 120]). For “passive” trials, only the background luminance changed (but no bars appeared) in the encoding phase. In the subsequent retention phase, for all trial types, a fixation cross was shown and the background changed back to black, lasting 2 seconds. In the test phase, one single randomly chosen bar appeared (at one of the six locations from the encoding phase) which either matched the original orientation (for “active (no change)” trials) or did not match the original orientation (for “active (change)” trials), lasting for 1 second on a gray background. For “passive” trials, the background luminance changed and, instead of a bar, the cue “respond left” or “respond right” was shown in the test phase. In the response phase, lasting 1 second, the background changed back to black and, for “active” trials, subjects had to respond whether the array changed (button press with right index finger) or did not change (button press with left index finger). For “passive” trials, subjects had to respond with the hand that was cued in the test phase. In the inter-stimulus interval (which varied from 0 to 4 seconds), only a black background with a fixation sign was shown. 

In total, there were 8 “passive” trials, 16 “active (change)” and “active (no change)” trials, in addition to 20 “null” trials of 6 seconds (which are equivalent to an additional inter-stimulus interval of 6 seconds). The sequence trials was, in terms of conditions (active, passive, null)  exactly the same for all participations in both PIOP1 and PIOP2, but which bar or cue was shown in the test phase was chosen randomly.

The fMRI event files associated with this task contain information of the trial onset (the moment when the alert phase started, in seconds), duration (from the alert phase up to and including the response phase, i.e., always 6 seconds), trial type (either “active (change)”, “active (no change)”, or “passive”; “null” trials were not logged), response time (how long it took the subject to respond, “n/a” in case of no response), response hand (either “left”, “right”, or “n/a” in case of no response), and response accuracy (either “correct”, “incorrect”, or “miss”). Note that, in order to model the response to one or more phases of the trial, the onsets and durations should be adjusted accordingly (e.g., to model the response to the retention phase, add 2 seconds to all onsets and change the duration to 2 seconds).

**Resting state (PIOP1+2)**. During the resting state scans, participants were instructed to keep their gaze fixated on a fixation cross in the middle of the screen with a gray background (RGB: [150, 150, 150]) and to let their thoughts run freely. Eyetracking data was recorded during this scan but is not included in this dataset. The resting state scans lasted 6 minutes (PIOP1; i.e., 480 volumes with a 0.75 second TR) and 8 minutes (PIOP2; i.e., 240 volumes with a 2 second TR).

**Face perception (PIOP1)**. The face perception task was included to measure processes related to (emotional) facial expression perception. Trials were presented using an event-related design, in which trial order was randomized per subject. In each trial, subjects passively viewed dynamic facial expressions (i.e., short video clips) taken from the Amsterdam Facial Expression Set [ADFES; @Van_der_Schalk2011-bq], which displayed either anger, contempt, joy, or pride, or no expression (“neutral”). Each clip depicted a facial movement from rest to a full expression corresponding to one of the four emotions, except for “neutral” faces, which depicted no facial movement. All clips lasted 2 seconds and contained either North-European or Mediterranean models, all of whom were female. After each video, a fixed inter-stimulus interval of 5 seconds followed. Each emotional facial expression (including “neutral”) was shown 6 times (with different people showing the expression each time), except for one, which was shown 9 times. Which emotional expression (or “neutral”) was shown an extra three times was determined randomly for each subject. Importantly, the three extra presentations always contained the same actor and were always presented as the first three trials. This was done in order to make it possible to evaluate the possible effects of stimulus repetition. The task took 247.5 seconds in total (i.e., 330 volumes with a 0.75 second TR).

The fMRI event files associated with this task contain information of the trial onset (the moment when the clip appeared on screen, in seconds), duration (of the clip, i.e., always 2 seconds), trial type (either “anger”, “joy”, “contempt”, “pride”, or “neutral”), sex of the model (all “female”), ethnicity of the model (either “North-European” or “Mediterranean”), and the ADFES ID of the model.

**Gender-stroop task (PIOP1 only)**. The goal of the gender-stroop task was to measure processes related to cognitive conflict and control [@Milham2003-zc; see also @Hoogeveen2020-qp for an investigation of these processes using the PIOP1 gender-stroop data]. We used the face-gender variant of the Stroop task [which was adapted from @Egner2010-ot], often referred to as the “gender-stroop” task. In this task, pictures of twelve different male and twelve different female faces are paired with the corresponding (i.e., congruent) or opposite (i.e., incongruent) label. For the labels, we used the Dutch words for “man”, “sir”, “woman”, and “lady” using either lower or upper case letters. The labels were located just above the head of the face. Trials were presented using an event-related design, in which trial order was randomized per subject. The task took 490 seconds in total (i.e., 245 volumes with a 2 second TR).

On each trial, subjects were shown a face-label composite on top of a gray background (RGB: [105, 105, 105]) for 0.5 seconds, which was either “congruent” (same face and label gender) or “incongruent” (different face and label gender). Stimulus presentation was followed by an inter-stimulus interval ranging between 4 and 6 seconds (in steps of 0.5 seconds). Subjects were always instructed to respond to the gender of the pictured face, ignoring the distractor word, as fast as possible using their left index finger (for male faces) or right index finger (for female faces). There were 48 stimuli for each condition (“congruent” and “incongruent”).

The fMRI event files associated with this task contain information of the trial onset (the moment when the face-label composite appeared on screen, in seconds), duration (of the face-label composite, i.e., always 0.5 seconds), trial type (either “incongruent” or “congruent”), gender of the face (either “male or “female”), gender of the word (either “male” or “female”), response time (in seconds), response hand (either “left”, “right”, or “n/a” in case of no response), response accuracy (either “correct”, “incorrect”, or “miss”).

**Emotion anticipation task (PIOP1 only)**. We included the emotion anticipation task to measure processes related to (emotional) anticipation and curiosity. The paradigm was based on paradigms previously used to investigate (morbid) curiosity [@Oosterwijk2020-uf; @Oosterwijk2017-dw]. Trials were presented using an event-related design, in which trial order was randomized per subject. In this task, subjects viewed a series of trials containing a cue and an image. The cue could either signal an 80% chance of being followed by a negatively valenced image (and a 20% chance of a neutral image) or an 80% chance of being followed by a neutral image (and a 20% change of a negatively valenced image). The cue was shown on top of a black background for 2 seconds, followed by a fixed interval of 3 seconds. After this interval, either a negative or neutral image was shown for 3 seconds, with a frequency that corresponds to the previously shown cue. In other words, for all trials with, for example, a cue signalling an 80% chance of being followed by a neutral image, it was in fact followed by a neutral image in 80% of the times. After the image, a fixed inter-stimulus interval of five seconds followed. In total, 15 unique negative images and 15 unique neutral images were shown, of which 80% (i.e., 12 trials) was preceded by a “valid” cue. Which stimuli were paired with valid or invalid cues was determined randomly for each subject. The order of the trials, given the four possible combinations (valid cue + negative image, invalid cue + negative image, valid cue + neutral image, invalid cue + neutral image), was drawn randomly from one of four possible sequences, which were generated using OptSeq (https://surfer.nmr.mgh.harvard.edu/optseq/) to optimize the chance of finding a significant interaction between cue type and image valence. The task took 400 seconds in total (i.e., 200 volumes with a 2 second TR).

The cue was implemented as a pie chart with the probability of a neutral image in blue and the probability of the negative image in red with the corresponding labels and probabilities (e.g., “negative 20%”) superimposed for clarity. The images were selected from the IAPS database37 and contained images of mutilation, violence, and death (negative condition) and of people in neutral situations (neutral condition).

The fMRI event files associated with this task contain information on the trial onset (the moment when either the cue or image appeared on the screen, in seconds), duration (of either the cue or image), and trial type. Trial type was logged separately for the cues (“negative”, indicating 80% probability of a negative image, and “neutral”, indicating 80% probability of a neutral image) and images (“negative” or “neutral”).

**Stop-signal task (PIOP2 only)**. The stop-signal task was included to measure processes related to response inhibition. This specific implementation of the stop-signal paradigm was based on @Jahfari2015-ix. Trials were presented using an event-related design, in which trial order was randomized per subject. Subjects were presented with trials (*n* = 100) in which an image of either a female or male face (chosen from 9 exemplars) was shown for 500 ms on a black background. Subjects had to respond whether the face was female (right index finger) or male (left index finger) as quickly and accurately as possible, except when an auditory stop signal (a tone at 450 Hz for 0.5 seconds) was presented (on average 33% of the trials). The delay in presentation of the stop signal (i.e., the “stop signal delay”) was at start of the experiment 250 milliseconds, but was shortened with 50 ms if stop performance, up to that point, was better than 50% accuracy and shortened with 50 ms if it was worse. Each trial had a duration of 4000 ms and was preceded by a jitter interval (0, 500, 1000 or 1500 ms). If subjects responded too slow, or failed to respond an additional feedback trial of 2000 ms was presented. Additionally 10% (on average) null trials with a duration of 4000 ms were presented randomly. Note that due to this additional feedback trial and the fact that subjects differed in how many feedback trials they received, the fMRI runs associated with this task differ in length across subjects (i.e., the scan was manually stopped after 100 trials; minimum: 210 volumes, maximum: 250 volumes, median: 224 volumes, corresponding to a duration of 448 seconds with a 2 second TR).

The fMRI event files associated with this task contain information on the trial onset (the moment when a face was presented, in seconds), duration (always 0.5083 seconds), trial type (go, succesful_stop, unsuccesful_stop), if and when a stop signal was given (in seconds after stimulus onset), if and when a response time was given (in seconds after stimulus onset), response of the subject (left, right), and the sex of the image (male, female).

#### Previous analyses

The PIOP1 data has been previously analyzed by three studies. One methodological study [@Snoek2019-my] used the T1-weighted data (VBM, specifically) and DWI data (tract-based spatial statistics, TBSS, specifically) and the self-reported biological sex of subjects to empirically test an approach to correct for confounds in decoding analyses of neuroimaging data. Two other studies analyzed the participants’ religiosity scores. One study [@Van_Elk2020-xo] performed a voxelwise VBM analysis on the religiosity scores while the other study [@Hoogeveen2020-qp] related the religiosity data to the *incongruent - congruent* activity differences from the gender-stroop functional MRI data. Notably, both studies were pre-registered. There have been no (published) analyses on the PIOP2 data. 

#### Differences between PIOP1 and PIOP2

One important difference between PIOP1 and PIOP2 is that they are not the same in terms of task-based functional MRI they acquired. Specifically, the “emotion anticipation”, “faces”, and “gender stroop” tasks were only acquired in PIOP1 and the “stop signal” task was only acquired in PIOP2 (see Table \@ref(tab:tab-aomic-1)). In terms of scan sequences, the only notable difference between PIOP1 and PIOP2 is that the resting-state functional MRI scan in PIOP1 was acquired with multiband factor 3 (resulting in a TR of 750 ms) while the resting-state functional MRI scan in PIOP2 was acquired without multiband (i.e., with a sequential acquisition, resulting in a TR of 2000 ms; see Supplementary Tables \@ref(tab:tab-aomic-S1)-\@ref(tab:tab-aomic-S4)). Additionally, because PIOP1 was acquired before the dStream upgrade and PIOP2 after the upgrade, the PIOP1 data generally has a lower tSNR but this does not seem to lead to substantial differences in effects (see [Technical Validation](#aomic-technical-validation)).

### Subject variables (all datasets)

In AOMIC, several demographic and other subject-specific variables are included per dataset. Below, we describe all variables in turn. Importantly, all subject variables and psychometric variables are stored in the participants.tsv file in each study’s data repository. Note that missing data in this file is coded as “n/a”. In Supplementary Table \@ref(tab:tab-aomic-S5), all variables and associated descriptions are listed for convenience.

#### Age

We asked subjects for their date of birth at the time they participated. From this, we computed their age rounded to the nearest quartile (for privacy reasons). See Table \@ref(tab:tab-aomic-2) for descriptive statistics of this variable. 

```{r tab-aomic-2, results='asis'}
data = suppressWarnings(read_csv('_bookdown_files/aomic-files/table_2_data.csv'))
colnames = colnames(data)
names(data) = c('', colnames[-1])
options(knitr.kable.NA = '')
kbl(data, booktabs = T, caption = 'Descriptive statistics for biological sex, age, and education level for all three datasets.') %>%
    kable_styling(full_width = T, font_size = 10) %>%
    column_spec(column = 1, width = "3em")
```

#### Biological sex and gender identity

In all three studies, we asked subjects for their biological sex (of which the options were either male or female). For the ID1000 dataset, after the first 400 subjects, we additionally asked to what degree subjects felt male and to what degree they felt female (i.e., gender identity; separate questions, 7 point likert scale, 1 = not at all, 7 = strong). The exact question in Dutch was: "ik voel mij een man", "ik voel mij een vrouw". This resulted in 0.3% of subjects scoring opposite on gender identity compared to their biological sex and 92% of females and 90% of males scoring conformable with their sex.

#### Sexual orientation

For the ID1000 dataset, after the first 400 subjects, we additionally asked to what degree subjects were attracted to men and women (both on a 7 point likert scale, 1 = not at all, 7 = strong). The exact question in Dutch was: "ik val op mannen" and "ik val op vrouwen". Of the 278 subjects with a male sex 7.6% indicated to be attracted to men (score of 4 or higher), of the 276 subjects with a female sex 7.2% indicated to be attracted to women (score of 4 or higher). Of the 554 subjects who completed these questions 0.4% indicated not be attracted to either men or women and 0.9% indicated to be strongly attracted to both men and women. 

#### BMI

Subjects were asked for (PIOP1 and PIOP2) or we measured (ID1000) subjects’ height and weight on the day of testing, from which we calculated their body-mass-index (BMI), which we rounded to the nearest integer. Note that height and weight are not included in AOMIC (for privacy reasons), but BMI is.

#### Handedness

Subjects were asked for their dominant hand. In ID1000, the options were “left” and “right” (left: 102, right: 826). For PIOP1 and PIOP2 we also included the option “both” (PIOP1, left: 24, right: 180, ambidextrous: 5, n/a: 7; PIOP2, left: 22, right: 201, ambidextrous: 1, n/a: 2). 

#### Educational level / category

Information about subjects’ educational background is recorded differently for ID1000 and the PIOP datasets, so they are discussed separately. Importantly, while we included data on educational *level* for the ID1000 dataset, we only include data on educational *category* for the PIOP datasets because they contain little variance in terms of educational level.

**Educational level (ID1000)**. As mentioned, for the ID1000 dataset we selected subjects based on their educational level in order to achieve a representative sample of the Dutch population (on that variable). We did this by asking for their highest completed educational level. In AOMIC, however, we report the educational level (three point scale: low, medium, high) on the basis of the completed *or* current level of education (which included the scenario in which the subject was still a student), which we believe reflects educational level for our relatively young (19-26 year old) better. Note that this difference in criterion causes a substantial skew towards a higher educational level in our sample relative to the distribution of educational level in the Dutch population (see Table \@ref(tab:tab-aomic-3)).

```{r tab-aomic-3, results='asis'}
data = read_csv('_bookdown_files/aomic-files/table_3_data.csv')
kbl(data, booktabs = T, longtable = T, caption = 'Distribution of educational level in the Dutch population (in 2010) and in ID1000.') %>%
    kable_styling(full_width = T, font_size = 10) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T,
             general = 'The data from the education level of subjects’ parents was used to compute background socio-economic status.')
```

**Educational category (PIOP1+2)**. Relative to ID1000, there is much less variance in educational level within the PIOP datasets as these datasets only contain data from university students. As such, we only report whether subjects were, at the time of testing, studying at the Amsterdam University of Applied Sciences (category: “applied”) or at the University of Amsterdam (category: “academic”).

**Background socio-economic status (SES)**. In addition to reporting their own educational level, subjects also reported the educational level (see Table \@ref(tab:tab-aomic-3)) of their parents and the family income in their primary household. Based on this information, we determined subjects’ background social economical status (SES) by adding the household income --- defined on a three point scale (below modal income, 25%: 1, between modal and 2 × modal income, 57%: 2, above 2 × modal income, 18%: 3) --- with the average educational level of the parents --- defined on a three point scale (low: 1, medium: 2, high: 3). This revealed that, while the educational level of the subjects is somewhat skewed towards “high”, SES is well distributed across the entire spectrum (see Table \@ref(tab:tab-aomic-4)).

```{r tab-aomic-4, results='asis'}
data = read_csv('_bookdown_files/aomic-files/table_4_data.csv')
kbl(data, booktabs = T, caption = 'Distribution of background SES.') %>%
    kable_styling(full_width = F, font_size = 10) 
```

#### Religion (PIOP1 and ID1000 only)

For both the PIOP1 and ID1000 datasets, we asked subjects whether they considered themselves religious, which we include as a variable for these datasets (recoded into the levels “yes” and “no”). Of the subjects that participated in the PIOP1 study 18.0% indicated to be religious, for the subjects in the ID1000 projects this was 21.2%. For the ID1000 dataset we also asked subjects if they were raised religiously (N = 928, 34.1%) and to what degree religion played a daily role in their lives (in Dutch, “Ik ben dagelijks met mijn geloof bezig”, 5 point likert scale, 1 = not at all applicable, 5 = very applicable).

### Psychometric variables (all datasets)

**BIS/BAS (ID1000 only)**. The BIS/BAS scales are based on the idea that there are two general motivational systems underlying behavior and affect: a behavioral activation system (BAS) and a behavioral inhibition system (BIS). The scales of the BIS/BAS attempt to measure these systems [@Carver1994-wp]. The BAS is believed to measure a system that generates positive feedback while the BIS is activated by conditioned stimuli associated with punishment. 

The BIS/BAS questionnaire consists of 20 items (4 point scale). The BIS scale consists of 7 items. The BAS scale consists of 13 items and contains three subscales, related to impulsivity (BAS-Fun, 4 items), reward responsiveness (BAS-Reward, 5 items) and the pursuit of rewarding goals (BAS-Drive, 4 items). 

**STAI-T (ID1000)**. We used the STAI [@Spielberger1970-td; @Van_der_Ploeg1980-tq] to measure trait anxiety (STAI-*T*). The questionnaire consists of two scales (20 questions each) that aim to measure the degree to which anxiety and fear are a trait and part of the current state of the subject; subjects only completed the trait part of the questionnaire, which we include in the ID1000 dataset.

**NEO-FFI (all datasets)**. The NEO-FFI is a Big 5 personality questionnaire that consists of 60 items [12 per scale; @Hoekstra1996-kv; @McCrae1987-ww]. It measures neuroticism (“NEO-N”), extraversion (“NEO-E”), openness to experience (“NEO-O”), agreeableness (“NEO-A”), and conscientiousness (“NEO-C”). Neuroticism is the opposite of emotional stability, central to this construct is nervousness and negative emotionality. Extraversion is the opposite of introversion, central to this construct is sociability --- the enjoyment of others' company. Openness to experience is defined by having original, broad interests, and being open to ideas and values. Agreeableness is the opposite of antagonism. Central to this construct are trust, cooperation and dominance. Conscientiousness is the opposite of un-directedness. Adjectives associated with this construct are thorough, hard-working and energetic. 

**IST (ID1000 only)**. The Intelligence Structure Test [IST; @Vorst2010-ex; @Amthauer2001-yg] is an intelligence test measuring crystallized intelligence, fluid intelligence, and memory, through tests using verbal, numerical, and figural information. The test consists of 590 items. The three measures (crystallized intelligence, fluid intelligence, and memory) are strongly positively correlated (between $r = .58$ and $r = .68$) and the sum score of these values form the variable “total intelligence”.

**Raven’s matrices (PIOP only)**. As a proxy for intelligence, subjects performed the 36 item version (set II) of the Raven’s Advanced Progressive Matrices Test [@Raven1998-om; @Raven2000-hs]. We included the sum-score (with a maximum score of 36) in the PIOP datasets.

### Data standardization, preprocessing, and derivatives {#aomic-derivatives}

In this section, we describe the data curation and standardization process as well as the preprocessing applied to the standardized data and the resulting “derivatives” (see Figure \@ref(fig:fig-aomic-3) for a schematic overview). This section does not describe this process separately for each dataset, because they are largely identically standardized and (pre)processed. Exceptions to this will be explicitly mentioned. In this standardization process, we adhered to the guidelines outlined in the Brain Imaging Data Structure [BIDS, v1.2.2; @Gorgolewski2016-in], both for the “raw” data as well as the derivatives (whenever BIDS guidelines exist for that data or derivative modality).

```{r fig-aomic-3, fig.cap='(ref:caption-fig-aomic-3)', results='show'}
knitr::include_graphics("_bookdown_files/aomic-files/figures/figure_3.png", auto_pdf = TRUE)
```

(ref:caption-fig-aomic-3) Overview of the types of data and “derivatives" included in AOMIC and the software packages used to preprocess and analyze them.

#### Raw data standardization

Before subjecting the data to any preprocessing pipeline, we converted the data to BIDS using the in-house developed package bidsify (see [Code availability](#aomic-code-availability) section for more details about the software used in the standardization process). The “BIDSification” process includes renaming of files according to BIDS convention, conversion from Philips PAR/REC format to compressed nifti, removal of facial characteristics from anatomical scans (“defacing”), and extraction of relevant metadata into JSON files.

The results from the standardization process were checked using the *bids-validator* software package, which revealed no validation errors. However, the validation process raised several warnings about possible issues with the datasets (as shown in the BIDS validation section in their OpenNeuro repositories), which we explain in turn. 

First, all three datasets contain subjects with incomplete data (i.e., missing MRI or physiology data), which causes the "Not all subjects contain the same files" warning. Second, the *bids-validator* issues a warning that “[n]ot all subjects/sessions/runs have the same scanning parameters”. One cause for this warning (in PIOP1 and PIOP2) is that the time to repetition (TR) parameter of some DWI scans varies slightly (PIOP1: *min* = 7382 ms, *max* = 7700, *median* = 7390; PIOP2: *min* = 7382, *max* = 7519, *median* = 7387), which is caused by acquiring the DWI data with the shortest possible TR (i.e., TR = “shortest” setting on Philips scanners; see Supplementary Tables \@ref(tab:tab-aomic-S1)-\@ref(tab:tab-aomic-S4)). Because the shortest possible TR depends on the exact angle of the slice box, the actual TR varies slightly from scan to scan. Notably, this warning is absent for the ID1000 dataset, because the TR value in the nifti file header is incorrect (i.e., it is set to 1 for each scan). Like the DWI scans in PIOP1 and PIOP2, the DWI scans from ID1000 were acquired with the shortest possible TR, resulting in slightly different TRs from scan to scan (*min* = 6307, *max* = 6838, *median* = 6312). The correct TR values in seconds for each DWI scan in ID1000 was added to the dataset’s *participants.tsv* file (with the column names “DWI_TR_run1”, “DWI_TR_run2”, and “DWI_TR_run3”).

In addition, the functional MRI scans from ID1000 were cropped in the axial and coronal direction by conservatively removing axial slices with low signal intensity in order to save disk space, causing slightly different dimensions across participants. Finally, in PIOP2, the functional MRI scans from the stop-signal task differ in the exact number of volumes (*min* = 210, *max* = 250, *median* = 224) because the scan was stopped manually after the participant completed the task (which depended on their response times).

#### Anatomical and functional MRI preprocessing

Results included in this manuscript come from preprocessing performed using *Fmriprep* version 1.4.1 [RRID:SCR_016216; @Esteban2019-ri; @Esteban2020-qw], a Nipype based tool [RRID:SCR_002502; @Gorgolewski2011-aa; @Gorgolewski2017-gb]. Each T1w (T1-weighted) volume was corrected for INU (intensity non-uniformity) using *N4BiasFieldCorrection* v2.1.0 [@Tustison2010-tk] and skull-stripped using *antsBrainExtraction.sh* v2.1.0 (using the OASIS template). Brain surfaces were reconstructed using recon-all from *FreeSurfer* v6.0.1 [RRID:SCR_001847; @Dale1999-rk], and the brain mask estimated previously was refined with a custom variation of the method to reconcile ANTs-derived and FreeSurfer-derived segmentations of the cortical gray-matter of Mindboggle [RRID:SCR_002438; @Klein2017-su]. Spatial normalization to the ICBM 152 Nonlinear Asymmetrical template version 2009c [RRID:SCR_008796; @Fonov2009-sr] was performed through nonlinear registration with the *antsRegistration* tool of ANTs v2.1.0 [RRID:SCR_004757; @Avants2008-bv], using brain-extracted versions of both T1w volume and template. Brain tissue segmentation of cerebrospinal fluid (CSF), white-matter (WM) and gray-matter (GM) was performed on the brain-extracted T1w using FSL *fast* [FSL v5.0.9, RRID:SCR_002823; @Zhang2001-wa].

Functional data was not slice-time corrected. Functional data was motion corrected using *mcflirt* [FSL v5.0.9; @Jenkinson2002-wm] using the average volume after a first-pass motion correction procedure as the reference volume and normalized correlation as the image similarity cost function. "Fieldmap-less" distortion correction was performed by co-registering the functional image to the same-subject T1w image with intensity inverted [@Huntenburg2014-ps; @Wang2017-nk], constrained with an average fieldmap template [@Treiber2016-mc], implemented with *antsRegistration* (ANTs). Note that this fieldmap-less method was used even for PIOP2, which contained a phase-difference (B0) fieldmap, because we observed that Fmriprep’s fieldmap-based method led to notably less accurate unwarping than its fieldmap-less method.

Distortion-correction was followed by co-registration to the corresponding T1w using boundary-based registration [@Greve2009-da] with 6 degrees of freedom, using *bbregister* (FreeSurfer v6.0.1). Motion correcting transformations, field distortion correcting warp, BOLD-to-T1w transformation and T1w-to-template (MNI) warp were concatenated and applied in a single step using *antsApplyTransforms* (ANTs v2.1.0) using Lanczos interpolation.

Physiological noise regressors were extracted by applying *CompCor* [@Behzadi2007-eb]. Principal components were estimated for the two *CompCor* variants: temporal (*tCompCor*) and anatomical (*aCompCor*). A mask to exclude signal with cortical origin was obtained by eroding the brain mask, ensuring it only contained subcortical structures. Six *tCompCor* components were then calculated including only the top 5% variable voxels within that subcortical mask. For *aCompCor*, six components were calculated within the intersection of the subcortical mask and the union of CSF and WM masks calculated in T1w space, after their projection to the native space of each functional run. Framewise displacement [@Power2014-gh] was calculated for each functional run using the implementation of *Nipype*.

Many internal operations of Fmriprep use *Nilearn* [RRID:SCR_001362; @Abraham2014-ef], principally within the BOLD-processing workflow. For more details of the pipeline see 
https://fmriprep.readthedocs.io/en/1.4.1/workflows.html.

#### Diffusion MRI (pre)processing

DWI scans were preprocessed using a custom pipeline combining tools from MRtrix3 [@Tournier2019-hh] and FSL. Because we acquired multiple DWI scans per participant in the ID1000 study (but not in PIOP1 and PIOP2), we concatenated these files as well as the diffusion gradient table (*bvecs*) and b-value information (*bvals*) prior to preprocessing. Using MRtrix3, we denoised the diffusion-weighted data using *dwidenoise* [@Veraart2016-zi; @Veraart2016-rv], removed Gibbs ringing artifacts using *mrdegibbs* [@Kellner2016-xb], and performed eddy current and motion correction using *dwipreproc*. Notably, *dwipreproc* is a wrapper around the GPU-accelerated (CUDA v9.1) FSL tool *eddy* [@Andersson2016-pg]. Within *eddy*, we used a quadratic first-level (*--flm=quadratic*) and linear second-level model (*--slm=linear*) and outlier replacement [@Andersson2016-nm] with default parameters (*--repol*). Then, we performed bias correction using *dwibiascorrect* (which is based on ANTs; v2.3.1), extracted a brain mask using *dwi2mask* [@Dhollander2016-dx], and corrected possible issues with the diffusion gradient table using *dwigradcheck* [@Jeurissen2014-cd].

After preprocessing, using MRtrix3 tools, we fit a diffusion tensor model on the preprocessed diffusion-weighted data using weighted linear least squares (with 2 iterations) as implemented in *dwi2tensor* [@Veraart2013-ya]. From the estimated tensor image, a fractional anisotropy (FA) image was computed and a map with the first eigenvectors was extracted using *tensor2metric*. Finally, a population FA template was computed using *population_template* (using an affine and an additional non-linear registration).

The following files are included in the DWI derivatives: a binary brain mask, the preprocessed DWI data as well as preprocessed gradient table (*bvec*) and b-value (*bval*) files, outputs from the eddy correction procedure (for quality control purposes; see [Technical validation](#aomic-technical-validation) section), the estimated parameters from the diffusion tensor model, the eigenvectors from the diffusion tensor model, and a fractional anisotropy scalar map computed from the eigenvectors. All files are named according to BIDS Extension Proposal 16 (BEP016: diffusion weighted imaging derivatives).

#### Freesurfer morphological statistics

In addition to the complete Freesurfer directories containing the full surface reconstruction per participant, we provide a set of tab-separated values (TSV) files per participant with several morphological statistics per brain region for four different anatomical parcellations/segmentations. For cortical brain regions, we used two atlases shipped with Freesurfer: the Desikan-Killiany [*aparc* in Freesurfer terms; @Desikan2006-gh] and Destrieux [*aparc.a2009* in Freesurfer terms; @Destrieux2010-rd] atlases. For these parcellations, the included morphological statistics are volume in mm$^3$, area in mm$^2$, thickness in mm, and integrated rectified mean curvature in mm$^{-1}$. For subcortical and white matter brain regions, we used the results from the subcortical segmentation (*aseg* in Freesurfer terms) and white matter segmentation (*wmparc* in Freesurfer terms) done by Freesurfer. For these parcellations, the included morphological statistics are volume in mm$^3$ and average signal intensity (arbitrary units). The statistics were extracted from the Freesurfer output directories using the Freesufer functions *asegstats2table* and *aparcstats2table* and further formatted using custom Python code. The TSV files (and accompanying JSON metadata files) are formatted according to BIDS Extension Proposal 11 (BEP011: structural preprocessing derivatives).

#### Voxel-based morphology

In addition to the Fmriprep-preprocessed anatomical T1-weighted scans, we also provide voxelwise gray matter volume maps estimated using voxel-based morphometry (VBM). We used a modified version of the FSL VBM pipeline [http://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FSLVBM; @Douaud2007-sw], an optimised VBM protocol [@Good2001-kv] carried out with FSL tools [@Smith2004-sc]. We skipped the initial brain-extraction stage (*fslvbm_1_bet*) and segmentation stage (first part of *fslvbm_3_proc*) and instead used the probabilistic gray matter segmentation file (in native space) from *Fmriprep* (i.e., *label-GM_probseg.nii.gz* files) directly. These files were registered to the MNI152 standard space using non-linear registration [@Andersson2007-st]. The resulting images were averaged and flipped along the x-axis to create a left-right symmetric, study-specific grey matter template. Second, all native grey matter images were non-linearly registered to this study-specific template and "modulated" to correct for local expansion (or contraction) due to the non-linear component of the spatial transformation.

#### Physiological noise processing

Physiology files were converted to BIDS-compatible compressed TSV files using the *scanphyslog2bids* package (see [Code availability](#aomic-code-availability)). Each TSV file contains three columns: the first contains the cardiac trace, the second contains the respiratory trace, and the third contains the volume onset triggers (binary, where 1 represents a volume onset). Each TSV file is accompanied by a JSON metadata file with the same name, which contains information about the start time of the physiology recording relative to the onset of the first volume. Because the physiology recording always starts before the fMRI scan starts, the start time is always negative (e.g., a start time of -42.01 means that the physiology recording started 42.01 seconds before the onset of the first volume). After conversion to BIDS, the estimated volume triggers and physiology traces were plotted, visually inspected for quality, and excluded if either of the physiology traces had missing data for more than ten seconds or if the volume triggers could not be estimated.

The physiology data was subsequently used to estimate fMRI-appropriate nuisance regressors using the *TAPAS PhysIO* package [@Kasper2017-lp; see Code availability]. Using this package, we specifically estimated 18 “RETROICOR” regressors [@Glover2000-or] based on a Fourier expansion of cardiac (order: 2) and respiratory (order: 3) phase and their first-order multiplicative terms [as defined in @Harvey2008-nt]. In addition, we estimated a heart-rate variability (HRV) regressor by convolving the cardiac trace with a cardiac response function [@Chang2009-vu] and a respiratory volume by time (RVT) regressor by convolving the respiratory trace with a respiration response function [@Birn2008-ti].

## Data Records

### Data formats and types

In AOMIC, the majority of the data is stored in one of four formats. First, all volumetric (i.e., 3D or 4D) MRI data is stored in compressed “NIfTI” files (NIfTI-1 version; extension: *.nii.gz*). NIfTI files contain both the data and metadata (stored in the header) and can be loaded into all major neuroimaging analysis packages and programming languages using, e.g., the *nibabel* package for Python (https://nipy.org/nibabel), the *oro.nifti* package in R (https://cran.r-project.org/web/packages/oro.nifti), and natively in Matlab (version R2017b and higher). Second, surface (i.e., vertex-wise) MRI data is stored in “Gifti” files (https://www.nitrc.org/projects/gifti; extension: *.gii*). Like NIfTI files, Gifti files contain both data and metadata and can be loaded in several major neuroimaging software packages (including Freesurfer, FSL, AFNI, SPM, and Brain Voyager) and programming languages using, e.g., the *nibabel* package for Python and the *gifti* package for R (https://cran.rstudio.com/web/packages/gifti).

Third, data organized as tables (i.e., observations in rows and properties in columns), such as physiological data and task-fMRI event log files, are stored in tab-separated values (TSV) files, which contain column names as the first row. TSV files can be opened using spreadsheet software (such as Microsoft Excel or Libreoffice Calc) and read using most major programming languages. Fourth, (additional) metadata is stored as key-value pairs in plain-text JSON files. A small minority of data in AOMIC is stored using different file formats (such as *hdf5* for composite transforms of MRI data and some Freesurfer files), but these are unlikely to be relevant for most users.

Apart from data *formats*, we can distinguish different data *types* within AOMIC. Following BIDS convention, data types are distinguished based on an “identifier” at the end of the file name (before the extension). For example, T1-weighted files (e.g., *sub-0001_T1w.nii.gz*) are distinguished by the *_T1w* identifier and event log files for task-based functional MRI data (e.g., *sub-001_task-workingmemory_acq-seq_events.tsv*) are distinguished by the *_events* identifier. All data types and associated identifiers within AOMIC are listed in Supplementary Table \@ref(tab:tab-aomic-S6).

### Data repositories used

Data from AOMIC can be subdivided into two broad categories. The first category encompasses all subject-level data, both raw data and derivatives. The second category encompasses group-level aggregates of data, such as an average (across subjects) tSNR map or group-level task fMRI activation maps. Data from these two categories are stored in separate, dedicated repositories: subject-level data is stored on OpenNeuro [https://openneuro.org; @Gorgolewski2017-uu]
and the subject-aggregated data is stored on NeuroVault [https://neurovault.org; @Gorgolewski2015-hj]. Data from each dataset --- PIOP1, PIOP2, and ID1000 --- are stored in separate repositories on OpenNeuro [@Snoek2020-id1000; @Snoek2020-piop1; @Snoek2020-piop2] and NeuroVault [@Snoek2020n-id1000; @Snoek2020n-piop1; @Snoek2020n-piop2]. URLs to these repositories for all datasets can be found in Table \@ref(tab:tab-aomic-5). Apart from the option to download data using a web browser, we provide instructions to download the data programmatically on https://nilab-uva.github.io/AOMIC.github.io.

```{r tab-aomic-5, results='asis'}
data = read_csv('_bookdown_files/aomic-files/table_5_data.csv')
kbl(data, booktabs = T, longtable = T, caption = 'Data repository identifiers for subject data (OpenNeuro) and group-level data (NeuroVault).') %>%
    kable_styling(full_width = T, font_size = 10) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = 'To go to the OpenNeuro web repositories, prefix the OpenNeuro ID with "https://openneuro.org/datasets/". To go to the NeuroVault web repositories, prefix the NeuroVault ID with "https://neurovault.org/collections/".')
```

#### Data anonymization

In curating this collection, we took several steps in ensuring the anonymity of participants. All measures were discussed with the data protection officer of the University of Amsterdam and the data steward of the department of psychology, who deemed the anonymized data to be in accordance with the European General Data Protection Regulation (GDPR).

First, all personally identifiable information (such as subjects’ name, date of birth, and contact information) in all datasets were irreversibly destroyed. Second, using the *pydeface* software package [@Gulban2019-sv], we removed facial characteristics (mouth and nose) from all anatomical scans, i.e., the T1-weighted anatomical scans and (in PIOP2) magnitude and phase-difference images from the B0 fieldmap. The resulting defaced images were checked visually to confirm that the defacing succeeded. Third, the data files were checked for timestamps and removed when present. Lastly, we randomized the subject identifiers (*sub-xxxx*) for all files. In case participants might have remembered their subject number, they will not be able to look up their own data within our collection.

## Technical validation

In this section, we describe the measures taken for quality control of the data. This is described per data type (e.g., anatomical T1-weighted images, DWI images, physiology, etc.), rather than per dataset, as the procedure for quality control per data type was largely identical across the datasets. Importantly, we take a conservative approach towards exclusion of data, i.e., we generally did not exclude data unless (1) it was corrupted by scanner-related incorrigible artifacts, such as reconstruction errors, (2) when preprocessing fails due to insufficient data quality (e.g., in case of strong spatial inhomogeneity of structural T1-weighted scans, preventing accurate segmentation), (3) an absence of a usable T1-weighted scan (which is necessary for most preprocessing pipelines), or (4) incidental findings. This way, the data from AOMIC can also be used to evaluate artifact-correction methods and other preprocessing techniques aimed to post-hoc improve data quality and, importantly, this places the responsibility for inclusion and exclusion of data in the hands of the users of the datasets. 

Researchers not interested in using AOMIC data for artifact-correction or preprocessing techniques may still want to exclude data that do not meet their quality standards. As such, we include, for each modality (T1-weighted, BOLD, and DWI) separately, a file with several quality control metrics across subjects. The quality control metrics for the T1-weighted and functional (BOLD) MRI scans were computed by the Mriqc package [@Esteban2017-mv] and are stored in the *group_T1w.tsv* and *group_T1w.tsv* files in the *mriqc* derivatives folder. The quality control metrics for the DWI scans were derived from the output of FSL’s *eddy* algorithm and are stored in the *group_dwi.tsv* file in the dwipreproc derivatives folder. Using these precomputed quality control metrics, researchers can decide which data to include based on their own quality criteria.

### T1-weighted scans

All T1-weighted scans were run through the *Mriqc* pipeline, which outputs several quality control metrics as well as a report with visualizations of different aspects of the data. All individual subject reports were visually checked for artifacts including reconstruction errors, failure of defacing, normalization issues, and segmentation issues (and the corresponding data excluded when appropriate). In Figure \@ref(fig:fig-aomic-4), we visualize several quality control metrics related to the T1-weighted scans across all three datasets. In general, data quality appears to increase over time (with ID1000 being the oldest dataset, followed by PIOP1 and PIOP2), presumably due to improvements in hardware (see Scanner details and general scanning protocol). All quality control metrics related to the T1-weighted scans, including those visualized in Figure \@ref(fig:fig-aomic-4), are stored in the *group_T1w.tsv* file in the *mriqc* derivatives folder.

```{r fig-aomic-4, fig.cap='(ref:caption-fig-aomic-4)', results='show'}
knitr::include_graphics("_bookdown_files/aomic-files/figures/figure_4.png", auto_pdf = TRUE)
```

(ref:caption-fig-aomic-4) Quality control metrics related to the T1-weighted scans. CNR: contrast-to-noise ratio [@Magnotta2006-zs];  CJV: coefficient of joint variation [@Ganzetti2016-yy], an index reflecting head motion and spatial inhomogeneity; EFC: entropy-focused criterion [@Atkinson1997-eu], an index reflecting head motion and ghosting; INU: intensity non-uniformity, an index of spatial inhomogeneity; WM2MAX: ratio of median white-matter intensity to the 95% percentile of all signal intensities; low values may lead to problems with tissue segmentation.

### Functional (BOLD) scans

Like the T1-weighted images, the functional (BOLD) scans were run through the Mriqc pipeline. The resulting reports were visually checked for artifacts including reconstruction errors, registration issues, and incorrect brain masks. 

In Figure \@ref(fig:fig-aomic-5), we visualize several quality control metrics related to the functional scans across all three datasets. Similar to the T1-weighted quality control metrics, the functional quality control metrics indicate an improvement of quality over time. Also note the clear decrease in temporal signal-to-noise ratio (tSNR) for multiband-accelerated scans (consistent with @Demetriou2018-xp). All quality control metrics related to the functional MRI scans, including those visualized in Figure \@ref(fig:fig-aomic-5), are stored in the *group_bold.tsv* file in the *mriqc* derivatives folder.

```{r fig-aomic-5, fig.cap='(ref:caption-fig-aomic-5)', results='show'}
knitr::include_graphics("_bookdown_files/aomic-files/figures/figure_5.png", auto_pdf = TRUE)
```

(ref:caption-fig-aomic-5) Quality control metrics related to the functional (BOLD) MRI scans. SNR: signal-to-noise ratio, an index of signal quality; FD: framewise displacement [@Power2012-kt], an index of overall movement; GCOR: global correlation, an index of the presence of global signals [@Saad2013-zd]; GSR: ghost-to-signal ratio, an index of ghosting along the phase-encoding axis.

In Figure \@ref(fig:fig-aomic-6), we visualize these tSNR maps for each dataset (and separately for the sequential and multiband scans of PIOP1). Again, there appears to be an increase in tSNR across time. Corresponding whole-brain tSNR maps can be viewed and downloaded from NeuroVault (i.e., files with the *_tsnr* identifier).

```{r fig-aomic-6, fig.cap='(ref:caption-fig-aomic-6)', results='show'}
knitr::include_graphics("_bookdown_files/aomic-files/figures/figure_6.png", auto_pdf = TRUE)
```

(ref:caption-fig-aomic-6) Average (across subjects and runs) temporal signal-to-noise (tSNR) maps of each type of functional (BOLD) MRI scan in each dataset. Unthresholded whole-brain tSNR maps are available on NeuroVault.

For the fMRI data with an explicit task (i.e., all fMRI data except for the PIOP resting-state fMRI scans and the ID1000 movie watching fMRI scan), we additionally computed group-level whole-brain statistics maps. To do so, using the *nistats* Python package, we ran mass-univariate first-level GLS models (using an AR1 noise model) based on a design matrix including task-regressors based on the events convolved with a canonical HRF function as well as a discrete cosine basis set functioning as a high-pass filter of 128 seconds and six motion regressors and computed first-level contrast maps for each subject which were subsequently analyzed in a random effects group-level (intercept) model, resulting in whole-brain *z*-value maps. The data was never spatially smoothed. In Figure \@ref(fig:fig-aomic-7), we show the (uncorrected) whole-brain group-level results for each task. Note that we chose these specific contrasts to demonstrate that the tasks elicit to-be expected effects (e.g., amygdala activity in the emotion matching task and cingulate cortex activity in the gender-stroop task). Different, and more sophisticated analyses, including analysis of between-subject factors, are possible with this data and the associated event files.

```{r fig-aomic-7, fig.cap='(ref:caption-fig-aomic-7)', results='show'}
knitr::include_graphics("_bookdown_files/aomic-files/figures/figure_7.png", auto_pdf = TRUE)
```

(ref:caption-fig-aomic-7) Results from task-specific group-level analyses. Brain maps show uncorrected effects (*p* < 0.00001, two-sided) and were linearly interpolated for visualization in *FSLeyes*. Unthresholded whole-brain *z*-value maps are available on NeuroVault. Unthresholded whole-brain *z*-value maps are available on NeuroVault.

To validate the quality of the resting-state functional MRI scans in PIOP1 and PIOP2, we ran dual regression analyses [@Beckmann2009-rs] using the spatial ICA maps from Smith and colleagues [10-component version; @Smith2009-kj]. Prior to the dual regression analyses, the data was cleaned and high-pass filtered (using a 128 second cutoff) by regressing out a discrete cosine basis set and six motion parameter estimates and spatially smoothed with a Gaussian kernel with a 5 mm FWHM. Figure \@ref(fig:fig-aomic-8) shows the group-level dual regression results from both PIOP1 and PIOP2 for the first four components next to the original ICA map from @Smith2009-kj.

```{r fig-aomic-8, fig.cap='(ref:caption-fig-aomic-8)', results='show'}
knitr::include_graphics("_bookdown_files/aomic-files/figures/figure_8.png", auto_pdf = TRUE)
```

(ref:caption-fig-aomic-8) Group-level dual regression results for the first four components of Smith and colleagues (2009). Unthresholded *z*-value maps are available on NeuroVault.

Finally, to assess the quality of the ID1000 functional MRI data, we performed a voxelwise whole-brain “inter-subject correlation” (ISC) analysis [@Hasson2004-xb], using the BrainIAK software package [@Kumar2020-eo] on data from a subset of 100 participants (randomly drawn from the ID1000 dataset). Before computing the inter-subject correlations, the data were masked by an intersection of a functional brain mask and a grey matter mask (probability > 0.1). Low-frequency drift (with a cutoff of 128 seconds), the mean signal within the cerebrospinal fluid, global (whole-brain average) signal, and six motion parameters were regressed out before computing the ISCs. The average (across subjects) voxelwise ISCs are visualized in Figure \@ref(fig:fig-aomic-9), which shows the expected inter-subject synchrony in the ventral and dorsal visual stream. The emphasis on variance in visual parameters rather than narrative when composing the movie stimulus likely caused the high ISC values to be largely restricted to visual brain areas.

```{r fig-aomic-9, fig.cap='(ref:caption-fig-aomic-9)', results='show'}
knitr::include_graphics("_bookdown_files/aomic-files/figures/figure_9.png", auto_pdf = TRUE)
```

(ref:caption-fig-aomic-9) Results from the voxelwise ISC analysis, arbitrarily thresholded at 0.1. An unthresholded whole-brain ISC map is available on NeuroVault.

### Diffusion-weighted scans

Before preprocessing, the b=0 volume from each DWI scan was extracted and visually checked for severe artifacts and reconstruction errors (in which case the data was excluded). After preprocessing and DTI model fitting, we furthermore visualized each estimated fractional anisotropy (FA) map and the color-coded FA-modulated (absolute) eigenvectors for issues with the gradient directions. These images are included in the DWI derivatives.

Furthermore, we extracted quality control metrics based on outputs from the eddy correction/motion correction procedure in the DWI preprocessing pipeline as implemented in FSL’s *eddy* algorithm (based on the procedure outlined in @Bastiani2019-sm). Specifically, we computed the mean framewise displacement across volumes based on the realignment parameters from motion correction, the percentage of "outlier slices" (as determined by FSL *eddy*) in total and per volume, and the standard deviation of the estimated linear eddy current distortions across volumes. These metrics are visualized in Figure \@ref(fig:fig-aomic-10). Note that the y-axis for the standard deviation of the eddy currents for ID1000 has a larger range than for PIOP1 and PIOP2 to show the scans with particularly strong eddy current fluctuations.

```{r fig-aomic-10, fig.cap='(ref:caption-fig-aomic-10)', results='show'}
knitr::include_graphics("_bookdown_files/aomic-files/figures/figure_10.png", auto_pdf = TRUE)
```

(ref:caption-fig-aomic-10) Quality control metrics related to the diffusion-weighted scans. FD: framewise displacement, Std EC: standard deviation of the linear terms of the eddy current distortions in Hz/mm.

Finally, for each dataset, we transformed all preprocessed DTI eigenvectors to a population template estimated on all FA images using MRTrix’ *population_template* (using a linear followed by a non-linear registration procedure) and computed the voxelwise median across subjects. The median eigenvector images are visualized in Figure \@ref(fig:fig-aomic-11) as “diffusion-encoded color” (DEC) images, in which values are modulated by the associated FA values.


```{r fig-aomic-11, fig.cap='(ref:caption-fig-aomic-11)', results='show'}
knitr::include_graphics("_bookdown_files/aomic-files/figures/figure_11.png", auto_pdf = TRUE)
```

(ref:caption-fig-aomic-11) Diffusion-encoded color images of the FA-modulated median DTI eigenvectors across subjects. Red colors denote preferential diffusion along the sagittal axis (left-right), green colors denote preferential diffusion along the coronal axis (anterior-posterior), and blue colors denote preferential diffusion along the axial axis (inferior-superior). Brighter colors denote stronger preferential diffusion.

### Physiological data

After conversion to BIDS, physiological data was visually checked for quality by plotting the scanner triggers (i.e., volume onsets) and the cardiac and respiratory traces. Files missing a substantial window of data (>10 seconds) were excluded as well as files for which the scanner triggers could not be estimated reliably. Figures of the physiology traces and scanner triggers for each file are included in the physiology derivatives. Additionally, using the same approach as described for the task-based technical validation analyses, we fit first-level (subject-specific) and subsequently group-level (subject-average) models using the physiology regressors (all 18 RETROICOR regressors, one HRV, and one RVT regressor) for each dataset. In Figure \@ref(fig:fig-aomic-12), we visualize the effects of the different RETROICOR components (respiratory, cardiac, and interaction regressors; an *F*-test, but converted to and visualized as *z*-scores) and the HRV and RVT regressors (a *t*-test, but converted to and visualized as *z*-scores). Unthresholded whole-brain maps are available from NeuroVault.

```{r fig-aomic-12, fig.cap='(ref:caption-fig-aomic-12)', results='show'}
knitr::include_graphics("_bookdown_files/aomic-files/figures/figure_12.png", auto_pdf = TRUE)
```

(ref:caption-fig-aomic-12) Results from group-level physiology analyses. Brain maps show uncorrected effects (thresholded arbitrarily at *z* > 6) and were linearly interpolated for visualization in *FSLeyes*. Unthresholded whole-brain *z*-value maps are available on NeuroVault.

### Psychometric data

The patterns of correlations within the scales of the questionnaires are consistent with those reported in literature, indicating that this data is overall reliable. The pattern of correlations between scales of different questionnaires and external variables is also consistent with those reported in literature and what would be expected on theoretical grounds.

#### Intelligence Structure Test (IST)

The subscales of the IST (fluid and crystallized intelligence and memory) are strongly correlated with each other. The validity of the measure data is supported by the correlation with relevant external variables like educational level, $r(926) = 0.46$) and background SES, $r(926) = 0.35$ (see Table \@ref(tab:tab-aomic-6)).

```{r tab-aomic-6, results='asis'}
data = read_csv('_bookdown_files/aomic-files/table_6_data.csv')
kbl(data, booktabs = T, longtable = T,
    caption = 'Correlations between total score, and subscales of the IST and relevant external variables.') %>%
    kable_styling(full_width = T, font_size = 8) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = 'IST: Intelligence Structure Test, Int: Total Intelligence, SES: background social-economic status. ** indicates p < 0.01.')
```

#### Personality: NEO-FFI

The cross-correlation patterns of the five NEO-FFI scales are depicted in Table \@ref(tab:tab-aomic-7). Significant correlations exist between the scales, and the correlation pattern is overall consistent with the reported norm data for this test [@Hoekstra1996-kv]. The correlation between cross-correlation patterns of the three datasets is very consistent ($r = 0.88$ between PIOP1 and PIOP2, and on average $r = 0.74$ between ID1000 and PIOP), with as a notable outlier a negative correlation, $r(928) = -0.13$, $p < 0.001$, between extraversion and agreeableness in the ID1000 dataset and a positive correlation for these scales in the PIOP1, $r(216) = 0.20$, $p < 0.005$, and PIOP2, $r(226) = 0.26$, $p < 0.001$. A source for this discrepancy could be the difference in population sample between the PIOP1 and PIOP2 studies and the ID1000 study.

```{r tab-aomic-7, results='asis'}
data = read_csv('_bookdown_files/aomic-files/table_7_data.csv')
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T,
    caption = 'Cross-correlations for the subscales of the NEO-FFI for the ID1000, PIOP1 and PIOP2 samples.') %>%
    kable_styling(full_width = T, font_size = 8) %>%
    row_spec(c(6, 12), bold = T) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = 'With the exception of the correlation between agreeableness and extraversion the  cross-correlation patterns are very similar across samples. * indicates p<0.05. ** indicates p<0.01.')
```

In terms of external validity we note that openness to experience has a positive correlation with intelligence in all three samples (ID1000: $r(925) = 0.22$, $p < 0.001$, PIOP1: $r(216) = 0.25$, $p = 0.000196$), PIOP2: $r(225) = 0.24$, $p = 0.000276$).

#### BIS/BAS

The cross-correlation patterns of the BIS/BAS scales are depicted in Table \@ref(tab:tab-aomic-8). The cross-correlation between the scales are similar to the one reported by @Franken2005-jg and contrary to what @Carver1994-wp predicted, with a positive correlation between the three different BAS-scales, but also between BIS and BAS-Reward, $r(927) = 0.194$. 

```{r tab-aomic-8, results='asis'}
data = read_csv('_bookdown_files/aomic-files/table_8_data.csv')
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T,
    caption = 'Cross-correlations for the subscales of the BIS/BAS for the ID1000 sample.') %>%
    kable_styling(full_width = T, font_size = 8) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = '** indicates p<0.01.')
```

#### STAI-T

The STAI-T scale measures trait anxiety. Because this instrument only consists of one scale we evaluate its reliability on the degree in which it shows correlations with other questionnaire scales that also have a pretension of measuring negative emotionality. Because we observe positive correlations with both Neuroticisms, $r(927) = 0.77$, $p < 0.001$) and BIS, $r(927) = 0.514$, $p < 0.001$) we conclude that the reported scales are reliable and consistent. 

## Code availability {#aomic-code-availability}

All code used for curating, annotating, and (pre)processing AOMIC are version-controlled using git and can be found in project-specific Github repositories within the NILAB-UvA Github organization: https://github.com/orgs/NILAB-UvA. Many pre and postprocessing steps were identical across datasets, so the code for these procedures is stored in a single repository: https://github.com/NILAB-UvA/AOMIC-common-scripts. Possible parameters are all hard-coded within the scripts, except for a single positional parameter pointing to the directory to be processed. For custom Python-based scripts, we used Python version 3.7. All code was developed on a Linux system with 56 CPUs (Intel Xeon E5-2680 v4, 2.40GHz) and 126GB RAM running Ubuntu 16.04. All curation, preprocessing, and analyses were run on said Linux system, apart from the *Fmriprep*, *Mriqc*, and *Freesurfer* analyses, which were run in a Docker container provided by those software packages. Custom code was parallelized to run on multiple CPUs concurrently using the Python package *joblib* (https://joblib.readthedocs.io).

For curation, preprocessing, and analysis of the datasets, we used a combination of existing packages and custom scripts (written in Python or bash). To convert the data to the Brain Imaging Data Structure (*BIDS*), we used the in-house developed, publicly available software package *bidsify* (v0.3; https://github.com/NILAB-UvA/bidsify), which in turn uses the *dcm2niix* [v1.0.20181125; @Li2016-ss] to convert the Philips PAR/REC files to compressed nifti files. In contrast to the data from PIOP1 and PIOP2 (which were converted to nifti using *dcm2niix*), *r2aGUI* (v2.7.0; http://r2agui.sourceforge.net) was used to convert the data from ID1000. Because *r2aGUI* does not correct the gradient table of DWI scans for slice angulation, we used the *angulation_correction_Achieva* Matlab script (version December 29, 2007) from Jonathan Farrell to do so (available for posterity at https://github.com/NILAB-UvA/ID1000/blob/master/code/bidsify/DTI_gradient_table_ID1000.m). To remove facial characteristics from anatomical scans, we used the *pydeface* package [v.1.1.0; @Gulban2019-sv]. Finally, to convert the raw physiology files (i.e., Philips “SCANPHYSLOG” files) to BIDS, we used the in-house developed, publicly available Python package *scanphyslog2bids* (v0.1; https://github.com/lukassnoek/scanphyslog2bids). The outputs from the BIDS-conversion pipeline were checked using the *bids-validator* software package (v1.4.3).

Anatomical and functional MRI preprocessing were done using *Fmriprep* (v1.4.1; see the [Derivatives](#aomic-derivatives) section for extensive information about *Fmriprep*’s preprocessing pipeline]. For our DWI preprocessing pipeline, we used tools from the MRtrix3 package [www.mrtrix.org; v3.0_RC3; @Tournier2019-hh] and FSL [v6.0.1; @Jenkinson2012-ui]. For the VBM and dual regression pipelines, we used *FSL* [v6.0.1; @Douaud2007-sw; @Good2001-kv; @Smith2004-sc]. To create the files with *Freesurfer*-based metrics across all participants, we used *Freesurfer* version 6.0.095. Physiological nuisance regressors (RETROICOR and HRV/RVT regressors) were estimated using the *TAPAS PhysIO* Matlab package [v3.2.0; @Kasper2017-lp].

First-level functional MRI analyses for technical validation were implemented using the Python package *nistats* [v0.0.1b2; @Abraham2014-ef] and *nilearn* [v0.6.2; @Abraham2014-ef; @Pedregosa2011-bp]. For the inter-subject correlation analysis the *Brain Imaging Analysis Kit* was used [*BrainIAK*, http://brainiak.org, v0.10; RRID:SCR_014824; @Kumar2020-eo]. Plotting brain images was done using *FSLeyes* [v0.32; @McCarthy2019-yt] and plotting statistical plots was done using the Python packages *seaborn* [@Waskom2020-qq] and *Matplotlib* [@Hunter2007-at].

<!--chapter:end:04-aomic.Rmd-->

```{r setup-morbid-curiosity, include=FALSE}
knitr::opts_chunk$set(results = 'hide', echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(kableExtra)
```

# Choosing to view morbid information involves reward circuitry {#morbid-curiosity}
\chaptermark{Morbid Curiosity}

\vspace*{\fill}

---

\small
\noindent
_This chapter has been published as_: Oosterwijk, S., Snoek, L., Tekoppele, J., Engelbert, L. H., & Scholte, H. S. (2020). Choosing to view morbid information involves reward circuitry. *Scientific reports, 10*(1), 1-13.

\newpage
\normalsize

`<p><strong>Abstract</strong></p>`{=html}
`\begin{abstract}`{=latex}
People often seek out stories, videos or images that detail death, violence or harm. Considering the ubiquity of this behavior, it is surprising that we know very little about the neural circuits involved in choosing negative information. Using fMRI, the present study shows that choosing intensely negative stimuli engages similar brain regions as those that support extrinsic incentives and “regular” curiosity. Participants made choices to view negative and positive images, based on negative (e.g., a soldier kicks a civilian against his head) and positive (e.g., children throw flower petals at a wedding) verbal cues. We hypothesized that the conflicting, but relatively informative act of choosing to view a negative image, resulted in stronger activation of reward circuitry as opposed to the relatively uncomplicated act of choosing to view a positive stimulus. Indeed, as preregistered, we found that choosing negative cues was associated with activation of the striatum, inferior frontal gyrus, anterior insula, and anterior cingulate cortex, both when contrasting against a passive viewing condition, and when contrasting against positive cues. These findings nuance models of decision-making, valuation and curiosity, and are an important starting point when considering the value of seeking out negative content.
`\end{abstract} \newpage`{=latex}

## Introduction {#morbid-curiosity-introduction}

Humans are active agents who often deliberately expose themselves to “morbid” information (e.g., information involving death, violence or harm). People choose to watch gruesome documentaries, click on links detailing terrifying attacks and visit locations of horrible events. Surprisingly, the fact that people experience curiosity for negative information, and often act on this feeling, is rarely addressed in theoretical models of curiosity and decision-making. Moreover, empirical work on this phenomenon is markedly limited and studies investigating the neural circuits involved in choosing negative information are virtually non-existent. Nevertheless, “morbid curiosity” is an important topic for investigation, because this ubiquitous behavior appears to be at odds with the idea that value and reward drive human information seeking. The present paper aims to expand the scientific inquiry of curiosity and choice, by investigating how the brain, and reward-related brain regions in particular, represent a deliberate choice to view intensely negative images that portray death, violence or harm.

In the last decades, much progress has been made in understanding the neuroscience of choice, valuation and curiosity. Yet, when studying choice, decision-making scientists typically focus on extrinsically rewarding stimuli, such as monetary rewards [@braver2014mechanisms]. Decisions regarding intrinsically rewarding stimuli are targeted less frequently [@murayama2018psychological] and even less is known about the neural representation of seeking negative information that, at first glance, does not seem to have reward value at all [@elliot2006hierarchical]. Similarly, in the field of curiosity --- defined as an intrinsically motivated drive state for information [@kidd2015psychology; @golman2015curiosity; @gottlieb2013information] --- research on curiosity for negative information is scarce [@@murayama2018psychological; see for exceptions @oosterwijk2017choosing; @hsee2016pandora; @rime2005brief; @zuckerman1986personality]. A handful of neuroscience studies have demonstrated that curiosity engages similar neural circuits as extrinsic reward, but only when examining positive or neutral material, such as trivia questions [e.g., @gruber2014states; @kang2009wick]. At present, it is thus unclear whether curiosity for “morbid” information is supported by similar neural mechanisms as those that support extrinsic incentives and “regular” curiosity.

Neuroscientific evidence suggests that curiosity, choice and reward are supported by a highly similar constellation of brain regions4,13. Reward-related decision making, predominantly studied by focusing on monetary gains or losses, engages the dorsal striatum (caudate, putamen), ventral striatum (NAcc), orbitofrontal cortex (OFC), bilateral anterior insula, anterior cingulate cortex (ACC), dorsomedial prefrontal cortex/supplementary motor area (dmPFC/SMA) and frontal and parietal regions often associated with cognitive control14,15,16,17,18. Several studies targeting curiosity demonstrated similar neural regions. For example, Kang and colleagues12 found increased activation in the inferior frontal gyrus (IFG), caudate and putamen when inducing curiosity by presenting trivia questions. When curiosity was relieved (i.e., when the answer to the question was given) they found engagement of the putamen and IFG. In another study targeting trivia questions, Gruber and colleagues11 found increased activation in the dorsal and ventral striatum and IFG for questions associated with high curiosity ratings. Other work has shown that the induction and relief of curiosity engages regions that are associated with salience detection and uncertainty19,20, including the anterior insula and ACC21,22. In short, the limited work on curiosity so far, demonstrates that curiosity for relatively positive and neutral material engages neural regions that are also recruited during the computation of value and the anticipation of reward. Whether these regions also engage when people act on their curiosity for negatively valenced information is currently unknown.

Neuroscientific evidence suggests that curiosity, choice and reward are supported by a highly similar constellation of brain regions [@kidd2015psychology; @sakaki2018curiosity]. Reward-related decision making, predominantly studied by focusing on monetary gains or losses, engages the dorsal striatum (caudate, putamen), ventral striatum (NAcc), orbitofrontal cortex (OFC), bilateral anterior insula, anterior cingulate cortex (ACC), dorsomedial prefrontal cortex/supplementary motor area (dmPFC/SMA) and frontal and parietal regions often associated with cognitive control [@levy2012root; @liu2011common; @samanez2015decision; @diekhof2012role; @bartra2013valuation]. Several studies targeting curiosity demonstrated similar neural regions. For example, @kang2009wick found increased activation in the inferior frontal gyrus (IFG), caudate and putamen when inducing curiosity by presenting trivia questions. When curiosity was relieved (i.e., when the answer to the question was given) they found engagement of the putamen and IFG. In another study targeting trivia questions, @gruber2014states found increased activation in the dorsal and ventral striatum and IFG for questions associated with high curiosity ratings. Other work has shown that the induction and relief of curiosity engages regions that are associated with salience detection and uncertainty [@singer2009common; @menon2010saliency], including the anterior insula and ACC [@jepma2012neural; @van2018induction]. In short, the limited work on curiosity so far, demonstrates that curiosity for relatively positive and neutral material engages neural regions that are also recruited during the computation of value and the anticipation of reward. Whether these regions also engage when people act on their curiosity for negatively valenced information is currently unknown.

In the present study, we tested the preregistered hypothesis that the striatum and IFG (ROI-analyses) and the anterior insula and ACC (whole-brain analyses) will engage more when people deliberately choose to view negative images, as compared to a passive viewing condition. This hypothesis reflects our assumption that “morbid curiosity”, expressed by a choice to view a negative stimulus, engages similar neural regions as regular curiosity [@gruber2014states; @kang2009wick; @jepma2012neural; @van2018induction; see for an overview @gruber2019curiosity]. In addition, we tested a second hypothesis that the regions described above will engage more strongly when people choose to view a negative stimulus, as compared to a positive stimulus. This hypothesis is based on our assumption that the informational value of negative images is relatively high. Compared to positive information, negative information may be more novel, rare, deviant, uncertain, challenging or complex [@unkelbach2008positive; @baumeister2001bad] --- these information characteristics engage reward circuitry and evoke curiosity [@kidd2015psychology; @sakaki2018curiosity; @berlyne1966curiosity; @kashdan2009curiosity]. Furthermore, a choice for negativity may involve a tradeoff between benefits (e.g., understanding something complex) and costs (e.g., being emotionally perturbed by a stimulus). Choosing a positive stimulus (e.g., viewing a family picnicking in the park) may not involve such costs, and may also have less benefits in terms of accessing novel, deviant or complex information. In this sense, choosing negativity (or “morbid curiosity”) is a conflict state; people want information, without predicting that they will like the information [see also @rime2005brief; @litman2005curiosity]. Previous work suggests that reward circuitry engagement is most pronounced when actions or decisions are ambiguous or unclear [@floresco2015nucleus]. In line with this, we predict that the conflicting, but relatively informative act of choosing to view a negative image will paradoxically result in stronger activation of reward circuitry as opposed to the relatively uncomplicated act of choosing to view a positive stimulus.

We build upon previous work that demonstrates that people are interested in and fascinated by negative images [@oosterwijk2017choosing; @oosterwijk2016neural]. The present study specifically targets choice for social negative images (i.e., displaying death, violence or harm within a social context), because we found in previous research that people prefer to view these stimuli over neutral alternatives and choose to view these stimuli more often than images of attacking animals and graphic, decontextualized mutilation [@oosterwijk2017choosing]. We used an established choice paradigm [@oosterwijk2017choosing] that presented participants with choices to view social images that depicted negative and positive situations, taken from validated affective picture databases. Importantly, this paradigm solely targets intrinsic motivation; participants were not financially rewarded for their choices. Moreover, this paradigm targets a behavioral expression of “wanting”, and not the extent to which people “like” the images [@litman2005curiosity; @berridge2009dissecting]. The active-choice condition was compared to a passive-viewing condition, using a yoked procedure that has been previously used to study responses to controllable and incontrollable stressors [@wood2015controllability; @amat2005medial]. In the present study, a yoked design allowed us to investigate the effect of choice, while controlling for general affective, semantic and visual processing.

In the choice condition, people were presented with verbal cues, describing negative images (e.g., a soldier kicks a civilian against his head) and positive images (e.g., children throw flower petals at a wedding). The presentation of the verbal cue was labeled the induction phase (see Figure \@ref(fig:fig-morbid-curiosity-1)). Following the cue, participants chose whether they wanted to see the image corresponding to the description, or not. In the relief phase (see Figure \@ref(fig:fig-morbid-curiosity-1)), participants viewed the corresponding image when responding yes and a blurred version when responding no. The passive-viewing condition was fully yoked to the active-choice condition. In other words, each participant in the passive-viewing condition did not make choices, but was confronted with the choice profile of a participant in the active-choice condition. Importantly, this yoked design isolates the psychological process that we aim to investigate (i.e., a deliberate choice to view a stimulus), while keeping all other factors constant (i.e., cues and images). In line with curiosity theories that argue that exploratory behavior is an important component of curiosity [@kashdan2009curiosity; @litman2005curiosity; @loewenstein1994psychology], we propose that the potential to choose will make participants’ subjective experience of curiosity more salient. In other words, participants’ subjective state of curiosity may be more at the fore-front of consciousness in the active-choice condition (because it will inform participants’ decisions) than in the passive-viewing condition.

```{r fig-morbid-curiosity-1, fig.cap='(ref:caption-fig-morbid-curiosity-1)', results='show'}
knitr::include_graphics("_bookdown_files/morbid-curiosity-files/figures/figure_1.png", auto_pdf = TRUE)
```

(ref:caption-fig-morbid-curiosity-1) Overview of paradigm. (**A**) The setup of the trials in the choice-condition and passive-viewing condition. Note that in the active-choice condition, participants chose whether they wanted to see the image corresponding to the description during the yes/no response event. In the passive-viewing condition participants did not choose, but confirmed the decision seemingly determined by the computer during the yes/no response event. (**B**) An example of a negative description and the consequence of a yes response (either given by the participant, or determined by the computer). (**C**) An example of a positive description and the consequence of a no response (either given by the participant, or determined by the computer).

We selected positive and negative images from the International Affective Picture System database [@lang1997international] and the Nencki Affective Picture System database [@marchewka2014nencki; [Methods](#morbid-curiosity-methods) section for more details]. Importantly, we matched negative and positive images in terms of valence extremity to ensure that, on average, positive images were perceived as equally positive as negative stimuli were perceived negative. A similar procedure was performed for the positive and negative descriptions (i.e., cues; see [Methods](#morbid-curiosity-methods) section for further details).

Our scanning protocol was performed on a 3 T scanner. For all details on image acquisition, preprocessing and first- and second-level analyses, please see the [Methods](#morbid-curiosity-methods) section. Our analysis protocol held confirmatory and exploratory analyses. Hypotheses and corresponding contrasts for the confirmatory analyses, exclusion criteria, ROIs and corrections for multiple comparisons were preregistered on the Open Science Framework, prior to data analysis [[osf.io/gdtk9](osf.io/gdtk9); @oosterwijk2017prereg].

The first-level model included six predictors to capture the research design: 2 (phase: induction phase vs. relief phase) × 2 (valence: negative vs. positive) × 2 (choice: yes, full image vs. no, blurred image). Additionally, we added a single predictor for the motor response associated with the decision/confirmation response and six motion predictors based on estimated motion correction parameters. First level contrasts only involved trials associated with yes choices (i.e., full image trials); trials associated with no responses (i.e., blurred image trials) were not used for further group level analysis.

In the ROI-based analyses, we focused on voxels within two a-priori defined ROIs: bilateral striatum and bilateral inferior frontal gyrus (IFG). The ROIs were based on the Harvard-Oxford Subcortical Atlas (striatum; caudate, putamen and nucleus accumbens) and the Harvard-Oxford Cortical Atlas (IFG; pars opercularis and pars triangularis) with a threshold for probabilistic ROIs > 0 [@craddock2012whole]. In the group-level analyses targeting these two ROIs, we calculated two contrasts that reflected our confirmatory hypotheses, separately for the induction and relief phase. We hypothesized stronger activation in the ROIs when participants processed a negative cue/image in the active-choice condition as compared to that same event in the passive-viewing condition (i.e., $(\beta_{\mathrm{neg|active}} -\beta_{\mathrm{neg|passive}}) > 0$). In addition, we hypothesized stronger activation in the ROIs when participants processed a negative cue/image in the active-choice condition as compared to a positive cue/image in the active-choice condition, controlling for passive viewing (i.e., $(\beta_{\mathrm{neg|active}} - \beta_{\mathrm{neg|active}}) - (\beta_{\mathrm{pos|active}} - \beta_{\mathrm{pos|passive}}) > 0$). For these confirmatory ROI analyses, we used nonparametric permutation-based inference in combination with Threshold-Free Cluster Enhancement [TFCE; @smith2009threshold] as implemented in *FSL randomise* [@winkler2014permutation] and thresholded voxelwise results at $p < 0.025$ (correction for two ROIs). Note that this analysis allows for voxel-wise inference (i.e., no cluster-based correction is used). In addition to the confirmatory ROI analysis, we conducted an exploratory whole-brain group-level analysis. In addition to the two confirmatory contrasts mentioned in the previous section, we tested three exploratory contrasts, separately for the induction and relief phase with a voxel-wise *p*-value threshold of 0.005 and a cluster-wise *p*-value of 0.05). Full details regarding the exploratory analyses can be found in the [Methods](#morbid-curiosity-methods) section.

## Methods {#morbid-curiosity-methods}

### Participants {#morbid-curiosity-methods-participants}

Participants consisted of a convenience sample of students at the University of Amsterdam. The study was approved by the Ethics Review Board of the department of Psychology at the University of Amsterdam (2017-SP-7871) and performed in accordance with relevant institutional guidelines. The budget allowed for scanning of a maximum of 60 participants. After applying the exclusion criteria, the total sample consisted of 54 participants, including 38 women (*M~age~* = 22.4, *SD* = 2.9) and 16 men (*M~age~* = 23.8, *SD* = 1.8).

### Design {#morbid-curiosity-methods-design}

This study used a 2 (choice: active-choice vs. passive-viewing) × 2 (phase: induction vs. relief) × 2 (valence: negative vs. positive) mixed design. The variable choice was varied between participants and consisted of an active-choice condition and a passive-viewing condition. The variable phase was varied within participants and reflected the presentation of the cue (i.e., induction) vs. the presentation of the image (i.e., relief). The variable valence was varied within participants and reflected the negative vs. positive content of the cues/images.

### Materials {#morbid-curiosity-methods-materials}

#### Experimental task {#morbid-curiosity-methods-materials-experimental-task}

The present study utilized a choice task [@oosterwijk2017choosing] that presented participants with verbal cues describing negative and positive images, and offered them a choice to see these images or blurred versions. We used a yoked design that isolated the effects of choice, controlling for general affective, semantic and visual processing [see also [@wood2015controllability; @amat2005medial]). This yoked design resulted in two conditions: the active-choice condition and the passive-viewing condition. Participant in the passive-viewing condition did not make choices, but were confronted with the choice profile of a yoked participant in the choice condition. Tasks in both conditions were programmed in Neurobs Presentation ([https://www.neurobs.com/presentation](https://www.neurobs.com/presentation)). Behavioral data preprocessing was done using Python 3.5 and analyzed using IBM SPSS Statistics 22.0.

In the active-choice condition, participants were presented with 35 negative cues (e.g., rescue workers treat a wounded man; a soldier kicks a civilian against his head) and 35 positive cues (e.g., children throw flower petals at a wedding; partying people carry a crowd surfer) that described images, in random order. In each trial participants could choose, based on the cue, whether they wanted to view the corresponding image or not. The choice task consisted of a total of 70 trials. Each trial started with a fixation cross, presented for 500 ms, followed by the cue, presented for 3,000 ms. The presentation of the cue was labelled as the induction phase [see also @jepma2012neural; @van2018induction]. The cue was followed by a jittered interval varying between 500 and 2000 ms. Subsequently, participants saw the words ‘yes’ and ‘no’ on the screen, and chose whether they wanted to see the image that was described by the cue, or not, by pressing one of two pre-specified buttons. Immediately following their response, the word ‘yes’ or ‘no’ turned green, indicating that their response was registered. Participants had a 2000 ms. time window to make their choice. If they had not made a choice after 2000 ms, the choice was automatically set to ‘no’. The response phase was followed by a jittered interval varying between 500 and 2000 ms. The interval was followed by the relief phase, in which the participants were presented with the image (1,024 × 768 pixels) when they chose ‘yes’. When participants chose not to see the corresponding image, they were presented with a blurred version of the image that was unrecognizably distorted (filter). Images were blurred with the software IrfanView (version 4.44; [https://www.irfanview.com/](https://www.irfanview.com/)) using the fast Gaussian blur (filter = 150 pixels). Both the image and the blurred image were presented for 3,000 ms. The relief phase was followed by a jittered inter-trial-interval varying between 2000 and 4,000 ms. For a visual representation of the paradigm, please see Figure \@ref(fig:fig-morbid-curiosity-1).

In the passive-viewing condition, participants were presented with the choice profile of a participant in the active-choice condition (i.e., the exact pattern of ‘yes’ and ‘no’ responses to the positive and negative cues for each participant in the active-choice condition was saved, and then re-used once as the computer generated pre-determined choice pattern for a participant in the passive-viewing condition). Participants were told in the introduction to the study that the computer would determine which images would be shown. The trial setup was identical to the active-choice condition, except for the following aspect. After participants were presented with the cue, the word ‘yes’ or ‘no’ turned green, indicating the choice of the computer. Participants were asked to confirm the choice made by the computer by pressing one of two pre-specified buttons, to mirror the motor response made in the active-choice condition.

The active-choice condition came with a filling problem: because participants could choose whether they wanted to view an image or not, some participants would see many more images than others. This filling problem can pose problems for modelling the BOLD response, due to lower efficiency in estimating contrasts for one subject over the other. Based on individual differences in choosing to view social negative information [@oosterwijk2017choosing], we formulated an a-priori defined and preregistered eligibility criterion that only participants in the active-choice condition who chose negative and/or positive images in 40% or more of the trials (14/35 stimuli) would be paired with a subject in the passive-viewing condition. Based on this criterion five out of 33 participants in the active-choice condition were excluded from the sample. One other participant was excluded, because the functional scan was stopped prematurely. This resulted in 27 participants in the active-choice condition. The choice profiles of these 27 participants were yoked with 27 participants in the passive-viewing condition.

#### Cues {#morbid-curiosity-methods-materials-cues}

Cues were written to describe positive and negative images in one sentence. In a pilot study the cues were rated on valence (0 = negative to 100 = positive), and arousal (0 = low arousal to 100 = high arousal). Negative cues were rated more negatively than positive cues (*M* = 20.69, *SD* = 8.42 vs. *M* = 77.99, *SD* = 4.49), *t*(68) = −35.51, *p* < 0.001, and more arousing than positive cues (*M* = 68.45, *SD* = 6.38 vs. *M* = 28.93, *SD* = 5.99), *t*(68) = 26.71, *p* < 0.001. Negative and positive cues were matched in terms of valence extremity. An analysis of mean-centered valence scores demonstrated that, on average, positive cues were perceived as equally positive (*M* = 29.31, *SD* = 8.43) as negative stimuli were perceived as negative (*M* = 27.99, *SD* = 4.49), *t*(68) = 0.82, *p* = 0.417.

#### Images {#morbid-curiosity-methods-materials-images}

Images were selected from the International Affective Picture System [IAPS; @lang1997international] and the Nencki Affective Picture System [NAPS; @marchewka2014nencki]; image codes are presented in the [Supplementary Materials](#morbid-curiosity-supplement) (Table \@ref(tab:tab-morbid-curiosity-S4)). We selected negative images that portrayed situations of interpersonal violence, or social scenes involving a dead body or a harmed person. Negative images were selected when they had a valence rating below 4 (on a scale from 1 = negative to 9 = positive) and an arousal rating above 4.5 (on a scale from 1 = not arousing to 9 = extremely arousing). We selected positive images that portrayed joyful, loving or exciting interpersonal interactions. Positive images were selected when they had a valence rating above 6 (on a scale from 1 = negative to 9 = positive) and an arousal rating above 3 (on a scale from 1 = not arousing to 9 = extremely arousing). Negative and positive images differed significantly in terms of valence (*M* = 2.58, *SD* = 0.53 vs. *M* = 7.43, *SD* = 0.36), *t*(68) = −44.88, *p* < 0.001, and arousal (*M* = 6.18, *SD* = 0.75 vs. *M* = 4.78, *SD* = 0.90), *t*(68) = 7.07, *p* < 0.001. Negative and positive images were matched in terms of valence extremity. An analysis of mean-centered valence scores demonstrated that, on average, positive images were perceived as equally positive (*M* = 2.42, *SD* = 0.53) as negative stimuli were perceived as negative (*M* = 2.44, *SD* = 0.37), *t*(68) = − 0.22, *p* = 0.824.

#### Questionnaires {#morbid-curiosity-methods-materials-questionnaires}

After the scanning session was completed, participants filled in the ‘Morbid curiosity in daily-life’ questionnaire [@oosterwijk2017choosing] and the Dutch version of the Interpersonal Reactivity Index [@de2007measuring]. A short exit questionnaire asked participants two questions regarding the task they performed in the scanner. Participants in the active-choice condition were asked to rate to what extent they followed their curiosity when making choices for negative cues, and when making choices for positive cues, on a 1 (not at all) to 7 (very much) point scale. Participants in the passive-viewing condition were asked to rate to what extent they were curious about the negative cues, and the positive cues, on a 1 (not at all) to 7 (very much) point scale. The exit questionnaire concluded with demographic questions.

### Procedure {#morbid-curiosity-methods-procedure}

After signing the informed consent form, each participant received a thorough instruction. The active-choice condition was introduced as a study on how the brain represents choice. Participants were explained how they could make their choice, that they would always see the image of their choice, and that there were no right or wrong answers. Furthermore, participants were presented with an example of a negative and a positive cue, combined with the corresponding full image and blurred image, so that they knew what to expect when choosing the yes or no option. No mention was made of curiosity in the instruction. The passive-viewing condition was introduced as a study on the brain processes involved in reading image descriptions and viewing images. Participants were explained that the computer determined whether a description would be followed by a corresponding image. As in the active-choice condition, participants were presented with an example of a negative and a positive cue, combined with the corresponding full image and blurred image, so that they knew what to expect when the computer determined the yes or no option.

When comfortable and instructed, a structural T1-weighted anatomical scan was made. Then the participant performed the choice task or the passive task during fMRI acquisition in the scanner. After the scanning session, the participant filled in the questionnaires and received a thorough debriefing.

### Behavioral analysis {#morbid-curiosity-methods-behavioral-analysis}

In the active-choice condition, we compared the extent to which participants followed their curiosity when making choices for negative cues and positive cues. In the passive-viewing condition, we compared the extent to which participants were curious about negative cues and positive cues. For the active-choice condition, a Kolmogorov–Smirnov test indicated a normality violation (active-choice: skewness = 0.640, kurtosis = − 0.375, *D*(25) = 0.197, *p* = 0.013; passive-viewing: skewness = − 0.399, kurtosis = − 0.055, *D*(27) = 0.161, *p* = 0.071). We report two paired sample *t*-tests (two-tailed) to analyze the difference between cues, but results were fully corroborated with non-parametric Wilcoxon signed-rank tests. Effect sizes (Cohen’s *d~z~*) were calculated using Lakens’ [@lakens2013calculating] spreadsheet.

### Imaging details {#morbid-curiosity-methods-imaging-details}

#### Image acquisition {#morbid-curiosity-methods-imaging-details-image-acquisition}

Participants were tested using a Philips Achieva 3T MRI scanner and a 32-channel SENSE headcoil. A survey scan was made for spatial planning of the subsequent scans. Following the survey scan, a 3-min structural T1-weighted scan was acquired using 3D fast field echo (TR: 82 ms, TE: 38 ms, flip angle: 8°, FOV: 240 × 188 mm, in-plane resolution 240 × 188, 220 slices acquired using single-shot ascending slice order and a voxel size of 1.0 × 1.0 × 1.0 mm). After the T1-weighted scan, functional T2*-weighted sequences were acquired using single shot gradient echo, echo planar imaging (TR = 2000 ms, TE = 27.63 ms, flip angle: 76.1°, FOV: 240 × 240 mm, in-plane resolution 64 × 64, 37 slices with ascending acquisition, slice thickness 3 mm, slice gap 0.3 mm, voxel size 3 × 3 × 3 mm), covering the entire brain. For the functional run, 495 volumes were acquired. After the functional run, a “B0” fieldmap scan (based on the phase difference between two consecutive echos) was acquired using 3D fast field echo (TR: 11 ms, TE: 3 ms and 8 ms, flip angle: 8°, FOV: 256 × 208, in-plane resolution 128 × 104, 128 slices).

#### Preprocessing {#morbid-curiosity-methods-imaging-details-preprocessing}

Results included in this manuscript come from preprocessing performed using *FMRIPREP* version 1.0.0 [@esteban2019fmriprep; @esteban_oscar_2017_1095198], a *Nipype* [@gorgolewski2011nipype; @gorgolewski_krzysztof_j_2017_581704] based tool. Each T1 weighted volume was corrected for bias field using *N4BiasFieldCorrection* v2.1.0 [@tustison2010n4itk] and skullstripped using *antsBrainExtraction.sh* v2.1.0 (using OASIS template). Cortical surface was estimated using *FreeSurfer* v6.0.0 [@dale1999cortical]. The skullstripped T1w volume was segmented [using *FSL FAST*; @zhang2001segmentation] and coregistered to the skullstripped ICBM 152 Nonlinear Asymmetrical template version 2009c [@fonov2009unbiased] using nonlinear transformation implemented in *ANTs* v2.1.0 [@avants2008symmetric].

Functional data was motion corrected using *MCFLIRT* v5.0.9 [@jenkinson2002improved]. Distortion correction was performed using phase-difference fieldmaps processed with *FUGUE* [@jenkinson2003fast; *FSL* v5.0.9]. This was followed by co-registration to the corresponding T1w using boundary-based registration [@greve2009accurate] with 9 degrees of freedom, using *bbregister* (*FreeSurfer* v6.0.0). Motion correcting transformations, field distortion correcting warp, BOLD-to-T1w transformation and T1w-to-template (MNI) warp were concatenated and applied in a single step using *antsApplyTransforms* (*ANTs* v2.1.0) using Lanczos interpolation.

Many internal operations of *FMRIPREP* use *nilearn* [@abraham2014machine], principally within the BOLD-processing workflow. For more details of the pipeline see [https://fmriprep.readthedocs.io/en/1.0.0/workflows.html](https://fmriprep.readthedocs.io/en/1.0.0/workflows.html).

#### First-level analysis {#morbid-curiosity-methods-imaging-first-level-analysis}

We modeled the participants’ preprocessed time series in a “first-level” GLM using *FSL FEAT* [@woolrich2001temporal; *FSL* v6.0.0[. The first-level modeling procedure was exactly the same for the participants in the active choice and passive viewing condition. As predictors, we included regressors for both the induction phase (i.e., the written description) and the relief phase (i.e., the full image). We separated trials with positive descriptions/images from trials with negative descriptions/images and separated trials in which participants saw the full version of the image from trials in which they saw a blurred version of the image. Note that in the active choice condition participants chose to see the full or blurred image, whereas in the passive viewing condition it was predetermined whether participants saw the full or blurred image. The final model held six predictors: 2 (phase: induction vs. relief) × 2 (valence: negative vs. positive) × 2 (seen: full image vs. blurred image). If participants did not have any blurred image trials, the associated predictors were left out. Additionally, we added a single predictor for the actual decision (i.e., modelled at the onset the button press) and six motion predictors based on the estimated motion correction parameters.

Before model estimation, we applied a high-pass filter ($\sigma$ = 50 s) and spatially smoothed the data (FWHM = 5 mm.). Standard prewhitening, as implemented in *FSL*, was applied. First-level contrasts only involved predictors associated with full image trials; that is, predictors associated with blurred image trials were not used for further analysis. For the remaining four predictors of interest --- 2 (phase | full image) × 2 (valence | full image) --- we defined contrasts against baseline, i.e.,$\beta_{\mathrm{predictor}} \neq 0$ and valence contrasts, i.e., $(\beta_{\mathrm{neg | induction}} - \beta_{\mathrm{pos | induction}}) \neq 0$ and $(\beta_{\mathrm{neg | relief}} - \beta_{\mathrm{pos | relief}}) \neq 0$. The results (images with parameter and variance estimates) were subsequently registered to *FSL*’s default template (“MNI152NLin6Asym”) using a translation-only (3 parameter) affine transform using FSL Flirt (which is part of FSL FEAT) for group analysis.

#### ROI-based group analysis {#morbid-curiosity-methods-imaging-roi-analysis}

We tested two confirmatory hypotheses in this ROI-based group analysis, separately for the induction and relief phase:

1. $(\beta_{\mathrm{neg | active}} - \beta_{\mathrm{neg | passive}}) > 0$
2. $(\beta_{\mathrm{neg | active}} - \beta_{\mathrm{neg | passive}}) - (\beta_{\mathrm{pos | active}} - \beta_{\mathrm{pos | passive}}) > 0$

Note that the parameters (e.g., $\beta_{\mathrm{neg | active}}$) reflect the average of the first-level parameters (e.g., $\beta_{\mathrm{neg}}$) for a particular condition (e.g., active choice). As such, we tested four different group-level contrasts --- 2 (phase) × 2 (hypothesis) --- across two ROIs (striatum and IFG) in our group-level model.

For these confirmatory ROI-based group analyses, we used nonparametric permutation-based inference in combination with Threshold-Free Cluster Enhancement [TFCE; @smith2009threshold] as implemented in *FSL randomise* [@winkler2014permutation]. We ran *randomise* with 5,000 permutations, corrected for multiple comparisons using the maximum statistic method (the method’s default multiple comparison correction procedure), and thresholded voxelwise results at *p* < 0.025 (correction for two ROIs). Note that this analysis allows for voxel-wise inference (i.e., no cluster-based correction is used).

In these ROI-based analyses, we restricted the analysis to voxels within two a-priori specified ROIs: bilateral striatum and bilateral inferior frontal gyrus (IFG). The ROIs are based on the Harvard–Oxford Subcortical Atlas (striatum; caudate, putamen and nucleus accumbens) and the Harvard–Oxford Cortical Atlas (IFG; pars opercularis and pars triangularis) with a threshold for probabilistic ROIs > 0 [@craddock2012whole].

Whole-brain group analysis. In addition to the confirmatory ROI-based analysis, we conducted an exploratory whole-brain group-analysis. Besides the two hypotheses mentioned in the previous section, we tested the following hypotheses, again for both the induction and relief phase:

3. $(\beta_{\mathrm{pos | active}} - \beta_{\mathrm{pos | passive}}) > 0$
4. $(\beta_{\mathrm{pos | active}} - \beta_{\mathrm{pos | passive}}) - (\beta_{\mathrm{neg | active}} - \beta_{\mathrm{neg | passive}}) > 0$
5. $(\beta_{\mathrm{neg | active}} - \beta_{\mathrm{neg | passive}}) \cap (\beta_{\mathrm{pos | active}} - \beta_{\mathrm{pos | passive}})$

The $\cap$ symbol in hypothesis 5 represents a conjunction analysis between two contrasts. For these exploratory whole-brain group analyses, we used *FSL FEAT* [@woolrich2004multilevel] with a *FLAME1* mixed-effects model and automatic outlier detection [@woolrich2008robust]. Resulting brain maps were thresholded with cluster-based correction [@worsley2001statistical] using an initial (one-tailed) voxel-wise *p*-value cutoff of 0.005 (corresponding to a *z*-value above 2.576) and a cluster-wise significance level of 0.05. For the conjunction analysis (hypothesis 5), we used the minimum statistic approach [@nichols2005valid] in combination with cluster-based correction using the same cutoff and significance value as for the other two (non-conjunction based) hypotheses.

#### Further exploratory analyses {#morbid-curiosity-methods-imaging-further-exploratory-analyses}

To aid interpretation of the results, we “decoded” the brain maps resulting from the whole-brain analysis using Neurosynth [@yarkoni2011large; analyzed on March 4, 2019]. In Supplementary Table \@ref(tab:tab-morbid-curiosity-S1), we list the ten Neurosynth terms (excluding anatomical terms) with the highest overall spatial correlation with our unthresholded brain maps (which are available on Neurovault, see [Data availability](#morbid-curiosity-data-availability)).

## Data availability {#morbid-curiosity-data-availability}

All code used to preprocess, analyze, and plot the data is available from the project’s Github repository: [https://github.com/lukassnoek/MorbidCuriosityFMRI](https://github.com/lukassnoek/MorbidCuriosityFMRI). Much of this study’s code involves functionality from the *nilearn* Python package for neuroimaging analysis and visualization [[https://nilearn.github.io/](https://nilearn.github.io/) @abraham2014machine]. Unthresholded whole-brain group-level statistics maps are available from Neurovault [@gorgolewski2015neurovault]: [https://identifiers.org/neurovault.collection:5591](https://identifiers.org/neurovault.collection:5591). This repository contains whole-brain *z*-value maps for all possible contrasts across phases (induction vs. relief, referred to as “cue” and “stim”), valence (positive vs. negative, referred to as “pos” and “neg”), and group (active vs. passive, referred to as “act” vs. “pas”). For example, on Neurovault, the map associated with the $(\beta_{\mathrm{neg | active}} - \beta_{\mathrm{neg | passive}}) - (\beta_{\mathrm{pos | active}} - \beta_{\mathrm{pos | passive}}) > 0$ contrast in the induction phase is named “cue-posneg_contrast-act-pas”.

## Results {#morbid-curiosity-results}

### Participants {#morbid-curiosity-results-participants}

In total, sixty participants signed informed consent and underwent our scanning protocol. We implemented a preregistered eligibility criterion that only participants who chose negative and/or positive images in 40% or more of the trials would be paired with a participant in the passive-viewing condition. Neuroimaging analyses were performed on a sample of 54 participants (38 women; *M~age~* = 22.4, *SD~age~* = 2.9); with 27 participants in the active-choice condition and 27 participants in the passive-viewing condition.

### Behavior and subjective report

In the active-choice condition, participants chose to view the negative image in 80.6% of the trials; participants chose to view the positive image in 94.8% of the trials. In the active-choice condition, participants reported that they followed their curiosity more when making choices for negative cues (*M* = 6.20, *SD* = 0.71) as compared to positive cues (*M* = 4.72, *SD* = 1.82), *t*(24) = 3.49, *p* = 0.002, 95% CI [0.60, 2.36], *d~z~* = 0.70. Similarly, participants expressed more curiosity for negative cues (*M* = 5.41, *SD* = 1.28) than for positive cues (*M* = 4.44, *SD* = 1.60), *t*(26) = 2.42, *p* = 0.023, 95% CI [0.15, 1.78], *d~z~* = 0.47, in the passive-viewing condition. This finding is consistent with previous results that people find negative social information generally more interesting than positive social information [@oosterwijk2017choosing].

### ROI analyses

Our first set of hypotheses focused on contrasting neural activity when participants processed a negative cue in the active-choice condition with that same event in the passive-viewing condition (i.e., negative~active>passive~). As predicted, a confirmatory ROI analysis demonstrated more activation in the striatum when participants viewed a negative cue that was chosen (in the active-choice condition) as compared to watching that same negative cue in the passive-viewing condition. Figure \@ref(fig:fig-morbid-curiosity-2) shows that this contrast produced significant voxels across the striatum, in the caudate, putamen and NAcc. The ROI analysis targeting the IFG also demonstrated stronger activation in the active-choice condition as compared to the passive-viewing condition, further confirming our hypotheses.

```{r fig-morbid-curiosity-2, fig.cap='(ref:caption-fig-morbid-curiosity-2)', results='show'}
knitr::include_graphics("_bookdown_files/morbid-curiosity-files/figures/figure_2.png", auto_pdf = TRUE)
```

(ref:caption-fig-morbid-curiosity-2) Results of confirmatory ROI analyses for the induction phase (**A**) the contrast negative~active>passive~ (**B**) the contrast negative~active>passive~ > positive~active>passive~. Voxels in red/yellow represent significant *t*-values (*p* < 0.05, corrected for multiple comparisons using the maximum statistic approach). The colored outlines represent the different brain regions within the probabilistic ROIs for the striatum (left) and inferior frontal gyrus (IFG; right). The outlines represent the border of the ROIs thresholded at 0. When voxels within one ROI had a nonzero probability in more than one brain region (e.g., the caudate and nucleus accumbens), the voxel was assigned to the brain region with the largest probability.

Our second set of hypotheses focused on comparing a choice for negative information with a choice for positive information, controlling for general semantic, affective and visual processing (i.e., negative~active>passive~ > positive~active>passive~). As predicted, a confirmatory ROI analysis demonstrated more activation in the striatum when participants viewed a negative cue that was chosen as compared to a positive cue that was chosen, relative to watching that same negative or positive cue in the passive-viewing condition. Again, significant voxels were found across the striatum, in the caudate, putamen and NAcc. A similar effect was found in the IFG (see Figure \@ref(fig:fig-morbid-curiosity-2)). To explore the directionality of the effects, we extracted the parameter weights ($\hat{\beta}$) for the individual regressors for both ROIs. A visual inspection of plotted weights suggest that the patterns of neural activation reported for the striatum, are driven both by activation in the striatum when viewing negative cues in the active-choice condition, and deactivation in the striatum when viewing negative cues in the passive-viewing condition. Further details can be found in Figure \@ref(fig:fig-morbid-curiosity-S1) of the [Supplementary Materials](#morbid-curiosity-supplement).

### Whole-brain analyses

In addition to the confirmatory analyses reported above, we performed a whole-brain analysis (cluster-corrected with a voxel-wise threshold of *p* < 0.005 and a cluster-wise threshold of *p* < 0.05) for the two confirmatory contrasts (see Figure \@ref(fig:fig-morbid-curiosity-3)). In addition to activation in the regions targeted in the confirmatory ROI analyses, the whole-brain analyses for the negative~active>passive~ contrast demonstrated robust activation in the ACC, paracingulate gyrus, superior frontal gyrus, middle frontal gyrus, OFC, insular cortex, frontal operculum, frontal pole, temporal pole, thalamus and brain stem, when participants viewed a negative cue that was chosen (in the active-choice condition) as compared to watching that same negative cue in the passive-viewing condition. A complete table of the significant clusters can be found in the [Supplementary Materials](#morbid-curiosity-supplement) (Table \@ref(tab:tab-morbid-curiosity-S2), as well as the significant clusters associated with the positive~active>passive~ contrast, Table \@ref(tab:tab-morbid-curiosity-S3)). The whole-brain results for the negative~active>passive~ > positive~active>passive~ contrast are presented in Table \@ref(tab:tab-morbid-curiosity-1). This contrast demonstrated stronger activation in the ACC, paracingulate gyrus, superior frontal gyrus, OFC, insular cortex and frontal operculum, when participants viewed a negative cue that was chosen as compared to a positive cue that was chosen (relative to watching that same negative or positive cue in the passive-viewing condition).

```{r fig-morbid-curiosity-3, fig.cap='(ref:caption-fig-morbid-curiosity-3)', results='show'}
knitr::include_graphics("_bookdown_files/morbid-curiosity-files/figures/figure_3.png", auto_pdf = TRUE)
```

(ref:caption-fig-morbid-curiosity-3) Results of the exploratory whole-brain analyses for the induction phase: (**A**) the contrast negative~active>passive~ (red), positive~active>passive~ (blue), and their conjunction (yellow); (**B**) the contrast negative~active>passive~ > positive~active>passive~; (**C**) the contrast positive~active>passive~ > negative~active>passive~ (empty).

```{r tab-morbid-curiosity-1, results='asis'}
data = suppressWarnings(read_csv('_bookdown_files/morbid-curiosity-files/table_1_data.csv'))
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T, caption = 'Cluster statistics and associated brain regions from the exploratory whole-brain analysis.') %>%
    kable_styling(full_width = T, font_size = 9) %>%
    column_spec(column = c(1, 2, 3, 4, 5, 6, 8, 9), width = "1em") %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = 'The X, Y, and Z coordinates refer to MNI152 (2 mm) space. The regions are taken from the Harvard–Oxford (sub)cortical atlas and voxels are assigned to regions based on their maximum probability across all ROIs within the atlas. *K* refers to the number of voxels within a particular region.')
```

To further interpret the whole brain results, we used the “decoder” function from Neurosynth [@yarkoni2011large] to find key terms associated with particular patterns of neural activation. The neural pattern produced by the negative~active>passive~ > positive~active>passive~ contrast resulted in the following key terms (top-10): reward, task, monetary, semantic, anticipation, incentive, demands, fear, autobiographical, retrieval (see [Supplementary Materials](#morbid-curiosity-supplement), Table \@ref(tab:tab-morbid-curiosity-S1)). Although it is important to be careful with drawing reverse inference conclusions about the psychological meaning of neural activation [@poldrack2006can], these terms at minimum suggest that the neural pattern associated with choosing negative content (relative to choosing positive content and passive-viewing) is similar to neural patterns associated with reward and the processing of extrinsic incentives.

It is important to note that none of the confirmatory ROI analyses nor any of our exploratory analyses showed significant differences in the relief phase (i.e., when viewing the image). This is in line with previous work on curiosity [@gruber2014states] that found robust neural activation when inducing curiosity (e.g., presentation of trivia questions), but not when relieving curiosity (e.g., presentation of trivia answers). Other work on curiosity, that did find differences in the relief phase, contrasted a condition in which curiosity was relieved, with a condition that withheld information [@van2018induction] or a condition that showed irrelevant information [@jepma2012neural]. In the present study, however, we contrasted the relief phase in the active-choice condition with viewing the exact same information in the passive-viewing condition. Since we found that participants in the passive-viewing condition also reported a reasonable amount of curiosity in response to the cue, curiosity relief may have occurred in both the active-choice and the passive-viewing condition.

## Discussion {#morbid-curiosity-discussion}

In the last decade, neuroscientific research has made a major contribution to a better understanding of choice, value and curiosity. Most of this work, however, has focused on extrinsically rewarding information [@braver2014mechanisms; @bartra2013valuation], or on an intrinsically-motivated curiosity for neutral or positive information [e.g., @gruber2019curiosity; @kang2009wick; @van2018induction]. The present study demonstrates that choosing intensely *negative* stimuli engages similar brain regions as those that support extrinsic incentives and regular curiosity [@kidd2015psychology; @sakaki2018curiosity; @diekhof2012role; @bartra2013valuation; @gruber2019curiosity]. We found that a deliberate choice for death, violence or harm is associated with activation in the striatum (NAcc, caudate and putamen), inferior frontal gyrus, anterior insula, orbitofrontal cortex and anterior cingulate cortex. This pattern was present both when we contrasted negative cues (that were chosen) with passively viewing these cues, and when we contrasted negative cues (that were chosen) with positive cues (that were chosen), controlling for passive viewing. These findings reflect the induction phase in which participants anticipated on their choice; we found no differences in the relief phase in which participants viewed images.

Although we found activation in regions associated with reward and incentives, it is important to be careful with the conclusion that it is “rewarding” to choose negative information [@poldrack2006can]. Reward regions are associated with a multitude of psychological processes [@bartra2013valuation], and reward is a construct with different dissociable dimensions, including “liking” and “wanting” [e.g., @berridge2009dissecting; @weber2018frontostriatal]. In addition, the distributed pattern of activation that we found most likely reflects psychological processes beyond reward as well. In the next section, we address several, non-mutually exclusive, interpretations of this distributed pattern, including an interpretation regarding the potential reward value of negativity, the possibility that this neural pattern reflects uncertainty, and an interpretation that considers the particular characteristics of the task.

@golman2015curiosity propose that a desire to obtain information can be driven by a motive to make better decisions, a motive to experience pleasantness, or a motive to engage with information “for its own sake” (p. 3). The negative choices made by our participants are most likely consistent with the latter intrinsic motive. Participants chose images that were not hedonically pleasing and, in contrast to other recent (neuroscientific) studies targeting curiosity [e.g., @van2018induction; @kobayashi2019diverse], there was no monetary outcome associated with choosing (negative) images. The question that follows then is: what is the value of negativity?

One possibility is that knowledge acquisition is inherently valuable [@murayama2019process; @marvin2016curiosity], even when people acquire knowledge about negative social situations that involve death, violence or harm. Indeed, the knowledge update that follows from engaging with negative information might be valuable for building a realistic model of the world [@baumeister2001bad] or for dealing with future aversive situations. Applying this interpretation to our findings, we propose that the brain predicts a larger information gain in the negative choice condition than in the positive choice condition. This is reflected in stronger activation of reward circuitry (e.g., NAcc, caudate, putamen) that might track the expected value of knowledge acquisition [@murayama2019process], or the salience of the information [@bartra2013valuation]. Note that we focus here on the informational value of valenced stimuli in epistemic terms [@berlyne1966curiosity; @litman2005curiosity; @loewenstein1994psychology; @murayama2019process], but the value of choosing to engage with negative or positive stimuli may also lie in the emotional experiences or sensations that are evoked by the stimulus [@zuckerman1986personality; @zuckerman1979; see for an overview @tamir2016people].

Another possible explanation for the present findings lies in the momentary uncertainty that people may experience when viewing negative cues (e.g., How extreme will the image be?), in combination with the predicted reduction of this uncertainty when choosing to view images. Curiosity is often seen as a desire to resolve uncertainty [@berlyne1966curiosity; @loewenstein1994psychology; @gottlieb2018towards] and several recent studies have demonstrated that people experience higher levels of curiosity for uncertain stimuli [@van2018induction; @kobayashi2019diverse]. People even engage with aversive stimuli to reduce uncertainty, preferring a reduction in uncertainty above a negative outcome [@hsee2016pandora]. Neuroscience studies have shown that uncertainty is associated with activation in the OFC, ACC and anterior insula [@singer2009common; @bach2012knowing; @harris2008functional], regions we also found to be active in the active-choice condition. Moreover, we found that the OFC, ACC and anterior insula were more strongly engaged when viewing chosen negative cues, as compared to chosen positive cues. The neural pattern found in the negative choice condition (as compared to the positive choice condition) may thus reflect a higher level of outcome uncertainty, and/or a stronger expected reduction in uncertainty, in interaction with, or irrespective of [@harris2008functional], the reward value of the information.

A final interpretation of the present findings revolves around the demands of the task that people performed in the choice-condition. Deciding how to respond to a negative cue may be an engaging and effortful task, that requires careful weighing of options. Several perspectives suggests that the IFG and ACC may support such processes. In a recent framework, @gruber2014states propose that curiosity involves an appraisal process, supported by the IFG, that determines one’s ability to deal with information [see also @silvia2008interest]. Notably, they predict enhanced involvement of the IFG in situations that involve a dilemma in which people have to choose between approaching or avoiding information. Other authors have suggested that the dACC may be particularly active in effortful or exploratory tasks that demand cognitive control, as compared to tasks that can be performed by engaging in automatic behavior [@shenhav2016dorsal]. When applying these perspectives to the current findings, stronger ACC and/or IFG activation for negative choice as opposed to passive viewing may reflect the specific cognitive demands (e.g., appraisal, weighing options, effort) of the active-choice condition relative to the passive-viewing condition. Furthermore, stronger ACC and/or IFG activation for negative choice as opposed to positive choice may reflect the relatively complex cost–benefit analysis that precedes a choice to choose a negative stimulus, as compared to the relatively automatic or “default” decision to choose a positive stimulus. This interpretation is consistent with the characterization of “morbid curiosity” as a conflict state, in which people “want” information that they do not “like” [@rime2005brief; @litman2005curiosity].

The present study has a few limitations that we should address. First of all, all contrasts calculated in the present study are relative to the passive-viewing condition (as preregistered). We deliberately made this decision, because we wanted to isolate the neural activation associated with a deliberate choice to view a stimulus. More specifically, in a direct contrast between chosen negative cues and chosen positive cues, it would have been impossible to know whether the pattern of neural activation was driven by *choosing* negative versus positive information, or by simply *viewing* negative versus positive cues. The yoked procedure, and the resulting contrasts, control for the latter, since activation associated with viewing negative versus positive cues is subtracted out. Furthermore, confronting participants with emotional material that they cannot control, is common practice when scientists study affective/emotional experience [@lindquist2016brain; @lang2010emotion] and emotion regulation [@buhle2014cognitive; @wager2008prefrontal], and thus serves as a meaningful control condition. Nevertheless, it is important to note that our results in the striatum were partly driven by deactivation in the passive viewing condition (see Figure \@ref(fig:fig-morbid-curiosity-S1), [Supplementary Materials](#morbid-curiosity-supplement)). Since this pattern of deactivation was not predicted in our preregistered analysis protocol, and our study was not designed for optimal detection of directional effects, we will not discuss this finding further. A design that contrasts choosing versus passive viewing within-subjects may clarify whether explicitly anticipating a negative outcome that cannot be controlled indeed deactivates the striatum.

Second, the present design does not allow for a contrast between agreeing to view an image and refusing to view an image, because participants said “yes” to the cue in the vast majority of the trials (i.e., 81% for negative cues; 95% for positive cues). As a future direction, it may be insightful to develop a design that artificially balances yes and no responses within the same participant to investigate differences in reward circuitry between approaching and avoiding negative information. In the present study, however, we deliberately chose not to restrict or disregard participant’s choices, because we wanted to keep the decision process as natural as possible. Having said that, a fMRI scanner is a relatively boring environment, and previous research has shown that boredom prompts people to seek out novel experiences [@bench2019boredom]. Thus, the scanning environment may have stimulated participants to say yes more often (across both conditions) than they would have done in other settings.

A third limitation is that we cannot rule out the possibility that arousal contributes to our findings when contrasting negative and positive cues. Although we matched the social negative and positive cues (and images) in terms of valence extremity (i.e., positive cues were perceived as equally positive as negative cues were perceived as negative), the cues (and images) were not matched in terms of arousal. We accepted the difference in arousal as a consequence of the content criterion for negative images (i.e., displaying death, violence or harm within a social context), and our deliberate choice not to include erotic images, considering the practical considerations associated with erotic content [@wierzba2015erotic]. It is important to note that in the negative choice vs. passive-viewing contrast the effect of viewing an arousing cue is subtracted out. The negative choice vs. positive choice contrast, however, does not control for the net difference between the arousing quality of the negative and positive cues. Therefore, it is possible that the pattern of neural activation when comparing negative vs. positive choice, in particular in the ACC and insula [@satpute2019deconstructing; @citron2014emotional], reflects, to some extent, the higher arousal value of the negative vs. positive verbal cues.

A fourth and final limitation is that the present study focused on behavior, without incorporating trial-by-trial ratings of curiosity. This restricts the extent to which the present findings speak to the subjective experience of curiosity. In regular curiosity, for example when processing trivia questions, there are little costs associated with acting on curiosity, and thus it may be sufficient to focus on subjective ratings of curiosity. With morbid curiosity, however, the stakes are higher. Although people can experience curiosity for a negative stimulus without choosing to engage with it, behavior is, in our opinion, the most straightforward indicator of how the conflict state of morbid curiosity is resolved. In other words, only when people choose to engage with negative information can we deduce that the predicted benefits (e.g., knowledge acquisition, uncertainty reduction) outweigh the predicted costs of engaging with the information (e.g., not being able to cope with the content). Furthermore, a focus on choice connects to the many behavioral expressions of this phenomenon in the real world (e.g., “rubbernecking” on the freeway; clicking on a social media link). Future research should investigate whether the subjective experience of curiosity for negative stimuli is associated with a similar neural pattern (e.g., reward circuitry, ACC, insula, OFC) as the pattern found with the present choice paradigm.

Despite the questions that the present study provokes, our findings represent an important step in nuancing models of decision-making, valuation and curiosity. In light of the ubiquity of exploring negativity in daily life, we believe that it is crucial to start thinking about the value of seeking out negative content.

<!--chapter:end:05-morbid-curiosity.Rmd-->

```{r setup-hypothesis-kernel-analysis, include=FALSE}
knitr::opts_chunk$set(results = 'hide', echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(kableExtra)
```

# Using predictive modeling to quantify the importance and limitations of action units in emotion perception {#hypothesis-kernel-analysis}
\chaptermark{Predictive modelling of action units}

\newpage
\normalsize

`<p><strong>Abstract</strong></p>`{=html}
`\begin{abstract}`{=latex}
Bla bla
`\end{abstract} \newpage`{=latex}

<!--chapter:end:06-hypothesis-kernel-analysis.Rmd-->

# Affective face perception integrates both static and dynamic information {#static-vs-dynamic}
\chaptermark{Static vs. dynamic}

\vspace*{\fill}

---

```{r setup-chapter-07, include=FALSE}
knitr::opts_chunk$set(results = 'hide', echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(kableExtra)
```

\newpage
\normalsize

`<p><strong>Abstract</strong></p>`{=html}
`\begin{abstract}`{=latex}
Facial movements are crucial for affective face perception, yet research has shown that people are also influenced by features of the static face such as facial morphology. Most studies have either manipulated dynamic features (i.e., facial movements) or static features (i.e., facial morphology) making it impossible to evaluate the relative contribution of either. The current study investigates the effects of static and dynamic facial features on three affective properties (categorical emotion, valence, and arousal) inferred from stimuli in which both types of features have been independently manipulated. Using predictive machine learning models, we show that static and dynamic features both explain substantial and orthogonal variance in categorical emotion and valence ratings, while arousal ratings are only predicted accurately using dynamic, but not static, features. Moreover, using a multivariate reverse correlation approach, we show that static and dynamic features communicating the same affective property (e.g., categorical emotions) are manifested differently in the face. Our results demonstrate that in order to understand affective face perception, both facial morphology and facial movements should be considered independently.
`\end{abstract} \newpage`{=latex}

## Introduction {#svsd-introduction}

Faces are an important element of our daily life; faces communicate affective states of others and elicit feelings in ourselves. We might infer that someone is happy when she raises the corners of her mouth and wrinkles her eyes and we might feel unpleasant when confronted with a disapproving frown. Faces convey such impressions through facial movements, which are thought to be the primary instrument to express and communicate affective states to others [@Jack2015-sh]. Nevertheless, most research on affective face perception has used static depictions of facial expressions in which only the peak of the expression is shown. As such, facial movements in static stimuli are not directly observed but have to be inferred. Furthermore, although facial movements are arguably the primary drivers of how we perceive and are affected by others’ faces, studies have argued that facial movements alone are unlikely to capture all variation in how we perceive and are affected by others’ faces [@Barrett2019-bc; @snoek-submitted]. One possible additional source of information that may complement the dynamic information conveyed by facial movements is the static, or “neutral”, face. Although the static face is unrelated to the expressor’s affective state, studies have shown that features of the static face, such as facial morphology and complexion, in fact influence how we perceive and experience faces [@Hess2009-xo; @Neth2009-eh]. Although much research has examined both static features and dynamic features in the context of affective face perception (reviewed below), they have never been manipulated and compared using the same stimuli in the same experiment. In the current study, we seek to investigate, quantify, and disentangle the relative contribution of these static and dynamic facial features to affective face perception.

The attempts to relate specific facial movements to affective states go back as far as Charles Darwin’s descriptions of stereotypical facial expressions associated with categorical emotions [@Darwin1872-nv]. Since Darwin, more quantitative efforts have been made to establish robust associations between facial movements and affective states, and categorical emotions in particular. An important development that facilitated these efforts was the Facial Action Coding System [FACS; @Ekman1976-hm], which outlines a way to systematically measure, quantify, and categorize facial movements into components called “action units” (AUs). Using FACS, studies have investigated and proposed specific configurations of facial movements associated with affective states such as categorical emotions [@Jack2012-eq; @Jack2014-ku; @Wegrzyn2017-ke], valence and arousal [@Hofling2020-mk; @Liu2020-vo], and pain [@chen2018distinct; @Kunz2019-uh; for a comprehensive overview, see @Barrett2019-bc]. Moreover, advances in computer vision spurred the development of algorithms that are able to classify affective states based on action units [@Cohn2007-xe; @Lien1998-bg] or other facial features such as facial landmarks [@Toisoul2021-yc] or geometric features [@Barman2019-af; @Murugappan2021-yj].

Despite the fact that facial features arguably need to be dynamic to communicate affective states, static morphological features of the face have been found to influence, or “bias”, how people interpret others’ faces. This claim is supported by research showing that people can perceive emotions in neutral (i.e., non-expressive) faces that by definition only contain static but no dynamic features. Such an effect has been demonstrated by manipulating structural features of neutral faces, where, for example, a neutral face with a lower nose and mouth or higher eyebrows was more likely to be perceived as sad [@Neth2009-eh; see also @Franklin2019-qo]. Similar effects have been observed in relation to certain demographics (gender, ethnicity, or age) or social judgements (e.g., dominance) that are associated with specific variations in facial morphology. For instance, research has shown that neutral male faces are more likely to be perceived as angry than neutral female faces [@Brooks2018-ao; @Adams2016-tz; @Craig2018-jm] and people perceive fewer and less intense emotions in older faces relative to younger faces [reviewed in @Folster2014-zy]. The dominant explanation for these affective inferences from static faces is that these effects are driven by the visual resemblance of static features (e.g., a relatively low brow) to dynamic features associated with a particular affective state [e.g., lowering one’s brow as part of an anger expression; @Hess2009-xo; @Said2009-tf; @Zebrowitz2017-qe; but see @Gill2014-hx; @Guan2018-hq].

As discussed, many studies have investigated dynamic and static features that underlie affective face perception. However, because these studies usually manipulate either dynamic facial movements [@Jack2009-yy; @Jack2014-ku] *or* static facial features [@Franklin2019-qo; @Neth2009-eh; for an exception, see @Gill2014-hx], the relative contribution of dynamic and static information remains unknown. In addition, studies investigating the effect of dynamic features (such as AUs) on affective face processing often use static stimuli [i.e., images; @Krumhuber2013-qi] which only shows the “peak” of the expression. The use of such static stimuli means facial movements are not directly visible and need to be inferred. As a consequence, in such studies the effect of dynamic and static features on affective face perception are fundamentally confounded. For example, a participant cannot know if a relatively low eyebrow is low because of a facial muscle movement or just because of the structure of the face. This potential confound of static features is even more problematic in automated facial emotion recognition systems, which often require static images as input (e.g., including the emotion recognition systems offered by Microsoft and Google^[[https://azure.microsoft.com/en-us/services/cognitive-services/face](https://azure.microsoft.com/en-us/services/cognitive-services/face), [https://cloud.google.com/vision/docs/detecting-faces](https://cloud.google.com/vision/docs/detecting-faces)], which may inadvertently use static facial features associated with certain demographic groups [e.g., based on ethnicity or age, @Xu2020-jd; @Bryant2019-sg] leading to biased predictions. Moreover, the confounding influence of static features is especially problematic for the aforementioned hypothesis that static features important for affective face perception visually resemble corresponding dynamic features [@Hess2009-xo; @Hess2009-jz; @Said2009-tf].

To overcome these limitations, the current study investigates the relative contribution of dynamic and static information to affective face perception (see Figure \@ref(fig:fig-svsd-1)). To disentangle these two sources of information, we use a psychophysics approach that features video stimuli in which both the dynamic information (i.e., facial movements) and static information (i.e., facial morphology) is manipulated. In terms of affective properties, we focus on categorical emotions inferred by the observer in the expressor as well as valence and arousal elicited in the observer. Although these two concepts are fundamentally different (the former is an estimate of the affective state of the expressor while the latter two reflect the affective state of the observer), we investigate these properties to investigate how static and dynamic facial features affect both affective perception (categorical emotions) and affective experience (valence and arousal). We use machine learning models that predict human ratings of these affective properties based on dynamic and static information. Using this approach, which focuses on cross-validated predictive model performance rather than statistical significance [@Yarkoni2017-om], we are able to precisely quantify and compare the variance explained by static and dynamic features of the face. Finally, we implement a multivariate reverse correlation technique to reconstruct, visualize, and compare the mental representations of the facial features that underlie the information extracted and used by our static and dynamic models. This technique facilitates the interpretation of the commonalities and differences between static and dynamic facial features important for predicting categorical emotion, valence and arousal.

```{r fig-svsd-1, fig.cap='(ref:caption-fig-svsd-1)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_1.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-1) Decomposition of facial expressions in static information (facial morphology) and dynamic information (facial movement), where static information is operationalized as shape deviation relative to the average face while dynamic information is operationalized as shape deviation relative to the static face. The current study’s aim is to quantify the importance of static information, relative to dynamic information, in affective perception.

## Methods {#svsd-methods}

### Participants {#svsd-participants}

Thirteen participants (7 female, 6 male) participated in the “Facial Expression Encoding and Decoding” project, which consisted of six psychophysics sessions and six (7T) MRI sessions. Participants were recruited through Facebook. With the exception of three participants, all participants were students of the Research Master Psychology or master Brain & Cognitive Sciences at the University of Amsterdam. Several strict exclusion criteria for participation were applied, including standard MRI safety-related exclusion criteria, psychiatric conditions, use of psychopharmacological medication, color blindness, and difficulty with remembering faces. Additionally, participants had to have participated in MRI research before and had to be between 18 and 30 years of age (resulting sample *M*~age~ = 22.6, *SD*~age~ = 3.7).

Across six psychophysics sessions, participants rated the perceived valence, arousal, and categorical emotion of short clips of dynamic facial expressions. These stimuli were generated using a 3D Morphable Modeling toolbox developed by and described in @Yu2012-ag. The toolbox allows to generate short video clips of facial expressions with a configuration of prespecified “action units” (AUs) that describe particular visually recognizable facial movements. It does so by manipulating the structure of a 3D mesh representing the surface of the face according to the expected deformation in response to the activation of one or more AUs. Apart from amplitude (ranging from 0, inactive, to 1, maximally activated), several temporal parameters corresponding to the AU activation (onset latency, offset latency, acceleration, deceleration, and peak latency) can be manipulated. In the toolbox, AU animations can be applied to any 3D face mesh from a database of 487 different faces (“face identities”), which vary in sex, age, and ethnicity.

For our stimuli, we used 50 different face identities that were restricted to be of Western-Caucasian ethnicity and to an age between 18 and 30 years old (i.e., the same age range as our participants). This set of face identities contained 36 female faces and 14 male faces. To animate each face stimulus, we selected a random subset of AUs from a set of twenty bilateral AUs (AU1, AU2, AU4, AU5, AU6, AU7, AU9, AU10Open, AU11, AU12, AU13, AU14, AU15, AU16Open, AU17, AU20, AU24, AU25, AU27i, AU43). The number of AUs for each stimulus were drawn randomly from a binomial distribution with parameters n = 6 and p = 0.5 (but with a minimum of 1 AU). The amplitude of each AU activation was randomly selected from three equidistant values (0.333, 0.667, and 1). The temporal parameters were the same for each stimulus, which corresponds to a stimulus with a duration of 1.25 seconds and in which each AU activation peaks at 0.7 seconds. Each of the 3D face meshes belonging to a single dynamic stimulus was rendered as a short (2D) video clip with a resolution of 600 × 800 pixels containing 30 frames and a frame rate of 24 frames per second.

### Experimental design {#svsd-experimental-design}

In total, 752 unique AU configurations were generated with the parameters described above. This process was done separately for two disjoint sets of AU configurations: one set of 696 configurations functioning as the *optimization set* (used for model fitting) and one set of 56 configurations functioning as the *test set* (used for model validation; see [Cross-validation](#svsd-cv) section). To minimize correlation between AU variables, the sampling process of the number of AUs and AU amplitudes was iterated 10,000 times and the selection yielding the smallest absolute maximum correlation across all AU pairs was chosen (final $r = 0.093$). Then, the AU configurations were randomly allocated to the 50 face identities. To minimize the correlation between face identity and AUs, this random allocation was iterated 10,000 times and the selection yielding the smallest (absolute) maximum correlation across all AU-face identity pairs (final $r = 0.126$) was chosen. This counterbalancing process was done separately for the optimization and test set.

### Procedure {#svsd-procedure}

Each participant completed five psychophysics sessions in which they rated a subset of the facial expression stimuli. In the sixth session, participants rated the 50 static faces (i.e., without AU animations) on their perceived attractiveness, dominance, trustworthiness, valence and arousal. These ratings are not used in the current study. Because the test set trials were repeated three times (to estimate a noise ceiling; see Noise ceiling estimation section), the total number of rated stimuli was (696 + 56 × 3 = ) 864. Originally, three sessions were planned in which participants rated 288 stimuli each. Due to a programming bug, however, all but one of the participants rated (unbeknownst to them) the same 288 stimuli in these three sessions. As such, participants completed two extra sessions in which they rated the remaining stimuli with the exception of the (56 × 2 =) 112 test trials, because the three repetitions needed to estimate the noise ceiling were already obtained in the first three sessions. As such, the total number of stimulus ratings was (288 × 3 + 232 × 2 = ) 1328 (and 864 ratings for the single participant without the accidental session repeats).

In each session, the 288 stimuli (or 232 stimuli in session 4 and 5) were rated on three affective properties: categorical emotion, valence, and arousal. Categorical emotion and valence/arousal were rated on separate trials, so each of the stimuli were presented twice (once for a categorical emotion rating and once for a valence/arousal rating). Stimuli were presented in blocks of 36 trials, in which either categorical emotion or valence/arousal was rated. The trial block’s rating type was chosen randomly.

Each session lasted approximately 1.5 hours, which included breaks (after each rating block), setting up and calibrating the eyetracker (which is not used in the current study), an extensive instruction, and a set of practice trials (only in the first block of each session; 10 categorical emotions and 10 valence/arousal ratings). Participants completed the ratings in a dimly lit room, with their head resting on a chin rest (to minimize head movement for the concurrent eyetracking), positioned 80 centimeters from a full HD (1920 × 1080 pixels) monitor (51 × 28.50 cm) on which the rating task was presented using the software package PsychoPy2 [v1.84; @Peirce2019-rj]. Participants used a standard mouse (used with their dominant hand) to submit responses during the rating task.

#### Stimulus presentation {#svsd-stimulus-presentation}

Stimuli were presented on a gray background (RGB: 94, 94, 94). Each trial block started with a cue regarding the affective property that should be rated (categorical emotion or valence/arousal) and was followed by a ten second baseline period presenting a fixation target (a white circle with a diameter of 0.3 degrees visual degree, DVA). Then, each facial expression stimulus was presented for 1.25 seconds (the full duration of the clip). The stimulus was shown at the center of the monitor with a size of 6 × 8 DVA (preserving the aspect ratio of the original clip, i.e., 600 × 800 pixels). The stimulus was followed by an interval of 1 second plus a duration drawn from an exponential distribution (with λ = 1) in which only the fixation target was shown. This interval was followed by the presentation of the rating screen (discussed below). The rating screen was shown until the participant gave a response (mouse click). Another interval followed (which included a fixation target) with a duration of 1 second plus a duration drawn from an exponential distribution (with $\lambda = 1$), after which the next stimulus was shown. After all 36 trials of a trial block, another baseline period including a fixation target was shown and was followed by the rating type cue of the next block, which the participant could start by a mouse click. After four trial blocks, participants could take a break if desired.

#### Categorical emotion ratings

For the categorical emotion ratings, participants were instructed to “Judge the faces with regards to the emotion that the face shows, if any” (in Dutch: “Beoordeel de gezichten op de emotie die de gezichten (mogelijk) laten zien”). For each categorical emotion rating, participants were presented with a prompt which included six trapezoids (with the corresponding labels “anger”, “disgust”, “fear”, “happiness”, “sadness”, and “surprise” next to it) and a single circle (with the label “None”) arranged in a circle with equal angles between each of the seven options (i.e., 360/7 degrees; see Figure \@ref(fig:fig-svsd-2)). The trapezoids had a length of 7 DVA, the circle had a radius of 1 DVA, and the text labels had a text height of 0.7 DVA; the trapezoids, circle, and text were all white. At the onset of the rating prompt, the mouse cursor appeared in the middle of the screen. Participants were instructed to click on the trapezoid corresponding to the perceived emotion from the previously shown facial expression stimulus. Furthermore, participants were instructed to simultaneously rate the intensity of the emotion, which was linked to the radial position of the mouse click within the trapezoid, where responses closer to the center indicated lower intensity and responses farther away from the center indicated higher intensity. After the participant clicked on the trapezoid, the trapezoid changed color from white to black anywhere between the response and the side of the trapezoid closest to the center (see Figure 2). Whenever the facial expression stimulus did not match any of the six categorical emotion labels (“anger”, “disgust”, “fear”, “happiness”, “sadness”, and “surprise”), participants were instructed to click on the circle above the label “None” (“Geen van allen” in Dutch). There was no intensity rating associated with “None” responses. After a response and the change in color of the selected trapezoid or circle, the rating prompt remained on screen for 0.2 seconds. There was no response time limit for the ratings.

#### Valence/arousal ratings 

For the valence and arousal ratings, participants were asked to rate how they experienced each face in terms of arousal (on a scale ranging from “not activated” to “activated”) and valence (on a scale ranging from “unpleasant” to “pleasant”). The instructions explained the valence dimension as follows: “On the pleasant/unpleasant dimension, you should indicate how *you* experience the faces” (in Dutch: “Met de onprettig/prettig dimensie geef je aan hoe *jij* de gezichten ervaart”). The instructions explained the arousal dimension as follows: “On the not activated/activated dimension, you indicate how much the face activates you. With ‘activated’, we mean that the face makes you feel alert, energized, and/or tense. With ‘not activated’, we mean that the face makes you feel calm, quiet, and/or relaxed” (in Dutch: “Met de niet geactiveerd/geactiveerd dimensie geef je aan in hoeverre het gezicht jou activeert. Met “geactiveerd” bedoelen we dat het gezicht je alert, energiek, en/of gespannen doet voelen; met “niet geactiveerd” bedoelen we dat het gezicht je kalm, rustig, en/of ontspannen doet voelen”).

Valence and arousal ratings were acquired using a single rating prompt (see Figure \@ref(fig:fig-svsd-2)). This prompt included two axes (white lines), a horizontal and a vertical one, of equal length (14 DVA). The horizontal axis represented the arousal axis with negative values indicating low arousal (“Not activated”, or “Niet geactiveerd” in Dutch) and positive values indicating high arousal (“Activated”, or “Geactiveerd” in Dutch). The vertical axis represented the valence axis with positive values indicating positive valence (“Pleasant”, or “Prettig” in Dutch) and negative values indicating negative valence (“Unpleasant”, or “Onprettig” in Dutch). Labels at the ends of the axis lines were white and had a text height of 0.7 DVA. Participants were instructed to indicate the valence and arousal of the previously shown facial expression facial expression stimulus by a single mouse click anywhere within the 2D space. After a response, a white circle (0.3 DVA) appeared at the clicked position for 0.2 seconds, after which the rating prompt disappeared.

```{r fig-svsd-2, fig.cap='(ref:caption-fig-svsd-2)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_2.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-2) Prompts for categorical emotion ratings (left) and valence/arousal ratings (right).

### Data preprocessing {#svsd-data-preproc}

#### Rating preprocessing

For the categorical emotion analyses, we removed all ratings in which the participant responded with “None”. This left on average 1125 trials (*SD* = 165), which is 87% of the total number of trials. The valence and arousal ratings were not filtered or otherwise preprocessed. The accidentally repeated trials from session 1 (that do not belong to the test set; see [Cross-validation](#svsd-cv) section) were reduced to a single rating for each unique stimulus by taking the most frequent emotion label (for the categorical emotion ratings) or the average rating value (for the valence/arousal ratings) across repetitions. In addition, the valence and arousal ratings were mean-centered separately for the optimization and test set to correct for spurious differences in the mean across the two partitions.

#### Static and dynamic feature operationalization

As an operationalization of face structure, we use the set of 3D face meshes underlying each dynamic facial expression stimulus. The reason for focusing on the underlying 3D face mesh, instead of the rendered 2D pixel array actually shown to the participants, is that the 3D face mesh allows to isolate face structure information from face texture information while in the 2D pixel space these two factors are confounded. In the 3D face space, each stimulus can be represented as a collection of 30 meshes (corresponding to the 30 frames in each animation), each containing a set of 3D coordinates making up the *vertices* of the mesh. In our stimulus set, each 3D face mesh has 31049 vertices. As such, any given stimulus can be represented as a 30 (frames) ×  (vertices) × 3 (coordinates) array with values that represent the position of the vertices in real-world space.

The first step in our feature operationalization pipeline is to separate the static and dynamic information. We operationalize the static information as the 3D face mesh corresponding to the first frame of each stimulus (which corresponds to a “static” or “neutral” face mesh without any AU activation). Using this operationalization, the static information from two stimuli with different AUs (but the same face identity) is equivalent. We operationalize the dynamic information for each stimulus as the *difference* between the vertex positions at the frame containing the peak AU activation (frame 15) and the first frame. As such, both the static information and the dynamic information of each stimulus can be represented as a 31049 (vertices) × 3 (coordinates) array. 

Using all vertex positions as features means that the number of features (i.e., 31049 × 3 = 93147) would vastly outnumber the number of observations (i.e., 752 unique dynamic facial expressions), which makes model fitting prohibitively computationally expensive and bears a high risk of overfitting. As such, reducing the number of features is desirable. The fact that the vertices are highly spatially correlated (i.e., neighboring vertices likely have similar coordinates) warrants using principal component analysis (PCA) to reduce the total feature space. Here, we use PCA to reduce the original feature space (containing 93147 dimensions) to a 50-dimensional space containing variables that represent linear combinations of the original features. Formally, the PCA model estimates a 2D weight matrix, $W$, with dimensions 50 × 93147 and a mean vector, $\hat{\mu}$, with length 93147, which are then used to transform the original set of vertices ($V$; flattened across coordinates) into a 50-dimensional set of features ($X$):

\begin{equation}
X = (V - \hat{\mu})\hat{W}^{T}
\end{equation}

In this lower-dimensional feature space, almost all variance from the high-dimensional feature space is preserved: about 99.99% for the static feature space and about 99.95% of the dynamic feature space (see Supplementary Figure \@ref(fig:fig-svsd-S1)). The representation of  the top four PCA components in vertex space are, for both the static and dynamic feature set separately, visualized in Figure \@ref(fig:fig-svsd-3), which shows that each PCA component represents an interpretable facial movement (e.g., PC1 of the dynamic feature set represents a mouth drop and PC1 of the static feature set represents a relatively wide and long face with a relatively strongly protruding nose and brow).

```{r fig-svsd-3, fig.cap='(ref:caption-fig-svsd-3)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_3.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-3) Visualization of the extracted PCA components. The first four PCA components of both the dynamic features (left) and static features (right) are visualized by plotting the inverse transform of a single low-dimensional feature set to 3 standard deviations above the average ($X_{j} := 3\hat{\sigma}_{X_{j}}$). Colors represent the signed deviation from the mean in standard deviations.

Finally, both the static and dynamic PCA-transformed features ($X_{j}$) are divided by their estimated standard deviation ($\hat{\sigma}_{j}$) across observations:

\begin{equation}
X_{j} := \frac{X_{j}}{\hat{\sigma}_{j}}
\end{equation}

This operation makes sure that each feature has the same scale and thus each feature is equally strongly regularized during model fitting (see [Predictive analysis](#svsd-pred-analysis) section). Note that usually each feature is additionally mean-centered as well, but this is not necessary because the PCA transform already centers the data.

In the current article, we will refer to a set of PCA-transformed features ($X$) as a *feature set*. In addition to having a dynamic and static feature set, we also horizontally concatenated these two feature sets to create a combined feature set (which thus contains 100 features), which serves to investigate to what extent the two feature sets explain unique variance in the target variables.

### Predictive analysis {#svsd-pred-analysis}

For our main analysis, we predicted the categorical emotion, valence, and arousal ratings based on static and dynamic features using separate models for each participant. Because the categorical emotion ratings represent a categorical variable, the categorical emotion analysis used a classification model. The valence and arousal ratings represent continuous variables and are therefore analyzed using a regression model. These two types of models are discussed in turn.

#### Categorical emotion model {#svsd-cat-emo}

The categorical emotion analysis used a regularized multinomial logistic regression model as implemented in the Python package *scikit-learn* [@Pedregosa2011-bp]. The choice for this particular predictive model stems from its probabilistic formulation, which makes it suitable for the Bayesian model inversion procedure described in the [Bayesian reconstruction](#svsd-bayes) section. Formally, the multinomial logistic regression model assumes that the target variable is distributed according to a categorical distribution parameterized as follows:

\begin{equation}
p(y) \sim \mathrm{Categorical}(g(X\beta + \alpha))
\end{equation}

where $\beta$ represents a set of parameters that are linearly combined with the feature values ($X$) and an intercept term ($\alpha$), which is passed through the softmax function, $g$:

\begin{equation}
g(X_{i}\beta + \alpha) = \frac{X_{ij}\beta + \alpha}{\sum_{j=1}^{P}e^{X_{ij}\beta + \alpha}}
\end{equation}

where $p(y_{i} | X_{i})$ is a vector with a length equal to the number of classes. Although it is possible to derive discrete predictions by subsequently taking the argmax across the vector with class probabilities, we only use the probabilistic predictions because we use a probabilistic model performance metric (Tjur’s pseudo $R^{2}$; see [Performance metrics](#svsd-perf) section). In the context of our categorical emotion analysis, the fitted multinomial logistic regression model outputs predictions in the format of the probability of each of the six categorical emotions given the set of static or dynamic (or their combination) features of a given facial expression stimulus. The logistic regression model was used with balanced class weights to avoid effects due to imbalance across class frequencies, a regularization parameter (C) of 10, and a liblinear solver.

#### Valence and arousal models {#svsd-valaro}

Both the valence and arousal analysis used a ridge regression model as implemented in the Python package *scikit-learn*. Like the multinomial logistic regression model, linear regression models (including the ridge regression model) have a well-defined probabilistic formulation, which assumes that the target variable ($y_{i}$) is normally distributed:

\begin{equation}
p(y) = \mathcal{N}(X\beta, \sigma_{\epsilon}I)
\end{equation}

where $~X\beta$ represents the mean and $\sigma_{\epsilon}I$ the standard deviation of the normal distribution. Note that we do not estimate an intercept term ($\alpha$) because we standardize our features ($X$) and target variable ($y$) before the analysis. After estimating the parameters $\beta$ and $\sigma_{\epsilon}$ (i.e., $\hat{\beta}$ and $\hat{\sigma}_{\epsilon}$), predictions for a given observation ($X_{i}$) can be made as follows:

\begin{equation}
\hat{y}_{i} = X_{i}\hat{\beta}
\end{equation}

In the context of our valence and arousal model, this means that the valence and arousal values are predicted on the basis of a linear combination of the static or dynamic features. The ridge regression model was fitted with a regularization parameter of 500 and without an intercept.

#### Cross-validation procedure {#svsd-cv}

To facilitate optimization of the analysis and model hyperparameters without the risk of overfitting [@Kriegeskorte2009-yz], the data (i.e., all 752 unique stimuli and associated ratings) were divided into two independent sets: an optimization set with 564 unique stimuli and a test set with 150 unique stimuli (which contains 450 ratings, because each test trial was repeated three times in order to estimate a within-participant noise ceiling). Note that the set of unique test set stimuli is composed of the 56 stimuli originally designated as test set stimuli and an additional 96 stimuli randomly sampled from the accidental repeated trials from the first session; the reason to increase the test set size is to reduce the variance in the estimate of model performance [@Varoquaux2017-fj; @Varoquaux2018-uo]. The distribution of categorical emotion, valence, and arousal ratings is visualized, separately for the optimization and test set, in Supplementary Figure \@ref(fig:fig-svsd-S2), which shows that the two sets are very similar in their rating distributions.

Within the optimization set, we compared different preprocessing techniques (such as standardization before or after PCA fitting) and model hyperparameters (such as the model’s regularization parameter, which was evaluated for $\alpha$ and $\frac{1}{C}$: 0.01, 0.1, 1, 10, 50, 100, 500, 1000). This was done using repeated 10-fold cross-validation within the optimization set, which entails fitting the model on 90% of the data (the “train set”) and evaluating the model performance on the prediction of the left out 10% of the data (the “validation set”). The results of this optimization procedure indicated that a regularization parameter of 10 for the logistic regression model and a regularization parameter of 500 for the regression models led to the highest cross-validated model performance within the optimization set, which were used for each participant-specific model.

This cross-validation procedure within the optimization set was repeated multiple times to optimize the preprocessing and model hyperparameters, which results in a positively biased estimate of cross-validated model performance [@Kriegeskorte2009-yz]. As such, we fitted each model with the optimal hyperparameters (as reported in the [Categorical emotion model](#svsd-cat-emo) and [Valence/arousal models](#svsd-valaro) sections) once more on the entire optimization set and subsequently cross-validated it to the test set. This cross-validation from the optimization to test set was only done once to ensure an unbiased estimate of cross-validated model performance. Notably, in the test set, the trial repetitions were not reduced to a single rating in order to estimate the noise ceiling specifically for the model performance on the test set.

#### Performance metrics {#svsd-perf}

To evaluate the cross-validated model performance of the categorical emotion model, we used Tjur’s pseudo $R^{2}$ score [@Tjur2009-dp]. We chose this particular metric instead of more well-known metrics for classification models (such as accuracy) because it is insensitive to class frequency, allows for class-specific scores, and has the same scale and interpretation as the $R^{2}$ score commonly used for regression models [@Dinga2019-mh]. To evaluate the cross-validated model performance of the valence and arousal models, we used the $R^{2}$ score. Note that the theoretical maximum value of both Tjur’s pseudo $R^{2}$ score and the regular $R^{2}$ score is 1, while the minimum of Tjur’s pseudo $R^{2}$ score is -1 and the minimum for the regular $R^{2}$ score is unbounded; chance level for both metrics is 0.

#### Population prevalence

Although participant-specific cross-validated model performance scores are unbiased estimates of generalizability, above chance level estimates may be due to chance [although this is unlikely given the relatively large size of our test set; @Varoquaux2018-uo]. Additionally, reporting only summary statistics (such as the mean or median) of the set of within-participant model performance estimates ignores the between-participant variance. One possibility to summarize and quantify model performance across the set of participants is to test their mean score against the theoretical chance level using a one-sample *t*-test. This approach, however, is invalid for unsigned metrics, such as the (pseudo) $R^{2}$ scores used in this study, which logically cannot have a population mean below chance level and thus cannot be tested using a one-sample *t*-test [which assumes a symmetric gaussian sampling distribution around the chance level; @Allefeld2016-xp].

An alternative statistical framework is provided by *prevalence inference* [@Allefeld2016-xp; @Rosenblatt2014-az], which estimates the proportion of the population that would show the effect of interest. Here, we use the Bayesian approach to prevalence inference described by @Ince2020-mr. This particular implementation estimates a posterior distribution of the population prevalence proportion (a number between 0 and 1), which is based on the number of statistically significant effects across participants. Statistical significance for a given participant (i.e., the “first-level test statistic”) is computed using a non-parametric permutation test [@Allefeld2016-xp; @Ojala2010-rc], in which the observed cross-validated model performance score is compared to the distribution of model performance scores resulting from the model predictions on permuted test set values. Formally, the *p*-value corresponding to an observed score, $sc^{\mathrm{obs}}$, given a set of *Q* permutation values, $sc^{\mathrm{perm}}$, is computed as follows:

\begin{equation}
p = \frac{\sum_{p=1}^{Q} I(sc_{i}^{\mathrm{perm}} \geq sc^{\mathrm{obs}}) + 1}{Q + 1}
\end{equation}

where $I$ is an indicator function return 1 when the expression in brackets $(sc_{i}^{\mathrm{perm}} \geq sc^{\mathrm{obs}})$ is true and 0 otherwise. In our analyses, we ran 1000 permutations and used a significance level ($\alpha$) of 0.05. Note that although significance of participant-specific effects is computed using a binary decision threshold (as is done in traditional null-hypothesis significance testing), the posterior resulting from the Bayesian prevalence inference analysis is not thresholded.

The issues associated with group-level tests of model performance against chance level do not apply to group-level tests between model performance estimates of different classes of the target variable (e.g., between different emotions), because a symmetric distribution can be assumed for these values.

### Noise ceiling estimation 

If there is measurement noise in the target variable, perfect model performance (i.e., at the theoretical maximum) is impossible. In case of measurement noise, it is more insightful to compare model performance to an estimate of the *noise ceiling*, an upper bound that is adjusted for measurement noise in the target variable [@lage2019methods]. We developed a method to derive noise ceilings for classification models, which is reported and explained in detail in Chapter 7. We use this method to estimate noise ceilings for our categorical emotion models.

For the valence and arousal models, we developed a method to estimate a noise ceiling, assuming that the regular $R^{2}$ score is used, that is very similar to the aforementioned method to estimate noise ceilings for classification models [see for a related method, @Sahani2003-kk; @Schoppe2016-bu]. Recall that the $R^{2}$ score is computed as 1 minus the ratio of the residual sum of squares (RSS) to the total sums of squares (TSS):

\begin{equation}
R^{2} = 1 - \frac{RSS}{TSS} = 1 - \frac{\sum_{i = 1}^{n}(y_{i} - \hat{y}_{i})^{2}}{\sum_{i = 1}^{n}(y_{i} - \bar{y}_{i})^{2}}
\end{equation}

where the RSS term is the sum of the squared deviations of the predicted values ($\hat{y}_{i}$) from the true values ($y_{i}$) of the target variable. The $R^{2}$ noise ceiling can be computed using the previous formula when setting the prediction of each *unique* observation to the mean across its repetitions, which represents the optimal prediction any regression model can make given the variance across repetitions. Formally, for observation $i$ repeated $R$ times, the optimal prediction ($y_{i}^{*}) is computed as follows:

\begin{equation}
y_{i}^{*} = \frac{1}{R}\sum_{r=1}^{R}y_{ir}
\end{equation}

This formulation follows from the fact that regression models must make the exact same predictions for repeated observations and the prediction that minimizes the residual sum of squares for any given observation is the mean across its repetitions. Note that the computation of the $R^{2}$ noise ceiling does not depend on the actual model used for prediction, but only on the design matrix ($X$, which determines which observations are repetitions) and the target variable ($y$). It follows that for a target variable without repeated observations, the $R^{2}$ noise ceiling is 1. For more details on the conceptual and mathematical basis of this method, see @snoek-submitted.

### Bayesian reconstructions {#svsd-bayes}

The predictive analyses in the current study predict the the affective property ($y$) given a set of static or dynamic features ($X$), with the aim to approximate the process underlying affective face perception. Another, complementary goal might be to estimate and visualize, or “reconstruct”, the features ($X$) that underlie a particular affective percept ($y$), as is commonly done in reverse correlation studies [@Brinkman2017-hg; @Jack2015-sh; @Jack2017-gt]. Usually, such reverse correlation studies estimate the relationship between stimulus features ($X$) and the target variable ($y$) separately for each feature and (in case of a categorical target variable) different classes of the target variable. Although this strictly univariate approach has yielded valuable insights across various scientific domains including vision [@Neri1999-rj], neuroscience [@Ringach2004-nn], and more recently, social psychology [@Brinkman2017-hg], we believe it can be improved in terms of parsimony and flexibility. First, univariate correlation methods assume that each feature ($X_{j}$) is independent from all other features. This assumption may hold for stimulus sets that are completely randomly generated, but for stimuli that are parameterized by more complex and correlated features (such as facial movements), this assumption may break down. Furthermore, typical reverse correlation methods yield point estimates of the relationship between features and the target variable (usually correlations), which ignores the uncertainty of the resulting feature space visualizations.

To overcome these limitations, we use a multivariate Bayesian version of reverse correlation to reconstruct the typical dynamic and static features underlying categorical emotions and valence and arousal levels. This technique is increasingly popular in systems neuroscience [@Naselaris2011-oh; @Van_Bergen2015-kl; @Wu2006-qs], where it is used to reconstruct stimulus features (such as the stimulus orientation) or complete stimuli (i.e., their pixel values) from neural data. This approach consists of two steps. First, an *encoding* (or *forward*) model is estimated, which predicts the neural data as a (usually linear) function of the stimulus features. Second, using Bayes theorem, the encoding model is “inverted” to generate a *reconstruction* (or *backward*) model that estimates the stimulus features for a given pattern of neural data. Formally, for a given encoding model estimating the probability of the target variable given a set of stimulus features, $p(y | X)$ (i.e., the likelihood), the reconstruction model, $p(X | y)$ (i.e., the posterior) can be obtained as follows:

\begin{equation}
p(X | y) = \frac{p(y | X)p(X)}{p(y)}
\end{equation}

where $p(X)$ represents the prior distribution on the stimulus features and $p(y)$ represents a normalizing constant. Importantly, in this inversion step, the previously estimated parameters of the encoding model (e.g., $\hat{\beta}$, $\hat{\alpha}$, and $\hat{\sigma}_{\epsilon}$ in a typical logistic or linear regression model) are fixed. In the context of the current study, the encoding models are the logistic and linear regression models that predict the target variable (categorical emotion, valence, and arousal) as a linear function of dynamic or static stimulus features. The reconstructions shown in the results section are based on the parameters ($\hat{\beta}$, $\hat{\alpha}$, and $\hat{\sigma}_{\epsilon}$) averaged across all participant-specific encoding models.^[Visualizations of participant-specific reconstructions are available in the `figures/reconstructions` subdirectory of this study’s Github repository (see [Code availability](#svsd-code)).]

In our reconstructions, we estimate the most probable stimulus given a particular value of the target variable, $p(X | y)$. For our categorical emotion reconstructions, we reconstruct the most probable face for each of the six categorical emotions separately; for the valence and arousal models, we reconstruct the most probable face at seven different levels of the target variable: -0.6, -0.4, -0.2, 0.0, +0.2, +0.4, and +0.6. These target values are on the same scale as the original ratings (which ranges from -1 to 1). Importantly, these values represent the ratings before normalization such that a value of 0 represents the midpoint of the scale. We do not reconstruct the faces corresponding to the extremes of the scales (i.e., between -0.6 and -1 and +0.6 and +1), because the models rarely make predictions of this magnitude (see Supplementary Figure \@ref(fig:fig-svsd-S5)) and as consequence such reconstructions tend to yield morphologically unrealistic faces.

To not bias the reconstructions to a particular configuration, we use a uniform prior on the stimulus features, bounded by the minimum and maximum values observed in our PCA features ($X$), which ensures that the reconstructions do not include morphologically implausible configurations:

\begin{equation}
p(X_{j}) = U(\min(X_{j}), \max(X_{j}))
\end{equation}

Because the denominator in Bayes formula is often not possible to derive analytically, we estimate the posterior distribution using Markov Chain Monte Carlo (MCMC) sampling as implemented in the Python package *pymc3* [@Salvatier2016-ko]. We used the package’s default sampler (*NUTS*) with four independent chains, each sampling 10,000 draws (in addition to 1000 tuning draws) from the posterior. In the current study, the posterior distribution for each feature represents the probability of the value of each dynamic or static stimulus feature for a given categorical emotion or valence or arousal value. For our reconstructions, we estimate the most plausible reconstruction from the posterior. Instead of using the model’s maximum a posteriori (*MAP*) values [which often fail to coincide with the region of highest density in high-dimensional posteriors; @Betancourt2017-rj], we use the midpoint between the bounds of the 5% highest posterior density interval (HDI):

\begin{equation}
X_{j}^{*} = \frac{1}{2}(\mathrm{HDI}(X_{j})_{\mathrm{upper}} - \mathrm{HDI}(X_{j})_{\mathrm{lower}})
\end{equation}

The posteriors and chosen reconstruction values for the first ten features ($X_{1}-X_{10}$) are visualized in Supplementary Figure \@ref(fig:fig-svsd-S6) (for the dynamic feature set) and Supplementary Figure \@ref(fig:fig-svsd-S7) (for the static feature set), which shows that our chosen reconstruction values correspond to the posterior’s point of highest density. From this figure, one particular limitation with respect to the inversion of the categorical emotion model becomes clear, i.e., that most posteriors peak at the extremes of the corresponding feature values. The reason for this is that the softmax function maps values (i.e., $X$) from an arbitrary scale to the 0-1 domain (i.e., $p(y | X)$) and cannot be inverted to yield the exact feature values (i.e., $X^{*}$) given a particular probability; in fact, for a given probability, the “inverted softmax” can yield infinitely many different possible feature value combinations ($X^{*}$), but because of the target ($y$) follows a multinomial distribution (with $p = \mathrm{softmax}(X\beta+\alpha)$), the probability of each feature value increases proportionally to its magnitude. However, this issue does not affect the relative differences in magnitude between feature values (e.g., $X_{j}^{*}$ is twice as large as $X_{j+1}^{*}$) and thus does not affect the quality of the reconstructions.

In the current study, the values of the posterior represent the PCA-transformed variables. To transfer these values into vertex-space, we need to invert the standardization step and the PCA-transform as well, which involves the following linear transformation from PCA-space ($X_{*}$) to vertex-space ($V^{*}$):

\begin{equation}
V^{*} = (X^{*}\hat{\sigma})\hat{W} + \hat{\mu}
\end{equation}

where $V^{*}$ represents the most probable static face or most probably dynamic movement in vertex-space (i.e., a 31049 × 3 array) given a particular emotion or valence/arousal value (see Figure \@ref(fig:fig-svsd-4) for a visualization of the reconstruction procedure). Notably, unlike traditional univariate reverse correlation reconstructions, the reconstruction values from the Bayesian approach discussed here are in the original units of the feature space (here: vertex positions or deviations) and are thus directly interpretable and can be visualized in a straightforward manner.

To interpret and gain further insight into the (relations between the) reconstructions, we visualize the dynamic movements on top of the average static face and for both the static and dynamic information reconstructions. We color-code the deviations separately for the X, Y, and Z dimension. In these visualizations, blue colors represent leftward (X), downward (Y), or backward (Z) deviations/movements and red colors represent rightward (X), upward (Y), or forward (Z) deviations/movements. The software package *plotly* ([https://plotly.com/python](https://plotly.com/python)) was used to create the visualizations. Moreover, to gain insight into how different reconstructions relate to each other (e.g., across different emotions or across static and dynamic reconstructions for a given affective attribute), we compute the Pearson correlation between any two reconstructions (flattened across spatial coordinates into a vector of length 93147).

```{r fig-svsd-4, fig.cap='(ref:caption-fig-svsd-4)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_4.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-4) Visualization of the encoding (“forward”) model (top) and the reconstruction (“backward”) model (bottom). Note that during the encoding step, a set of $N$ observations is used to estimate the parameters of the encoding model, while in the reconstruction step only a single observation is reconstructed (although reconstruction can be done for multiple observations at once, if desired).

### Code availability {#svsd-code}

All code used for the analyses reported in the current study are available on Github: [https://github.com/lukassnoek/static-vs-dynamic](https://github.com/lukassnoek/static-vs-dynamic). Additionally, code to estimate noise ceilings for both classification and regression models has been released as a Python package, available on Github: [https://github.com/lukassnoek/noiseceiling](https://github.com/lukassnoek/noiseceiling). The code used for this project makes frequent use of the Python packages *numpy* [@Harris2020-en], *pandas* [@McKinney2011-kl], *scikit-learn* [@Pedregosa2011-bp], *matplotlib* [@Hunter2007-at], and *seaborn* [@waskom2021seaborn]. The prevalence inference estimates were computed using the *bayesprev* Python module from @Ince2020-mr.

## Results {#svsd-results}

In the next two subsections, we report the model performance of the encoding model and the reconstructions from the reconstruction model.

### Encoding model performance

Figure \@ref(fig:fig-svsd-5) summarizes the average explained variance for each affective property (and, in the context of the categorical emotion analysis, different emotions), separately for the static, dynamic, and combined feature sets. For all affective properties, the model based on the combined feature set explains approximately as much as the sum of the static and dynamic model performance (see Supplementary Figure \@ref(fig:fig-svsd-S4), indicating that static and dynamic features explain unique and additive variance. Moreover, the general pattern of results is very similar to (and thus replicates) the results obtained on the optimization set (see Supplementary Figure \@ref(fig:fig-svsd-S3). The posteriors of the population prevalence estimates associated with the model performance scores  are visualized in Figure \@ref(fig:fig-svsd-6).

```{r fig-svsd-5, fig.cap='(ref:caption-fig-svsd-5)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_5.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-5) Cross-validated model performance, shown separately for each target feature (top: categorical emotion, bottom left: valence, bottom right: arousal) and feature set (static, dynamic, and combined). The bar height represents the mean model performance across participants and the error bars represent ±1 SD. The average within-participant noise ceiling of the *combined* feature set is plotted for reference as a dashed black line, which is surrounded by a grey area indicating ±1 SD.

#### Categorical emotion model

In the categorical emotion analysis, on average about 5.8% of the variance can be explained by static features (versus 29.1% by dynamic features and 33.1% by the combined feature set). The highest percentages explained variance per emotion were observed for anger (12.1%) and happiness (9.4%), which were significantly higher than the percentages for the other emotions (evaluated using a paired samples *t*-test, all *p* < 0.05). The magnitude of the average cross-validated pseudo R2 scores is roughly proportional to the expected proportion of the population to show an effect (i.e., a cross-validated pseudo $R^{2}$ significantly larger than 0), as is shown in Figure \@ref(fig:fig-svsd-6). The population prevalence estimates across emotions range from 23% (for surprise) to 100% (for anger). For the dynamic and combined model, an effect is expected in the entire population (i.e., a population prevalence of 100%).

#### Valence/arousal models

Relative to the averaged predictive power of the static features for the categorical emotion model, the predictive power of static features is higher in the valence model, in which it explains on average 11.4% of the variance (versus 18.3% using dynamic features and 30.0% using the combined feature set). This is substantially lower in the arousal model, in which negative $R^{2}$ values are observed when using static features (versus 23.9% using dynamic features and 22.9% using the combined feature set). The computed population prevalence estimates confirm that a statistically significant effect is expected in virtually the entire population for all valence and arousal models, with the exception of the static arousal model, in which an effect is only expected in 30% of the population).

```{r fig-svsd-6, fig.cap='(ref:caption-fig-svsd-6)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_6.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-6) The posterior distributions for the population prevalence proportion of the results from the categorical emotion (top), valence (middle), and arousal models (bottom). The posteriors for the different emotions with respect to the dynamic and combined categorical emotion model performances completely overlap, so only a single posterior is shown. The filled area represents the probability density higher than the lower bound of the 96% highest density interval [@McElreath2020-pz].

### Reconstruction model visualizations

Using the estimated coefficients from the encoding models, we estimated the most likely dynamic and static stimulus features for a given categorical emotion or valence/arousal level. In Figure \@ref(fig:fig-svsd-7), we visualize these reconstructions.

#### Categorical emotion reconstructions

Based on a qualitative visual assessment, the reconstructions from the categorical emotion model based on dynamic information conform to the stereotypical facial expressions associated with categorical emotions [cf. @Ekman1969-pu; @Jack2016-jq]. As can be seen in Figure \@ref(fig:fig-svsd-8), anger is associated with a jaw drop, narrowing of the face, raised cheeks, and a lowered brow; disgust is associated with a raised upper lip, raised cheeks, and tightened eyelids; fear is associated with a strong jaw drop and brow raise; happiness is associated with a raised cheeks (which also widens the face), tightened eyelids, and slightly raised eyebrows; sadness is associated with pressed lips, widening of the cheeks, and closed eyes; and surprise is associated with a jaw drop, narrowing of the face and raised eyebrows. Although no stereotypical face structures have been proposed in the literature, the majority of the static reconstructions still show clear and interpretable facial features for most categorical emotions. Anger is associated with a relatively wide face, high forehead, and a protruding nose and chin; disgust is associated with an asymmetric face (in the left-right direction) and protruding mouth/lips; fear is associated with a relatively narrow face and turned-up nose, and slightly protruding mouth; happiness is associated with turned-up mouth corners and high cheekbones; and sadness is associated with a relatively long face and protruding eyebrows. We retrain from interpreting the reconstruction of the static surprise face because static features were not found to be predictive for surprise (see Figure \@ref(fig:fig-svsd-5)).

In addition to qualitatively assessing the reconstructions separately, we also compared them quantitatively to each other. In Figure \@ref(fig:fig-svsd-8) (top left), we visualize the correlation matrix of the dynamic categorical emotion reconstructions. This correlation matrix shows relatively high correlations between reconstructions of “anger” and “disgust” ($r = .62$) as well as “surprise” and “fear” ($r = .56$), which may underlie the relative frequent confusion between those pairs of emotions (see Supplementary Figure \@ref(fig:fig-svsd-S5, top left). The correlation matrix of the static categorical emotion reconstructions (Figure 9, middle left), in contrast, shows no clear similarities across reconstructions. Finally, we computed the correlation (for each emotion pair) between the static and dynamic reconstructions, which indicates the extent to which static and dynamic share the same “face topology”. If dynamic and static reconstructions are in fact similar in terms of face topology, we would expect high values on the diagonal of the matrix and low values elsewhere. This actual correlation matrix (Figure \@ref(fig:fig-svsd-8), bottom left), however, does not show this pattern; all correlations between the dynamic and static reconstructions are around 0.

```{r fig-svsd-7, fig.cap='(ref:caption-fig-svsd-7)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_7.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-7) The results from the Bayesian reconstruction approach for each emotion from the categorical emotion model and for seven levels, -0.6, -0.4, -0.2, 0, +0.2, +0.4, and +0.6, of the valence and arousal model, shown separately for the static and dynamic feature sets. Color saturation is proportional to the movement or deviation in vertex space (in *SD*).

#### Valence/arousal reconstructions

The reconstructions from the dynamic valence model also show clear facial movements for both highly negative and highly positive valence values. A face that is experienced as highly negative is associated with an “inward” jaw drop, narrowing of the face, and raised cheeks, while a face that is experienced as highly positive is associated with a widening of the face through the cheeks and a raised brow. The reconstructions from the model based on static information shows that faces experienced as highly negative have a wide (“strong”) jawline, a relatively long face, wide forehead, and a protruding brow and mouth, while faces experienced as highly positive have a relatively narrow and short forehead, high cheekbones and mouth corners, and a relatively “flat” face (i.e., positive deviations in the *Z* dimension at the edges of the face).

The reconstructions from the arousal model based on dynamic information show that faces eliciting low arousal are associated with a widening of the face, tightening of the lips, and tightened/closed eyes, while faces eliciting high arousal are associated with a strong jaw drop, widening of the eyes, and raised cheeks. The reconstructions from the arousal model based on static information, on the other hand, show less interpretable facial features, which is expected based on the low (below-chance) model performance of the static arousal model.

As can be seen in figure \@ref(fig:fig-svsd-7), the reconstructed faces are highly similar across different magnitudes of valence and arousal, respectively. A strongly positive reconstruction, for example, looks almost the same as a weakly positive one. This suggests that the mental representations of these variables seems to be “binary”, even though the variables were measured on a continuous (bipolar) scale and the distribution of the ratings is far from binary (see Supplementary Figure \@ref(fig:fig-svsd-S2)). Moreover, the “switching point” (corresponding to a neutral mental representation) is in some cases offset compared to the midpoint of the rating scale (corresponding to a neutral rating), suggesting a discrepancy between the neutral point of the rating scale and people’s mental representation of a “neutral” face. Note that this phenomenon is less clearly present in the static arousal reconstructions, but given that the static information was not predictive of arousal ratings, we refrain from interpreting these results.

Finally, given the uniformly low correlation values in the cross-correlation matrix between dynamic and static reconstructions of both valence and arousal (Figure \@ref(fig:fig-svsd-8), bottom center and bottom right), it can be concluded that there does not seem to be any correspondence in face topology between static and dynamic representations of valence and arousal.

```{r fig-svsd-8, fig.cap='(ref:caption-fig-svsd-8)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_8.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-8) Correlations between reconstructions in vertex space for the categorical emotion (left), valence (middle), and arousal (right) models. The top row shows the correlations across all dynamic reconstructions. The middle row shows the correlations across all static reconstructions. The bottom row shows the correlations across each combination of a single dynamic and static reconstruction (e.g., in the bottom left correlation matrix, the top right cell represents the correlation between the static anger and the dynamic surprise reconstruction).

#### Correlations between affective properties

Finally, we evaluated the cross-correlations between the reconstructions of different affective properties. In other words, we evaluate correlations between the reconstructions for different levels of experienced valence and arousal in the observer with the reconstructions for perceived emotions in the face of the expressor (e.g., anger). The correlation matrix of the dynamic reconstruction correlations are visualized in Supplementary Figure \@ref(fig:fig-svsd-S8) and the correlation matrix of the static reconstruction correlations are visualized in Supplementary Figure \@ref(fig:fig-svsd-S9). In these correlation matrices, a clear pattern emerged. Specifically, positive valence reconstructions correlated positively with happiness and negative valence reconstructions correlated positively with negative categorical emotion reconstructions (anger, disgust, and fear). Also, low arousal reconstructions correlated positively with happiness and sadness and high arousal reconstructions correlated positively with negative categorical emotion reconstructions (anger, disgust, and fear). Notably, this pattern is both present in the dynamic reconstructions (Supplementary Figure \@ref(fig:fig-svsd-S8)) and static reconstruction (Supplementary Figure \@ref(fig:fig-svsd-S9)). These findings may explain the previously discussed observations that valence and arousal reconstructions seem to be binary instead of graded. Participants may experience a face as categorically positive when a face displays happiness and as categorically negative when a face displays anger, disgust, or fear. Similarly, participants may experience a face as categorically highly arousing when a face displays anger, disgust, or fear and as categorically low arousing when a face displays happiness or sadness.

## Discussion {#svsd-discussion}

In the current study, we sought to quantify and disentangle the importance of dynamic features (facial movement) and static features (facial morphology) on affective face perception. Specifically, using machine learning models based on either dynamic features, static features, or a combination thereof, we aimed to predict categorical emotion, valence, and arousal ratings from a psychophysics experiment with dynamic facial expression stimuli that randomly varied in both their facial movements and facial morphology. To gain further insight into the facial features that are important for prediction of the investigated affective properties, we reconstructed the mental representation of faces associated with the different categorical emotions and different levels of experienced valence and arousal using a multivariate reverse correlation method. In what follows, we discuss the current study’s main findings and how they may inform and complement studies on affective face perception.

### Facial morphology independently contributes to affective face perception

Our models were able to predict human ratings of perceived categorical emotions and elicited valence substantially above chance level using both dynamic and static features. This demonstrates that not only dynamic but also static features of the face determine in what way people perceive and are affected by facial expressions. Moreover, the sum of the dynamic and static model performance scores approximately equals the combined model performance score for all affective properties, which further indicates that the static and dynamic feature sets carry *independent* information that is integrated during perception.

The findings of this study have both fundamental and practical implications for (research on) affective face perception. In general, this study shows that the way we perceive and are affected by faces goes beyond what those faces explicitly communicate. Because static features are by definition unrelated to the expressor’s affective state or intentions, one way to frame our findings is that people are biased by features related to facial morphology, perhaps mediated by stereotypes associated with certain demographic groups [e.g., males are thought to display anger more frequently than women; @Brooks2018-ao]. In contrast to this interpretation, this “bias” could in fact reflect a *true* association between morphological features and the frequency of particular affective expressions (e.g., categorical emotions) or predispositions [e.g., dominance; @Zebrowitz2017-qe].  For example, research has shown that facial width-to-height ratio (FWHR) is associated with aggressive behavior [@Lefevre2014-vo], which may mediate the relationship between FHWH and anger perception [see Figure \@ref(fig:fig-svsd-7); @Deska2018-hx]. As this debate about the accuracy of the association between facial morphology and affective predispositions is far from solved [see e.g., @Jaeger2020-sr; @Jaeger2020-bn], we leave speculation about this topic to future research that more directly investigates this issue.

On a more practical level, because both static and dynamic features contribute independently to the perception of categorical emotion and experience of valence, researchers studying categorical emotion or valence should use dynamic stimuli of facial expressions instead of static stimuli (i.e., images), which is most commonly done [@Krumhuber2013-qi]. By using dynamic stimuli, possible effects of static features can be controlled or explicitly adjusted for. This “decorrelation” of static and dynamic information is important if one wants to say something about the (unconfounded) effect of static or dynamic information in affective face perception. Given our results, dynamic stimuli are also likely to be more effective for eliciting and modelling arousal, which is in line with previous studies that show that arousal is experienced more intensely in response to dynamic than static stimuli [@Sato2007-ah].

### The influence of facial morphology does not result from visual similarity to facial movements

Contrary to what is often reported in previous studies [@Hess2009-xo; @Said2009-tf; @Zebrowitz2017-qe], we do not find that static and dynamic features visually resemble each other, as is evident from the low correlations between static and dynamic reconstructions for each categorical emotion and valence and arousal levels. Instead, the static reconstructions show qualitatively different facial features for each emotion and valence/arousal level relative to the dynamic reconstructions. For example, the static anger reconstruction shows a relatively strong jawline [cf. @Deska2018-hx], high forehead, and protruding nose and chin, while the dynamic anger reconstruction shows a narrowing of the face, raised cheeks, and lowered brow. Many of the facial features associated with static reconstructions are similar to facial features associated with social judgments. For example, the strong jawline we observe in the static anger reconstruction has been associated with the perception of dominance [@Mileva2014-ld; @Windhager2011-ik] and the pronounced cheekbones we observe in the static happiness reconstruction has been associated with the perception of trustworthiness [@Oosterhof2009-mf; @Todorov2008-eb]. This suggests that the effect of static features on categorical emotion perception may be mediated by social attributions such as dominance and trustworthiness [@Adams2012-dl; @Craig2017-db; @Gill2014-hx; @Hess2009-br; @Montepare2003-hy]. However, the difference between our findings and previously reported associations between social attributions and categorical emotion perception [with the exception of @Gill2014-hx] is that we show that the static features we found to be important for categorical emotion perception do not resemble dynamic features usually associated with particular emotion expressions.

### Categorical representations of experienced valence and arousal correlate with representations of perceived emotions

Furthermore, the qualitative and quantitative analyses of the reconstructions at different valence and arousal levels shows that even though valence and arousal were measured at a continuous scale, participants seem to represent valence and arousal in a categorical fashion, i.e., as either positive or negative valence and as either low or high arousal. An intriguing potential explanation for this finding is that the valence and arousal experiences of participants may be directly tied to the categorical emotions perceived in the face. Indeed, for both dynamic and static reconstructions, the correlations between the positive valence reconstructions and the happiness reconstruction and the negative valence reconstructions and the anger, disgust, and fear reconstructions are substantial (see Supplementary Figure \@ref(fig:fig-svsd-S8)-\@ref(fig:fig-svsd-S9). Likewise, the correlations between low arousal reconstructions and the happiness and sadness reconstructions and high arousal reconstructions and the anger, disgust, and fear reconstructions are substantial. Thus, an individual’s affective response to a face may stem from the face’s similarity to the observer’s representation of categorical emotions.

### Predictive models quantify what is (not yet) known

The current study used a predictive modelling approach (as opposed to null-hypothesis significance testing used in most previous research) to precisely quantify and compare the importance of static and dynamic information in affective face perception. In addition, using the concept of a noise ceiling, we showed that although a substantial proportion of the variance in ratings can be explained, the difference between the average model performance and the noise ceiling indicates that there is room for improvement. As our models were all linear and additive, one possibility for improvement is the use of non-linear models, which may capture possible many-to-one mappings between facial movements and affective properties [@snoek-submitted]. The recent successes of computer vision algorithms (which are usually highly non-linear) in emotion classification indicate that this avenue may be promising [@Ko2018-rv]. Another possibility for improving predictive model performance is to enrich the static and dynamic feature spaces. For example, one could consider static features beyond facial morphology, such as facial texture [@Punitha2013-jy; @Xie2009-fp] and color [@Benitez-Quiroz2018-vr; @Thorstenson2018-io]. Investigating alternative algorithms and additional or different feature spaces, which can be evaluated by their predictive accuracy, may generate a more complete and accurate model of affective face perception.

#### Limitations and further directions

Although we believe the current study yields important insights into the role of static and dynamic information in affective face perception, it suffers from several limitations that affect its generalizability, which in turn provides directions for future research. First, we specifically investigated categorical emotion as an affective state of the expressor and valence/arousal as an affective experience of the observer, but this covers only a part of the possibilities. Future studies could additionally investigate how static and dynamic information are related to categorical emotions as an affective state of the observer and valence/arousal as an affective state of the expressor. Second, although we investigated multiple affective properties of the face, they do not capture affective face perception in its full complexity. For example, the six basic categorical emotions we investigated are a subset of a larger range of known categorical affective states [@Cowen2017-vz; @Cowen2021-ld]. Future research could use the approach from the current study to investigate whether the largely independent contribution of static and dynamic information holds for affective states beyond those investigated in the current study. Second, although our psychophysics approach samples the space of dynamic and static information more extensively than most studies, the stimulus set we used remains limited. Although random sampling of facial movements ensures that analyses and subsequent results are relatively unbiased by existing theoretical considerations [@Jack2017-qp], they may yield facial expressions that are unlikely to be encountered in daily life. As a consequence, these facial expressions may be rated relatively inconsistently and subsequently bias model performance downwards. In addition, our stimulus set was generated to optimize for variance in facial movements. As such, while our stimulus set covers a large part of the space of possible facial movements, it is unclear to what degree the fifty different faces in our stimulus set cover the range of variation in facial morphology. Specifically, to improve the variance in static features, future studies could benefit from including faces from different ethnicities and a wider age range, which may in turn improve generalizability of the results. 

## Conclusion {#svsd-conclusion}

In this study, we show that both dynamic information (i.e., facial movements) and static information is integrated during affective face perception, and that these sources of information are largely independent. This finding demonstrates that people extract more from the face than is intentionally or unintentionally communicated. Importantly, these results in general raise concerns about using static images (rather than videos) in facial expression research or automated facial expression recognition systems, because (apparent) dynamic and static information are fundamentally confounded in images. We hope that our data-driven, predictive approach paves the way for future research that embraces the face as a communicator and elicitor of affective states in all its complexity.

## Acknowledgements

We thank Maite van der Miesen and Sjoerd Evelo for their help with data acquisition and
Steven Miletić for helpful discussions regarding the Bayesian multivariate reverse correlation analyses.

<!--chapter:end:07-static-vs-dynamic.Rmd-->

# Summary and general discussion
My view on going forward.

## Explore!
Theories are like toothbrushes, no one likes to use someone else's.

## Think *big*
Big, complex datasets to train big, complex models.

## Rethink psychology education
Embrace and teach interdisciplinary.

<!--chapter:end:08-summary-discussion.Rmd-->

---
output:
  pdf_document: default
  html_document: default
  
nocite: | 
  @salimi2014automatic, @barrett2009variety, @winkielman2015embodiment
---

# (APPENDIX) Appendix {-}
\cleardoublepage
\phantomsection
\addcontentsline{toc}{part}{Appendices}
\appendixpage*
\setlength\beforechapskip{-\baselineskip}

```{r setup-shared-states-supplement, include=FALSE}
knitr::opts_chunk$set(results = 'hide', echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(kableExtra)
```

`r if (knitr::is_html_output()) '
# Supplement to Chapter 2 {#shared-states-supplement}
' else '
# Supplement to Chapter \\@ref(shared-states) {#shared-states-supplement}
'`

```{r tab-shared-states-S1, results='asis'}
data = read_csv('_bookdown_files/shared-states-files/table_S1_data.csv')
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T, caption = 'Stimuli used for SF-task') %>%
    kable_styling(full_width = T, 
                  #latex_options = c("repeat_header"),
                  font_size = 10) %>%
    column_spec(column = 1, width = "5em") %>%
    #collapse_rows(columns = 1, valign = "top") %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T,
             general = 'The stimulus materials presented in Table S1 were selected from a pilot study. In this pilot study we asked an independent sample of twenty-four subjects to describe how they would express an emotion in their behavior, body posture or facial expression (action information), what specific sensations they would feel inside their body when they would experience an emotion (interoceptive information), and for what reason or in what situation they would experience an emotion (situational information). These three questions were asked in random order for twenty-eight different negative emotional states, including anger, fear, disgust, sadness, contempt, worry, disappointment, regret and shame. The descriptions generated by these subjects were used as qualitative input in order to create our stimulus set of twenty short sentences that described emotional actions, sensations or situations. With this procedure, we ensured that our stimulus set held sentences that were validated and ecologically appropriate for our sample.')
```

## Instructions

**Full instruction for the other-focused emotion understanding task, translated from Dutch; task presented first.**

"In this study we are interested in how the brain responds when people understand the emotions of others in different ways. In the scanner you will see images that display emotional situations, sometimes with multiple people. In every image one person will be marked with a red square. While viewing the image we ask you to focus on the emotion of that person in three different ways. 

With some images we ask you to focus on HOW this person expresses his or her emotion. Here we ask you to identify expressions in the face or body that are informative about the emotional state that the person is experiencing. 
 
With other images we ask you to focus on WHAT this person may feel in his or her body. Here we ask you to identify sensations, such as a change in heart rate, breathing or other internal feeling, that the person might feel in this situation. 

With other images we ask you to focus on WHY this person experiences an emotion. Here we ask you to identify a specific reason or cause that explains why the person feels what he or she feels. 

Every image will be presented for six seconds. During this period we ask you to silently focus on HOW this person expresses emotion, WHAT this person feels in his/her body, and WHY this person feels an emotion. 

Before you will enter the scanner we will practice. I will show you three images and will ask you to perform each of the three instructions out loud. 

It is important to note that there are no correct or incorrect answers, it is about how you interpret the image. For the success of the study it is very important that you apply the HOW, WHAT or WHY instruction for each image. Please do not skip any images and try to apply each instruction with the same motivation. It is also important to treat every image separately, although it is possible that you have similar interpretations for different images. 
The three instructions are combined with the images in blocks. In every block you will see five images with the same instruction. Each block will start with a cue that tells you what to focus on in that block. 

Each image is combined with all three instructions, so you will see the same image multiple times. In between images you will sometimes see a black screen for a longer period of time. 

Do you have any questions?"

**Full instruction for the self-focused emotion imagery task, translated from Dutch. Task presented second.**

"In this study we are interested in how the brain responds when people imagine different aspects of emotion. In the scanner you will see sentences that describe aspects of emotional experience. We ask you to try to imagine the content of each sentence as rich and detailed as possible. 

Some sentences describe actions and expressions. We ask you to imagine that you are performing this action or expression. Other sentences describe sensations or feelings that you can have *inside* your body. We ask you to imagine that you are experiencing this sensation or feeling. Other sentences describe emotional situations. We ask you to imagine that you are experiencing this specific situation. 

We ask you to always imagine that YOU have the experience. Thus, it is about imagining an action or expression of your body, a sensation inside your body, or a situation that you are part of. 

I will give some examples now.

For each sentence you have six seconds to imagine the content. All sentences will be presented twice. In between sentences you will sometimes see a black screen for a longer period of time. For this experiment to succeed it is important that you imagine each sentence with the same motivation, even if you have seen the sentence before. Please do not skip sentences. 

Do you have any questions?"

```{r fig-shared-states-S1, fig.cap='(ref:caption-fig-shared-states-S1)', results='show'}
knitr::include_graphics("_bookdown_files/shared-states-files/figures/figure_S1.png", auto_pdf = TRUE)
```

(ref:caption-fig-shared-states-S1) Mean percentage of trials successfully executed for the SF-task (left panel) and OF-task (right panel). Error bars indicate 95% confidence intervals. A one-way ANOVA of the success-rates of the SF-task (left-panel) indicated no significant overall differences, *F*(2, 17) = 1.03, p = 0.38. In the OF-task (right panel) however, a one-way ANOVA indicated that success-rates differed significantly between classes, *F*(2, 17) = 17.74, *p* < 0.001. Follow-up pairwise comparisons (Bonferroni corrected, two tailed) revealed that interoception-trials (*M* = 74.00, *SE* = 2.10) were significantly less successful (*p* < 0.001) than both action-trials (*M* = 85.50, *SE* = 1.85) and situation trials (*M* = 90.00, *SE* = 1.92).

\newpage
\pagestyle{empty}
\blandscape

```{r fig-shared-states-S2, fig.cap='(ref:caption-fig-shared-states-S2)', results='show', out.height = '90%', out.width = '90%'}
knitr::include_graphics("_bookdown_files/shared-states-files/figures/figure_S2.png", auto_pdf = TRUE)
```

(ref:caption-fig-shared-states-S2) Results of the parameter-optimization procedure. Reported scores reflect the classification scores averaged over subjects and classes (i.e. the diagonal of the confusion matrix). All optimization analyses were iterated 5000 times. **A**) Classification results for different smoothing kernels (0, 2, 5, and 10 mm) and z-value threshold for differentiation scores during feature selection (see MVPA pipeline section in the main text for a description of the particular feature selection method we employed). Numbers reflect the average number of voxels selected across iterations. **B**) Classification results of using a low-pass filter (2 seconds) or not. **C**) Classification results for different numbers of test-trials per class (1 to 5). **D**) Classification results when preprocessing the data with Independent Component Analysis (ICA) or not.

\elandscape
\newpage
\pagestyle{empty}

```{r tab-shared-states-S2, results='asis'}
data = read_csv('_bookdown_files/shared-states-files/table_S2_data.csv')
kbl(data, booktabs = T, longtable = T, caption = 'Parameters assessed in the optimization set') %>%
    kable_styling(full_width = T, font_size = 10) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T,
  general = 'The first set of parameters we evaluated in the optimization-set were different smoothing factors and feature selection thresholds (see MVPA pipeline section in the main text). On average, across the self- and cross-analysis, a 5 mm smoothing kernel yielded the best results in combination with a feature selection threshold of 2.25, which we rounded up to 2.3 as this number represents a normalized (z-transformed) score, which corresponds to the top 1% scores within a normal distribution. Next, the difference between using a low-pass (of 2 seconds, i.e. 1 TR) versus none was assessed, establishing no low-pass filter as the optimal choice. Next, different numbers of test-trials (1 to 5) per class per iteration were assessed. Four trials yielded the best results. Lastly, the effect of “cleaning” the data with an independent component analysis was examined (FSL: MELODIC and FIX; Salimi-Khorshidi et al., 2014). Not performing ICA yielded the best results. These parameters – 5 mm smoothing kernel, 2.3 feature selection thresholded, no low-pass filter, and four test-trials per iteration – were subsequently used in the analysis of the validation set.')
```

```{r fig-shared-states-S3, fig.cap='(ref:caption-fig-shared-states-S3)', results='show'}
knitr::include_graphics("_bookdown_files/shared-states-files/figures/figure_S3.png", auto_pdf = TRUE)
```

(ref:caption-fig-shared-states-S3) Confusion matrices displaying precision-values yielded by the classification analysis of the optimization dataset with the final set of parameters. Because no permutation statistics were calculated for the optimization set, significance was calculated using a one-sample independent *t*-test against chance-level classification (i.e. 0.333) for each cell in the diagonal of the confusion matrices. Here, all t-statistics use a degrees of freedom of 12 (i.e. 13 subjects - 1) and are evaluated against a significance level of 0.05, Bonferroni-corrected. For the diagonal of the self-analysis confusion matrix, all values were significantly above chance-level, all *p* < 0.0001. For the diagonal of the cross-analysis confusion matrix, both the action (43% correct) and situation (44% correct) classes scored significantly above chance, *p* = 0.014 and *p* = 0.0007 respectively. Interoception was classified at chance level, *p* = 0.99, which stands in contrast with the results in the validation-set.

```{r fig-shared-states-S4, fig.cap='(ref:caption-fig-shared-states-S4)', results='show'}
knitr::include_graphics("_bookdown_files/shared-states-files/figures/figure_S4.png", auto_pdf = TRUE)
```

(ref:caption-fig-shared-states-S4) Schematic overview of the bagging procedure. Class probabilities across different bagging iterations are summed and the class with the maximum probability determines each trial’s final predicted class, which are subsequently summarized in a confusion matrix on which final recall/precision scores are calculated.

```{r fig-shared-states-S5, fig.cap='(ref:caption-fig-shared-states-S5)', results='show'}
knitr::include_graphics("_bookdown_files/shared-states-files/figures/figure_S5.png", auto_pdf = TRUE)
```

(ref:caption-fig-shared-states-S5) A comparison between precision and recall confusion matrices of the self- and cross-analysis of the validation dataset. Precision refers to the amount of true positive predictions of a given class relative to all predictions for that class. Recall refers to the amount of true positive predictions of a given class relative to the total number of samples in that class. In the self-analysis, all classes were decoded significantly above chance for both precision and recall (all *p* < 0.001). In the cross-analysis, all classes were decoded significantly above chance for precision (all *p* < 0.001); for recall both action and situation were decoded significantly above chance (*p* = 0.0013 and *p* < 0.001, respectively), while interoception was decoded below chance. All *p*-values were calculated using a permutation test with 1300 permutations (as described in the Methods section in the main text). When comparing precision and recall scores for both analyses, precision and recall showed very little differences in the self-analysis, while the cross-analysis shows a clear difference between metrics, especially for interoception and situation. For the interoception class, the relatively high precision score (44%) compared to its recall score (14%) suggests that trials are very infrequently classified as interoception, but when they are, it is (relatively) often correct. For the situation class, the relatively high recall score (72 %) compared to its precision score (44%) suggests that situation is strongly over-classified, which is especially clear in the lower-right confusion matrix, which indicates that 59% of the interoception-trials are misclassified as situation-trials.

```{r fig-shared-states-S6, fig.cap='(ref:caption-fig-shared-states-S6)', results='show'}
knitr::include_graphics("_bookdown_files/shared-states-files/figures/figure_S6.png", auto_pdf = TRUE)
```

(ref:caption-fig-shared-states-S6) Relation between self- and cross-analysis scores across subjects and their respective distributions. Note that the scores here represent the average of the class-specific precision scores. **A**) There is no significant correlation between precision-scores on the self-analysis and the corresponding scores on the cross-analysis, *r* = -0.04, *p* = .86, implying that classification scores in the self-analysis is not predictive of scores in the cross-analysis. **B**) The distribution of precision-scores in the self-analysis, appearing to be normally distributed. **C**) The distribution of precision-scores in the cross-analysis, on the other hand, appears to be bimodal, with one group of subjects having scores around chance level (0.333) while another group of subjects clearly scores above chance level (see individual scores and follow-up analyses in (ref:fig-shared-states-S4).

```{r fig-shared-states-S7, fig.cap='(ref:caption-fig-shared-states-S7)', results='show'}
knitr::include_graphics("_bookdown_files/shared-states-files/figures/figure_S7.png", auto_pdf = TRUE)
```

(ref:caption-fig-shared-states-S7) Confusion matrices with precision (left matrix) and recall (right matrix) estimates of the other-to-self decoding analysis. The MVPA-pipeline used was exactly the same as for the (self-to-other) cross-analysis in the main text. *P*-values corresponding to the classification scores were calculated using a permutation analysis with 1000 permutations of the other-to-self analysis with randomly shuffled class-labels. Similar to the self-to-other analysis, the precision-scores for all classes in the other-to-self analysis were significant, *p*(action) < 0.001, *p*(interoception) = 0.008, *p*(situation) < 0.001. For recall, classification scores for action and interoception were significant (both *p* < 0.001), but not significant for situation (*p* = 0.062). The discrepancy between the self-to-other and other-to-self decoding analyses can be explained by two factors. First, the other-to-self classifier was trained on fewer samples (i.e. 90 trials) than the self-to-other classifier (which was trained on 120 trials), which may cause a substantial drop in power. Second, the preprocessing pipeline and MVPA hyperparameters were optimized based on the self-analysis and self-to-other cross-analysis. Given the vast differences between the nature of the self- and other-data, these optimal preprocessing and MVPA hyperparameters for the original analyses may not cross-validate well to the other-to-self decoding analysis.

```{r fig-shared-states-S8, fig.cap='(ref:caption-fig-shared-states-S8)', results='show'}
knitr::include_graphics("_bookdown_files/shared-states-files/figures/figure_S8.png", auto_pdf = TRUE)
```

(ref:caption-fig-shared-states-S8) Results of MVPA analyses using condition-average voxel patterns across subjects instead of single-trial patterns within subjects. Here, patterns are estimated in a GLM in which each condition, as opposed to each trial, is modeled with a single regressor, from which whole-brain t-value patterns were extracted. In this condition-average multi-voxel pattern analysis, condition-average patterns across subjects were used as samples. The condition-average patterns were extracted from the univariate first-level contrasts. In total, this yielded 120 samples for the self-data (3 conditions x 2 runs x 20 participants) and 60 samples for the other-data (3 conditions * 20 participants). For these analyses, the same hyperparameters were used as the original analyses reported in the main text, except with regard to the cross-validation and bagging procedure. Here, we used (stratified) 10-fold cross-validation without bagging. The upper panels show precision scores (per class) for the self- and (self-to-other) cross-analysis; the lower panels show results from the same analyses but expressed in recall-estimates (error bars indicate 95% confidence intervals). Apart from interoception in the cross-analysis (both precision and recall), all scores were significant (p < 0.001) in a permutation test with 1000 permutations. These results largely replicate our findings as reported in the main text. This suggests that the neural patterns involved in self-focused emotional imagery and other-focused emotion understanding are relatively consistent in terms of spatial distribution across subjects. We explain this consistency by assuming that our tasks engage domain-general psychological processes that are present in all individuals.

```{r tab-shared-states-S3, results='asis'}
data = read_csv('_bookdown_files/shared-states-files/table_S3_data.csv')
kbl(data, booktabs = T, longtable = T, caption = 'Mean general classification scores per subject for the self- and cross-analysis on the validation-set only.') %>%
    kable_styling(full_width = T, font_size = 10) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T,
    general = 'Supplementary Table 3 suggests individual variability in the extent to which neural resources are shared between self- and other-focused processes. In the SF-task all subjects demonstrated a mean classification score well above .33 (i.e., score associated with chance). When generalizing the SF-classifier to the OF-task, however, the classification scores appear to be bimodally distributed (see Supplementary Figure 5C). As can be seen in Table 3, some subjects demonstrated a relatively high mean classification score (i.e., > .45), whereas other subjects demonstrated a classification score at chance level or lower. Note that there is no significant difference between the OF classification scores for subjects who participated in the experiment for the first or second time (“Session” column in table; *t*(18) = 1.73, p = 0.10), nor for subjects who were or were not part of the optimization-set (“Part of optimization-set?” column in table; *t*(18) = -.95, p = 0.35), suggesting that inclusion in the optimization-set or session ordering is not a confound in the analyses. Regarding individual variability in self-other neural overlap, it is important to note that in the field of embodied cognition, there is increasing attention for the idea that simulation is both individually and contextually dynamic (Oosterwijk & Barrett, 2014; Winkielman, Niedenthal, Wielgosz & Kavanagh, 2015; see also Barrett, 2009). To better distinguish between meaningful individual variation and variation due to other factors (e.g., random noise), future research should test a priori formulated hypotheses about how and when individual variation is expected to occur. ')
```

```{r tab-shared-states-S4, results='asis'}
data = read_csv('_bookdown_files/shared-states-files/table_S4_data.csv')
kbl(data, booktabs = T, longtable = T, caption = 'Most important voxels in terms of their average weight across iterations and subjects.') %>%
    kable_styling(full_width = T, font_size = 10) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T,
    general = 'Brain regions were extracted from the Harvard-Oxford (bilateral) Cortical atlas. A minimum threshold for the probabilistic masks of 20 was chosen to minimize overlap between adjacent masks while maximizing coverage of the entire brain. The column *k* represents the absolute number of above-threshold voxels in the masks. The columns *Max*, *Mean*, and *Std* represent the maximum, mean, and standard deviation from the *t*-values included in the masks. Note that the *t*-values, corresponding to the mean weight across subjects normalized by the standard error of the weights across subjects (after correcting for a positive bias when taking the absolute of the weights), were thresholded at a minimum of 1.75, referring to a *p*-value of 0.05 of a one-sided *t*-test against zero with 19 degrees of freedom (i.e. *n* – 1). Note that this *t*-value map was not corrected for multiple comparisons, and is intended to visualize which regions in the brain were generally involved in our sample of subjects. The *X*, *Y*, and *Z* columns represent the MNI152 (2mm) coordinates of the peak (i.e. max) *t*-value for each listed brain region.')
```

<!--chapter:end:09-shared-states-supplement.Rmd-->

```{r setup-confounds-decoding-supplement, include=FALSE}
knitr::opts_chunk$set(results = 'hide', echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(kableExtra)
```

`r if (knitr::is_html_output()) '
# Supplement to Chapter 3 {#confounds-decoding-supplement}
' else '
# Supplement to Chapter \\@ref(confounds-decoding) {#confounds-decoding-supplement}
'`

The following supplementary methods describe the methods for the additional analyses done related to controlling for confounds in decoding analyses of (simulated) fMRI data and the validation of using linear confound models for brain size. All code for these simulations, analyses, and results for the fMRI-related sections can be found in `functional_MRI_simulation.ipynb` notebook. The code for the validation of linear confound models can be found in the notebook `empirical_analysis_gender_classification.ipynb`. Both notebooks are stored in the project's Github repository ([https://github.com/lukassnoek/MVCA](https://github.com/lukassnoek/MVCA)).

## Supplementary methods

### Functional MRI simulation

#### Rationale

The simulations of fMRI data as described here are meant to test the efficacy of our proposed methods for confound control (CVCR) and those proposed by others ["Control for confounds during pattern estimation"; @Woolgar2014-jb) when applied to fMRI data instead of structural MRI data, as we did in the main text. One reason to suspect differences in how these methods behave between structural and functional MRI data is that we need to estimate the feature patterns ($X$) from time series for fMRI data while the feature patterns in structural MRI data are readily available. Moreover, samples in pattern analyses of fMRI data are often correlated (due to temporal autocorrelation in the fMRI signal) while it is reasonable to believe that structural MRI yields independent samples (often individual subjects).

#### Generation of the data ($X$, $y$, $C$)

In these simulations, we generated fMRI time series data across a grid of "voxels" ($K$) which may or may not activate in trials from different conditions. Additionally, we allow for the additive influence of a confounding variable with a prespecified correlation to the target variable [corresponding to the "additive" model from @Woolgar2014-jb]. In short, we generate voxel signal ($s$) as a function of both true effects of the trials from different conditions ($\beta_{X}$), the effect of the confound ($\beta_{C}$), and autocorrelated noise ($\epsilon$):

\begin{equation}
s = X\beta_{X} + C\beta_{C} + \epsilon, \epsilon \sim \mathcal{N}(0, V)
\end{equation}

where $V$ specifies the covariance matrix of a signal autocorrelated as described by to an AR(1) process (we use $\phi_{1} = 0.5$). Note that, here, $X$ and $C$ refer to time-varying (HRF-convolved) predictors instead of, as in in the main text, arrays of features (voxels) across different samples. In this simulation, we evaluate two types of MVPA approaches. In the first approach, which we call "trial-wise decoding", an activity pattern is estimated for each trial separately using the least-squares all technique [LSA; @abdulrahman2016effect]. In LSA, each trial gets its own regressor in a first-level GLM. This approach is often used when there is only a single fMRI run available. In the second approach, which we call "run-wise decoding", an activity pattern is estimated for each condition separately. Now, suppose one acquires a single run with two conditions and twenty trials per condition. In the trial-wise decoding approach, one would estimate the patterns of 40 trials (twenty for condition 1 and twenty for condition 2). Alternatively, suppose that one acquires ten runs with two conditions and again twenty trials per run. In the run-wise decoding approach, one would estimate in total twenty patterns (ten for condition 1 and ten for condition 2).

Formally, for $I$ trials across $P$ conditions, $X$ is ultimately of shape $T$ (timepoints) $\times (I \times P + 1)$ in the trial-wise decoding approach and $T \times (P+1)$ in the run-wise decoding approach (the $+ 1$ refers to the addition of an intercept). In our trial-wise simulations, we simulate 40 trials ($I$) across 2 conditions ($P$). In our run-wise simulations, we simulate 40 trials across 2 conditions in 10 runs. Note that the length of the fMRI run is automatically adjusted to the number of trials ($I$), conditions ($P$), trial duration, and interstimulus interval (ISI); increasing any of these parameters will increase the length of the run. We use a trial duration of 1 second and a jittered ISI between 4 and 5 seconds (mean = 4.5 seconds).

The initial (non-HRF-convolved) confound ($C$, with shape $N \times 1$) is generated with a prespecified correlation to the target ($y$) by adding noise ($\epsilon$) drawn from a standard normal distribution multiplied by a scaling factor ($\gamma$):

\begin{equation}
C = y + \gamma\epsilon
\end{equation}

This process starts with a very small scaling factor ($\gamma$). If the correlation between the target and the confound is too high, the scaling factor is increased and the process is repeated, which is iterated until the desired correlation has been found. The confound is then scaled from 0 to 1 using min-max scaling. After scaling, similar to the single-trial regressors ($X_{j}$), the confound ($C$) is also convolved with an HRF (the SPM default), representing a regressor which is parametrically modulated by the value of the confound for each trial (which could represent, for example, reaction time). The confound, $C$, now represents a time-varying array of shape $T \times 1$. This process is identical for the trial-wise and run-wise decoding approaches. However, when evaluating the efficacy of confound regression (as explained in the next section) in the context of run-wise decoding, we used the means per condition of the confound instead of the trial-wise confound values.

The simulation draws the true activation parameters for the trials from different conditions ($y \in \{0,1\}$ for $P=2$) from a normal distribution with a specified mean and standard deviation. To generate null data (i.e., without any true difference across, e.g., two conditions), we generate the true parameters as follows:

\begin{equation}
\beta_{X(y = p)} \sim \mathcal{N}(\mu, \sigma)
\end{equation}

where, in the case of null data, $\mu$ represents the same mean for all conditions $p = 0, \dots , P-1$. The weight of the confound ($\beta_{C}$) is also drawn from a normal distribution with a prespecified mean ($\mu_{C}$) and standard deviation ($\sigma_{C}$):

\begin{equation}
\beta_{C} \sim \mathcal{N}(\mu_{C}, \sigma_{C})
\end{equation}

The weights for both $X$ and $C$ are drawn independently for the $K$ voxels (we use $10 \times 10 = 100$ voxels for all our simulations). However, to simulate spatial autocorrelation in our grid of artificial voxels, we smooth all $T$ 2D "volumes" (of shape $\sqrt{K} \times \sqrt{K}$) separately with a 2D Gaussian smoothing kernel with a prespecified standard deviation. For our simulations, we use a standard deviation of 1 for the kernel.

#### Estimating activity patterns from the data

After generating the signals ($s$) of shape $T \times K$ (in which the 2D voxel dimension has been flattened to a single dimension), the "activity" parameters ($\hat{\beta}_{X}$) for the trials (for trial-wise decoding) or conditions (for run-wise decoding) are estimated across all K voxels. We estimate these parameters using a generalized least squares (GLS) model on $y$ using the design matrix $X$ and covariance matrix $V$:

\begin{equation}
\hat{\beta}_{X} = (X^{T}V^{-1}X)^{-1}X^{T}V^{-1}y
\end{equation}

where $\hat{\beta}_{X}$ is of shape $N \times K$ (where $N$ refers to the amount of trials in trial-wise decoding and the amount of conditions in run-wise decoding). Note that $C$ is not part of the design matrix $X$, here. This would amount to the "control for confounds during pattern estimation" discussed in Supplementary Methods section "Controlling for confounds during pattern estimation". Before entering these activity estimates ($\hat{\beta}_{X}$) in our decoding pipeline, we divide these them by their standard error to generate $t$-values [as advised in @misaki2010comparison]:

\begin{equation}
t_{\hat{\beta}_{X}} = \frac{\hat{\beta}_{X}}{\sqrt{\sigma^{2}\mathrm{diag}(X^{T}V^{-1}X)^{-1}}}
\end{equation}

where $\sigma^{2}$ is the sum-of-squares error divided by the degrees of freedom ($T-N-1$).

To summarize, in all of our simulations, we keep the following "experimental" parameters constant: we simulate data from two conditions ($y \in \{0,1\}$, which we refer to as "condition 0" and "condition 1"), each condition has 40 trials, trial duration is 1 second, ISIs are jittered between 4 and 5 seconds (mean = 4.5), noise is autocorrelated according to an AR(1) process (with $\phi_{1} = 0.5)$, and the data is spatially smoothed using a Gaussian filter with a standard deviation of 2 across a $10 \times 10$ grid of voxels. For run-wise decoding, we simulate 10 runs.

### Testing confound regression on simulated fMRI data

In this simulation, we aim to test whether confound regression is able to remove the influence of confounds in fMRI data for both trial-wise and run-wise decoding analyses. Similar to the analyses reported in the main article, we contrast WDCR and CVCR, expecting that WDCR leads to similar negative bias while CVCR leads to similar (nearly) unbiased results. We use the same pipeline as in the other simulations, which consists of a normalization step to ensure that each feature has a mean of zero and a  unit standard deviation, and a support vector classifier with a linear kernel (regularization parameter $C=1$). The decoding pipeline uses a 10-fold stratified cross-validation scheme. For the run-wise decoding analyses, this is equivalent to a leave-one-run-out cross-validation scheme. Model performance in this simulation is reported as accuracy (as there is no class imbalance). The simulation was repeated 10 times for robustness.

Specifically, we evaluate and report model performance after confound regression both in the trial-wise decoding and run-wise decoding context and for different strengths of the correlation between the target and the confound ($r_{Cy} \in  \{0,0.1, \dots ,0.9,1\}$). Because arguably the temporal autocorrelation of fMRI data is the most prominent difference between fMRI and structural MRI data, and thus might impact decoding analyses differently [@gilron2016addressing], we additionally test CVCR on data that differs in the degree of autocorrelation. We manipulate autocorrelation by temporally smoothing the signals ($y$) before fitting the first-level GLM using a Gaussian filter with increasing widths ($\sigma_{\mathrm{filter}} = \{0, 1 , \dots , 5\}$), yielding data with increasing autocorrelation. We used a grid of $4 \times 4$ voxels for this simulation to reduce computation time.

### Controlling for confounds during pattern estimation

As discussed in the main text, one way to potentially control for confounds in fMRI data is to remove their influence when estimating the activity patterns in an initial first-level model [@Woolgar2014-jb]. In this section of the Supplementary methods, we tested the efficacy of this method on simulated fMRI data in both trial-wise decoding and run-wise decoding contexts. Note that the original article on this method [@Woolgar2014-jb] performed run-wise decoding. 

Specifically, we tested whether confounds can be controlled by adding the (HRF-convolved) confound to the design matrix $X$ in the first-level pattern estimation procedure. According to @[Woolgar2014-jb], when assuming that the confound has a truly additive effect, adding the confound to the design matrix will yield (single-trial) pattern estimates ($\hat{\beta}_{X}$X) that only capture unique variance (i.e., no variance related to the confound). In our simulations, we tested two versions of this method. In one version, which we call the "default" version, the confound is added to the design matrix and the (GLS) model is estimated on using the design-matrix including both the single-trial (for trial-wise decoding) or condition regressors (for run-wise decoding) and the confound regressor. In the other version, which we call the "aggressive" version [reflecting the same terminology as the fMRI-denoising method "ICA-AROMA"; @pruim2015ica], the confound regressor is first regressed out of the signal ($s_{\mathrm{corr}} = s- C\hat{\beta}_{C}$) before fitting the regular first-level model using the design matrix ($X$) without the confound regressor. The reason for testing these two methods is because it is unclear from the original Woolgar et al. articles [@Woolgar2014-jb; @woolgar2011multi] which version was used and whether the two versions yield different results.

In our simulation, we varied the correlation between the (non-HRF-convolved) confound and the target (here, $y \in \{0,1\}$). Importantly, we generated data without any effect, i.e., the parameters of the trials from the two different conditions ($\beta_{X | y = 0}$ and $\beta_{X | y = 1}$) were (independently) drawn from the same normal distribution with a mean of 1 and standard deviation of 0.5. Similar to the other simulations, we use patterns of t-values in our decoding pipeline (unless explicitly stated otherwise). For both trial-wise and run-wise decoding, we report results from the default and aggressive procedure. All analyses are documented in the aforementioned notebook containing the fMRI simulations.

### Linear vs nonlinear confound models: predicting VBM and TBSS data based on brain size

In the main text, we used linear models to regress out variance associated with brain size from VBM and TBSS data. Here, we test whether a linear model of the relation between brain size and VBM and TBSS data is suitable, and whether possibly a nonlinear model should have been preferred. We do this by performing a model comparison between linear, quadratic, and cubic regression models. All analyses and results can be found in the `brain_data_vs_brainsize.ipynb` notebook from the Github repository associated with this article.

For all analyses in this section, brain size with and without second and third degree polynomials were used as independent variables. As target variables, we created four voxel sets: first, we selected 500 random voxels from the VBM and TBSS data (voxel set A). Second, to inspect how large the *misfit* of a linear model could be, we selected as target variables the 500 voxels which have the highest quadratic (voxel set B) and cubic (voxel set C) correlation with brain size. Finally we select the 500 voxels with highest linear correlation with brain size (voxel set D), to inspect how large the misfit of a polynomial model is in these voxels.

We applied a 10-fold cross-validation pipeline which consisted of scaling features to mean 0 and standard deviation 1, and fitting an ordinary least squares regression model. Explained variance ($R^2$) was used as a metric of model performance. The pipeline was repeated 50 times with random shuffling of samples.

For each voxel, we calculated the difference between model performance of linear and polynomial models. Negative differences ($\Delta R^2_{\mathrm{linear - polynomial}} < 0$) indicate that the polynomial model has higher cross-validated $R^2$ than a linear model, and thus, that a linear confound regression model would leave variance arguably associated with the confound in the target voxel. We plot the distributions of $\Delta R^2_{\mathrm{linear - polynomial}}$ to inspect for how many voxels this is the case, and for how many voxels linear models perform better.

## Supplementary results

The following supplementary results describe the results from the supplementary analyses related to controlling for confounds in decoding analyses of (simulated) fMRI data.

### Testing confound regression on simulated fMRI data

Here, we evaluated the efficacy of confound regression (both WDCR and CVCR) on simulated fMRI data in both trial-wise and run-wise decoding analyses across different strengths of the correlation between the target and the confound. Similar to the results reported in the main article, we find that WDCR yields consistent below chance accuracy in both the trial-wise and run-wise decoding analyses (Supplementary Figure \@ref(fig:fig-confounds-decoding-S1), upper panels) and that CVCR yields (nearly) unbiased results for both trial-wise and run-wise decoding (Supplementary Figure \@ref(fig:fig-confounds-decoding-S1), lower panels). 

```{r fig-confounds-decoding-S1, fig.cap='(ref:caption-fig-confounds-decoding-S1)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S1.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S1) Model performance when using WDCR (upper panels) and CVCR (lower panels) to remove the influence of confounds in simulated fMRI data across different correlations between the confound and the target ($r_{Cy}$). Error-bars reflect the 95% CI across iterations.

Moreover, CVCR effectively controls for confounds on fMRI data with varying amounts of autocorrelation for both trial-wise and run-wise decoding analyses, as is shown in Supplementary Figure \@ref(fig:fig-confounds-decoding-S2).

```{r fig-confounds-decoding-S2, fig.cap='(ref:caption-fig-confounds-decoding-S2)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S2.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S2) Model performance using CVCR versus no control and baseline (data with no confound) for different levels of autocorrelation (after smoothing with a Gaussian filter with an increasing standard deviation, $\sigma_{\mathrm{filter}}$) for trial-wise and run-wise decoding. Note that for trial-wise decoding, high autocorrelation leads to below chance-accuracy for CVCR, but this is also present in the baseline data, which suggests that high autocorrelation in general leads to negative bias (at least in our simulation).

### Controlling for confounds during pattern estimation

Here, we tested the efficacy of controlling for confound during pattern estimation [as proposed by @Woolgar2014-jb]. Similar to the previous Supplementary analyses, we evaluated this method’s efficacy in both trial-wise and run-wise decoding analyses. We furthermore evaluated both the "default" (add the confound to the first-level design matrix) and "aggressive" (regress the confound from the signal before fitting the first-level model) approaches.

```{r fig-confounds-decoding-S3, fig.cap='(ref:caption-fig-confounds-decoding-S3)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S3.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S3) Model performance when controlling for confounds during pattern estimation using the "default" (upper panels) and "aggressive" (lower panels) versions for both trial-wise (left panels) and run-wise decoding (right panels). Note that, in these analyses, patterns of t-values from the first-level model are used as features.

As can be seen in Supplementary Figure \@ref(fig:fig-confounds-decoding-S3), this method fails to control for confounds for all variants that are tested (trial-wise vs. run-wise decoding, "default" vs. "aggressive|). Below, we provide a potential explanation of this bias. We argue that the mechanism underlying this bias is different in trial-wise decoding than in run-wise decoding. We will first focus on the trial-wise decoding analyses.

#### Explanation for bias in trial-wise decoding analyses

To supplement this explanation, in Supplementary Figure \@ref(fig:fig-confounds-decoding-S4) we visualized the distribution of parameter estimates from the first-level model, $\hat{\beta}_{X}$ across the two conditions after controlling for the confound during pattern estimation using the "aggressive" version in trial-wise decoding (but the graphs are similar when plotting the data from the "default" version; graphs for run-wise decoding analyses are, however, different, which will be discussed later).

```{r fig-confounds-decoding-S4, fig.cap='(ref:caption-fig-confounds-decoding-S4)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S4.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S4) Distribution of first-level parameter estimates, $\hat{\beta}_{X}$, for the two conditions (condition 0 in blue, condition 1 in orange) across different correlations between the target and the confound ($r_{Cy}$), with the colored dashed lines indicating the mean feature value for each condition.

When inspecting Supplementary Figure \@ref(fig:fig-confounds-decoding-S4), recall that the data were generated with a confound that was positively correlated with the target. Given that the target variable represents the two different conditions ($y \in \{0, 1\}$), the existence of a positive correlation between the target and the confound implies that the confound increases the activation of the voxel in trials from condition 0. The confound’s effect on the voxel increases with higher correlations between the target and the confound. For example, suppose trials from condition 0 and condition 1 both truly activate the voxel with 1 unit ($\beta_{X | y=0} = 1$ and $\beta_{X | y = 1} = 1$; Supplementary Figure \@ref(fig:fig-confounds-decoding-S5), upper panel), and that the confound is perfectly correlated with the target ($r_{Cy} = 1$) and thus activates the voxel additionally with 1 unit ($\beta_{C} = 1$). In this case, without confound control, one would expect the voxel to be activated in response to trials from condition 1 with a magnitude of 2 ($\hat{\beta}_{X | y = 1} \approx \beta_{X | y = 1} + \beta_{C}$; Supplementary Figure \@ref(fig:fig-confounds-decoding-S5), middle panel). If one in fact would control for the confound by regressing out the confound from the signal (i.e., the "aggressive" approach), one would completely remove both the true effect ($\beta_{X|y=1}$) and the confound effect ($\beta_{C}$), driving the estimated activation parameter for condition 1 towards 0 ($\hat{\beta}_{X|y=1} \approx 0$). The activation parameter for condition 0 is unaffected by removing the confound, as they are uncorrelated, and will thus be estimated correctly ($\hat{\beta}_{X|y=0} = 1$; see Supplementary Figure \@ref(fig:fig-confounds-decoding-S5), lower panel). In this way, controlling for the confound created an artificial "effect": trials from condition 0 seem to activate the voxel more than trials from condition 1 ($\hat{\beta}_{X|y=0} > \hat{\beta}_{X|y=1}$). We believe that this phenomenon underlies the positive bias when controlling for confounds during pattern estimation in trial-wise decoding analyses.^[One could argue that this issue only poses a problem when the true parameters are non-zero ($\beta_{X|y=0} = \beta_{X|y=1} \neq 0$) and when the true parameters are in fact all zero ($\beta_{X|y=0} = \beta_{X|y=1} = 0$), there would be no positive bias. This is indeed the case, but we note that the true parameters are never known in empirical anlayses, so we nonetheless advise against using this method.]

```{r fig-confounds-decoding-S5, fig.cap='(ref:caption-fig-confounds-decoding-S5)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S5.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S5) Visualization of the issue underlying positive bias arising when controlling for confounds during pattern estimation. The upper panel ("true generative model") shows the individual single-trial regressors for the different conditions, scaled by their true weight (here,$\beta_{X|y=0} = \beta_{X|y=1} = 1$) and the confound (here, $r_{Cy} = 0.9$). The middle panel ("signal") shows the signal resulting from the generative model (including noise, $\epsilon$). The lower panel ("estimated parameters") shows the estimated model parameters for the different single-trial regressors. The dashed lines represent the average estimated parameter per condition, which shows that the estimated parameters of the condition that is correlated with the confound are driven towards zero. 

#### Explanation for bias in run-wise decoding analyses

We believe that the cause of bias in run-wise decoding analyses after controlling for confounds during pattern estimation is different than the cause of bias in trial-wise decoding analyses. Upon further inspection of the results of this simulation, we found that in the specific case of run-wise decoding with the "default" approach (i.e., including the confound in the first-level model instead of regressing the confound out of the signal before fitting the first-level model), there is no bias when using patterns of parameter estimates ($X$) instead of patterns of *t*-values (*t*($X$); Supplementary Figure \@ref(fig:fig-confounds-decoding-S6), upper row, left panel). Indeed, when visualizing the distributions of the feature values (Supplementary Figure \@ref(fig:fig-confounds-decoding-S6), lower row), using the "raw" parameter estimates ($\hat{\beta}_{X}$, left column) or *t*-values (right column), it is clear that the bias only arises when using *t*-values. In fact, this bias in *t*-values is caused by unequal variance (Supplementary Figure \@ref(fig:fig-confounds-decoding-S6), middle panel) of the parameter estimates. The cause of the increased variance for condition 1, here, is due to the fact that a positive correlation between the confound and target ($r_{Cy}$) results in a relatively higher correlation between the regressor of condition 1 and the confound regressor compared to the correlation between the regressor of condition 0 and the confound regressor. (Note that if the correlation would be negative, e.g., $r_{Cy} = -0.9$, then the reverse would be true.) This issue of classifiers picking up differences in parameter variance in the process of estimating patterns for MVPA has been termed "variance decoding", which is described in detail in
@Gorgen2017-sy and @Hebart2017-jn.

```{r fig-confounds-decoding-S6, fig.cap='(ref:caption-fig-confounds-decoding-S6)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S6.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S6) Visualization of model performance and feature distributions based on patterns of "raw" parameter estimates ($\hat{\beta}_{X}$), variance of parameter estimates ($\mathrm{var}(\hat{\beta}_{X})$), or *t*-values ($t(\hat{\beta}_{X})$)) after controlling for confounds. The upper row shows the average accuracy across folds across different values of the correlation between the confound and the target ($r_{Cy}$) for the different types of features. Note that the middle panel shows that "variance decoding" only occurs when controlling for confounds, as model performance is at chance when using patterns of variance estimates (the blue line in the middle panel). The lower row represents the distributions of feature values for the three different statistics when $r_{Cy} = 0.9$.

To summarize, we found that controlling for confound during pattern estimation leads to positive bias in all cases except in run-wise decoding using the "default" approach. We believe that cross-validated confound regression (CVCR) is nevertheless preferable to this method because it both controls for confounds effectively and allows the use of *t*-values (or other statistics based on parameter estimates, like multivariate noise-normalized parameter estimates), which has been shown to be more sensitive than using "raw" parameter estimates in MVPA [@misaki2010comparison; @Guggenmos2018-rr; @Walther2016-je].

### Linear vs. nonlinear confound models: predicting VBM and TBSS intensity using brain size

Supplementary Figure \@ref(fig:fig-confounds-decoding-S7) (top left panel) shows the distributions of difference in cross-validated $R^2$ (Linear - Polynomial) for the VBM data with 500 randomly selected voxels (voxel set A). A linear model performs (slightly) better (positive $R^2$) than a quadratic model for 86.6% of these voxels (mean $\Delta R^{2}_{\mathrm{linear-quadratic}} = 0.009$, *SD* = 0.006), and better than a cubic model for 90.8% of the voxels (mean $\Delta R^{2}_{\mathrm{linear-cubic}} = 0.019$, *SD* = 0.027). Note that it can be expected that polynomial and cubic models perform better in a minority of the voxels simply due to random noise in the data (since we compare 500 $R^2$-values), even if the "true" underlying relation is linear. To visualize the quality of fit of these models fit, brain size is plotted against VBM voxel intensity for a randomly selected voxel from this set in the bottom left panel. Lines are regression lines for the linear, quadratic, and cubic models. Supporting the use of a linear model, there is no clear deviation from bivariate normality.

```{r fig-confounds-decoding-S7, fig.cap='(ref:caption-fig-confounds-decoding-S7)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S7.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S7) Top row: $R^2$ distributions for the four voxel sets of the VBM data. Density estimates are obtained by kernel density estimation with a Gaussian kernel and Scott’s rule (Scott, 1979) for bandwidth selection. Bottom row: scatter plots of the relation between brain size (scaled to mean 0 and SD 1) and voxel intensity from randomly selected voxels from each voxel sets. These panels are included to visualize the quality of model fits and to inspect whether there are no obvious misfits, i.e., whether the models miss patterns in the data. This is not the case --- all models seem to fit the distributions reasonably well.

To explore further how well linear models perform in voxels where we expect polynomial models to perform best, we plotted the $R^2$ distributions for the 500 voxels with the highest overall quadratic correlation with brain size (voxel set B; second column). These are the voxels where a quadratic model would remove most variance (if used in a confound regression procedure). Also for these voxels, a linear model performs equally well as or better than a quadratic model ($R^2_{\mathrm{linear-quadratic}} > 0$ for 89.4% of the voxels, mean $\Delta R^{2}_{\mathrm{linear-quadratic}} = 0.006$, *SD* = 0.007) and a cubic model ($\Delta R^{2}_{\mathrm{linear-cubic}} > 0$ for 57.8% of these voxels, mean $\Delta R^2_{\mathrm{linear-cubic}} = 0.003$, *SD* = 0.015). For a randomly selected voxel from this set, a scatter plot is included in the bottom panel to visualize how well the regression models fit. The plot indicates no obvious misfit of any of the models.

The same analysis was also performed for the 500 voxels that have the highest overall cubic correlation with brain size (voxel set C; third column). The histograms look similar to the histograms in the second column because voxel sets B and C consisted of largely the same voxels. It should not thus not be surprising that linear models again perform well compared to quadratic models ($\Delta R^{2}_{\mathrm{linear-quadratic}} > 0$ for 90.4% of the voxels, mean $\Delta R^2_{\mathrm{linear-quadratic}} = 0.006$, *SD* = 0.006), and compared to cubic models ($\Delta R^{2}_{\mathrm{linear-cubic}} > 0$ for 57.6% of these voxels, mean $\Delta R^{2}_{\mathrm{linear-cubic}} = 0.003$, *SD* = 0.014). The bottom panel shows a randomly selected voxel from this voxel set, which again shows no obvious misfit.

Finally, we inspect the 500 voxels with the highest overall linear correlation with brain size (voxel set D, fourth column). Again, these turned out the be partly the same voxels as in set B and C. Therefore, linear models perform again equally well as or better than quadratic models ($\Delta R^2_{\mathrm{linear-quadratic}} > 0$ for 94.2% of the voxels, mean $\Delta R^2_{\mathrm{linear-quadratic}} = 0.007$, *SD* = 0.004) and cubic models ($\Delta R^{2}_{\mathrm{linear-quadratic}} > 0$ for 59.2% of the voxels, mean $\Delta R^{2}_{\mathrm{linear-quadratic}} = 0.004$, *SD* = 0.014). The bottom panel show a randomly selected voxel from this voxel set, and indicates that all models capture the structure in the data.

Together, these results seem to imply that for all voxel sets, linear models perform mostly equally well as or better than polynomial models. Yet, it is interesting to inspect the "worst case" voxels; that is, to inspect how large the maximal misfit of a linear model is. Therefore, in Supplementary Figure \@ref(fig:fig-confounds-decoding-S8), we plot the relation between brain size and VBM intensity for the voxel with most negative $\Delta R^{2}_{\mathrm{linear-cubic}}$ from voxel set A (left panel) and voxel set B. For comparison, we also plot the relation between brain size and the voxel where a linear model performs better than a cubic model (selected from voxel set B). For the selected voxels, $\Delta R^{2}_{\mathrm{linear-cubic}}$ values are -0.036 (left panel), -0.039(middle panel) and 0.032. Especially in the middle and right panel, the difference in fit between the linear and cubic model is mostly apparent the tails of the brain size distribution, where the model fit is based on least observations. For most brain sizes, both models make similar predictions about voxel intensity.

```{r fig-confounds-decoding-S8, fig.cap='(ref:caption-fig-confounds-decoding-S8)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S8.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S8) Visualisation of the relation between brain size and VBM intensity for three voxels. The left two voxels have most negative $\Delta R^{2}_{\mathrm{linear-cubic}}$ (i.e., the cubic model performs maximally better than the linear model) in voxel sets A and B, respectively. The voxel plotted in the right panel has the most positive $\Delta R^{2}_{\mathrm{linear-cubic}}$ in voxel set B.

We repeated the same analyses for the TBSS data, and summarize the results in Supplementary Figure \@ref(fig:fig-confounds-decoding-S9). Since the results are qualitatively the same as for the VBM data, and lead to the same conclusions, we do not discuss them in detail. Those interested can find additional details in the notebook of this simulation.

```{r fig-confounds-decoding-S9, fig.cap='(ref:caption-fig-confounds-decoding-S9)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S9.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S9) Top row: $R^2$ distributions for the four voxel sets of the TBSS data. Density estimates are obtained by kernel density estimation with a Gaussian kernel and Scott’s rule (Scott, 1979) for bandwidth selection. Bottom row: scatter plots of the relation between brain size (scaled to mean 0 and SD 1) and voxel intensity from randomly selected voxels from each voxel sets. These panels are included to visualize the quality of model fits and to inspect whether there are no obvious misfits, i.e., whether the models miss patterns in the data. This is not the case --- all models seem to fit the distributions well.

```{r fig-confounds-decoding-S10, fig.cap='(ref:caption-fig-confounds-decoding-S10)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S10.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S10) Model performance of fully cross-validated confound regression (CVCR) versus confound regression on the train-set only ("train only") on simulated data without any experimental effect (signal $R^2 = 0.004$; left graph) and with some experimental effect (signal $R^2 = 0.1$; right graph) for different values of confound $R^2$ (cf. Figure \@ref(fig:fig-confounds-decoding-8) in the main text). The orange line represents the average performance (± 1 SD) when confound $R^2$ = 0, which serves as a "reference performance" for when there is no confounded signal in the data. For both graphs, the correlation between the target and the confound, $r_{yC}$, is fixed at 0.65. The reason for testing this version of confound regression (i.e., on the train-set only) is because it reduces the computation time substantially compared to fully cross-validated confound regression (as it does not have to compute $X_{\mathrm{test}} = X_{\mathrm{test}} - C_{\mathrm{test}}\hat{\beta}_{C}$). However, this method seems to yield substantial bias when there is (almost) no signal (left graph), but intriguingly not when there is true signal (right graph). 

```{r fig-confounds-decoding-S11, fig.cap='(ref:caption-fig-confounds-decoding-S11)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S11.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S11) Model performance of the different evaluated methods for confound control but using the AUC-ROC metric to measure model performance instead of $F_{1}$ score, as this latter metric has been criticized because it neglects false negatives [@powers2020evaluation]. The results are highly similar to results obtained when using the $F_{1}$ score (cf. Figure \@ref(fig:fig-confounds-decoding-8) in the main text).

```{r fig-confounds-decoding-S12, fig.cap='(ref:caption-fig-confounds-decoding-S12)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S12.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S12) Model performance of the different evaluated methods for confound control, including a method proposed by a reviewer. This method entails training the decoding model on data including the confound as a predictor (i.e., an implementation of the "Include confound in model" method), but setting the confound values to their mean in the test set. The rationale is that the decoding model cannot profit from the confound in the test set. However, contrary to expectations, this method performs similarly to not controlling for confounds.

```{r fig-confounds-decoding-S13, fig.cap='(ref:caption-fig-confounds-decoding-S13)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S13.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S13) Reproduction of Figure \@ref(fig:fig-confounds-decoding-8) from the main text ("generic simulation" results), but with the random subsampling procedure instead of the targeted subsampling procedure (from only a single iteration due to time constraints). This procedure attempts to find a subsample of the data of a given size without a correlation between target and confound for 10.000 tries. If such a subsample cannot be found, the subsample size is decreased by 1, after which again 10.000 attempts are made to find a good subsample with the new size. The results from counterbalancing, here, are qualitatively similar to the results when using the "targeted subsampling" method (cf. Figure \@ref(fig:fig-confounds-decoding-8) in the main text), albeit much slower. 

```{r fig-confounds-decoding-S14, fig.cap='(ref:caption-fig-confounds-decoding-S14)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S14.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S14) Reproduction of Figure \@ref(fig:fig-confounds-decoding-10) from the main text, but with the random subsampling procedure instead of the targeted subsampling procedure. This procedure attempts to find a subsample of the data of a given size without a correlation between target and confound for 10.000 tries. If such a subsample cannot be found, the subsample size is decreased by 1, after which again 10.000 attempts are made to find a good subsample with the new size. The plot shows that also random subsampling can induce a positive bias, even with extreme power loss (90% smaller sample).

```{r fig-confounds-decoding-S15, fig.cap='(ref:caption-fig-confounds-decoding-S15)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S15.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S15) These plots show that the relationship between the standard deviation of the empirical feature-target correlation distribution, *sd*($r_{yX}$), and accuracy holds for different samples sizes (i.e., values for $N$). Note that the predicted accuracy based on the standard deviation expected from the sampling distribution is at 0.5 for every plot. The data were generated in the same manner as reported in the WDCR follow-up section.

```{r fig-confounds-decoding-S16, fig.cap='(ref:caption-fig-confounds-decoding-S16)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S16.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S16) These plots show that the relationship between the standard deviation of the empirical feature-target correlation distribution and accuracy also holds for sizes of the test-set [replicating results from @Jamalabadi2016-gr]. Note that the predicted accuracy is again at 0.5 for every plot. The data were generated in the same manner as reported in the WDCR follow-up section.

```{r fig-confounds-decoding-S17, fig.cap='(ref:caption-fig-confounds-decoding-S17)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S17.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S17) These plots show that the relationship between the standard deviation of the empirical feature-target correlation distribution, *sd*($r_{yX}$), and accuracy also holds for different numbers of features ($K$). Note that the predicted accuracy based on *sd*($r_{yX}$) is approximately at 0.5 for every plot. The data were generated in the same manner as reported in the WDCR follow-up section.

```{r fig-confounds-decoding-S18, fig.cap='(ref:caption-fig-confounds-decoding-S18)', results='show'}
knitr::include_graphics("_bookdown_files/confounds-decoding-files/figures/figure_S18.png", auto_pdf = TRUE)
```

(ref:caption-fig-confounds-decoding-S18) The relation of the standard deviation of the correlation distribution and accuracy for different values of $K$. 


<!--chapter:end:10-confounds-decoding-supplement.Rmd-->

```{r setup-aomic-supplement, include=FALSE}
knitr::opts_chunk$set(results = 'hide', echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(kableExtra)
```

`r if (knitr::is_html_output()) '
# Supplement to Chapter 4 {#aomic-supplement}
' else '
# Supplement to Chapter \\@ref(aomic) {#aomic-supplement}
'`

```{r tab-aomic-S1, results='asis'}
data = read_csv('_bookdown_files/aomic-files/table_S1_data.csv')
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T,
    caption = 'Acquisition parameters for the T1-weighted scans acquired across all three datasets.') %>%
    kable_styling(full_width = T, font_size = 8) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = 'MPRAGE: Magnetization Prepared Rapid Gradient Echo, FOV: field-of-view, RL: right-left, AP: anterior-posterior, FH: feet-head, TR: time to repetition, TE: time to echo, n/a: not applicable. * Whole-brain coverage included the brain-stem and cerebellum, unless otherwise stated.')
```
<br>
```{r tab-aomic-S2, results='asis'}
data = read_csv('_bookdown_files/aomic-files/table_S2_data.csv')
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T,
    caption = 'Acquisition parameters for the phase-difference fieldmap scans acquired across all three datasets.') %>%
    kable_styling(full_width = T, font_size = 8) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = 'MPRAGE: Magnetization Prepared Rapid Gradient Echo, FOV: field-of-view, RL: right-left, AP: anterior-posterior, FH: feet-head, TR: time to repetition, TE: time to echo.')
```
<br>
```{r tab-aomic-S3, results='asis'}
data = read_csv('_bookdown_files/aomic-files/table_S3_data.csv')
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T,
    caption = 'Acquisition parameters for the fMRI scans acquired across all three datasets.') %>%
    kable_styling(full_width = T, font_size = 8) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = 'MPRAGE: Magnetization Prepared Rapid Gradient Echo, GE-EPI: gradient-echo echo-planar imaging, FOV: field-of-view, RL: right-left, AP: anterior-posterior, FH: feet-head, TR: time to repetition, TE: time to echo, Seq.: sequential (non-multiband), MB: multiband (i.e., simultaneous slice excitation). * MB scans were acquired for the face perception and resting-state paradigms of PIOP2. Sequential scans were acquired for the movie watching (ID1000), working memory, emotion matching, gender stroop, emotion anticipation, stop signal paradigms (PIOP1 and PIOP2). ')
```
<br>
```{r tab-aomic-S4, results='asis'}
data = read_csv('_bookdown_files/aomic-files/table_S4_data.csv')
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T,
    caption = 'Acquisition parameters for the DWI scans acquired across all three datasets.') %>%
    kable_styling(full_width = T, font_size = 8) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = 'SE-DWI: Spin-Echo Diffusion-Weighted Imaging,, FOV: field-of-view, RL: right-left, AP: anterior-posterior, FH: feet-head, TR: time to repetition, TE: time to echo. *DWI scans were acquired with the shortest possible TR ("shortest" setting on Philips scanners), causing the actual TR values to vary from scan to scan. The TRs reported in this table reflect the median TR across all DWI scans per dataset (see the Raw data standardization section for more information.')
```
<br>
```{r tab-aomic-S5, results='asis'}
data = read_csv('_bookdown_files/aomic-files/table_S5_data.csv')
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T,
    caption = 'Description of the subject variables and psychometric variables.') %>%
    kable_styling(full_width = T, font_size = 8) %>%
    column_spec(1, width = '8em') %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = 'The “variable name” coincides with the column name for that variable in the participants.tsv file. Note that missing values in this file are coded with “n/a”. A.U.: arbitrary units.')
```
<br>
```{r tab-aomic-S6, results='asis'}
data = read_csv('_bookdown_files/aomic-files/table_S6_data.csv')
options(knitr.kable.NA = '') 
kbl(data, booktabs = T, longtable = T,
    caption = 'All data types with associated identifiers, descriptions, and modalities.') %>%
    kable_styling(full_width = T, font_size = 8) %>%
    column_spec(1, width = '2em')
```

<!--chapter:end:11-aomic-supplement.Rmd-->

---
output:
  pdf_document: default
  html_document: default
---
```{r setup-morbid-curiosity-supplement, include=FALSE}
knitr::opts_chunk$set(results = 'hide', echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(kableExtra)
```

`r if (knitr::is_html_output()) '
# Supplement to Chapter 5 {#morbid-curiosity-supplement}
' else '
# Supplement to Chapter \\@ref(morbid-curiosity) {#morbid-curiosity-supplement}
'`

```{r tab-morbid-curiosity-S1, results='asis'}
data = read_csv('_bookdown_files/morbid-curiosity-files/table_S1_data.csv')
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T,
    caption = ' List of Neurosynth terms associated with the results of the exploratory whole-brain
analyses.') %>%
    kable_styling(full_width = T, font_size = 8) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = 'The ten terms with the highest spatial correlation with the whole-brain
maps (excluding anatomical terms) are reported.')
```


```{r tab-morbid-curiosity-S2, results='asis'}
data = suppressWarnings(read_csv('_bookdown_files/morbid-curiosity-files/table_S2_data.csv'))
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T, caption = 'Cluster statistics and associated brain regions from the exploratory whole-brain analysis.') %>%
    kable_styling(full_width = T, font_size = 9) %>%
    column_spec(column = c(1, 2, 3, 4, 5, 6, 8, 9), width = "1em") %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = 'The X, Y, and Z coordinates refer to MNI152 (2 mm) space. The regions are taken from the Harvard–Oxford (sub)cortical atlas and voxels are assigned to regions based on their maximum probability across all ROIs within the atlas. *K* refers to the number of voxels within a particular region.')
```

```{r tab-morbid-curiosity-S3, results='asis'}
data = suppressWarnings(read_csv('_bookdown_files/morbid-curiosity-files/table_S3_data.csv'))
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T, caption = 'Cluster statistics and associated brain regions from the exploratory whole-brain analysis.') %>%
    kable_styling(full_width = T, font_size = 9) %>%
    column_spec(column = c(1, 2, 3, 4, 5, 6, 8, 9), width = "1em") %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = 'The X, Y, and Z coordinates refer to MNI152 (2 mm) space. The regions are taken from the Harvard–Oxford (sub)cortical atlas and voxels are assigned to regions based on their maximum probability across all ROIs within the atlas. *K* refers to the number of voxels within a particular region.')
```

```{r tab-morbid-curiosity-S4, results='asis'}
data = suppressWarnings(read_csv('_bookdown_files/morbid-curiosity-files/table_S4_data.csv'))
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T, caption = 'Stimulus codes for the images used in the choice task.') %>%
    kable_styling(full_width = T, font_size = 9) %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = T, 
             general = 'Images were taken from both the IAPS (Lang, Bradley, & Cuthbert, 1997) and NAPS (Marchewka, Żurawski, Jednoróg, & Grabowska, 2014) database.')
```

```{r fig-morbid-curiosity-S1, fig.cap='(ref:caption-fig-morbid-curiosity-S1)', results='show'}
knitr::include_graphics("_bookdown_files/morbid-curiosity-files/figures/figure_S1.png", auto_pdf = TRUE)
```

(ref:caption-fig-morbid-curiosity-S1) Subplots of individual regressors from the significant voxels in the confirmatory contrast negative~active - passive~ - positive~active - passive~ in the induction-phase. These plots show the direction of the effects. Plots are averaged over all significant voxels within each ROI (striatum in upper plots, IFG in lower plots), separately for the negative trials (left plots) and positive trials (right plots) with subplots for the active choice and passive viewing condition. Dots represent the participant-specific ROI-average parameter estimate from the first-level analysis. The horizontal line in the boxplots represents the median and the whiskers represent the interquartile range. Note that this figure is only meant to show the directionality of the effects, not their statistical significance (as the ROIs itself only contain voxels that were significant in the group-analysis).

<!--chapter:end:12-morbid-curiosity-supplement.Rmd-->

`r if (knitr::is_html_output()) '
# Supplement to Chapter 6 {#hypothesis-kernel-analysis-supplement}
' else '
# Supplement to Chapter \\@ref(hypothesis-kernel-analysis) {#hypothesis-kernel-analysis-supplement}
'`

<!--chapter:end:13-hypothesis-kernel-analysis.Rmd-->

```{r setup-svsd-supplement, include=FALSE}
knitr::opts_chunk$set(results = 'hide', echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(kableExtra)
```

`r if (knitr::is_html_output()) '
# Supplement to Chapter 6 {#static-vs-dynamic-supplement}
' else '
# Supplement to Chapter \\@ref(static-vs-dynamic) {#static-vs-dynamic-supplement}
'`

```{r fig-svsd-S1, fig.cap='(ref:caption-fig-svsd-S1)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_S1.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-S1) The explained variance ratio of each PCA component (bars; left y-axis) and the cumulative explained variance ratio (dashed line; right y-axis) for the PCA done on the dynamic features (top) and static features (bottom).

```{r fig-svsd-S2, fig.cap='(ref:caption-fig-svsd-S2)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_S2.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-S2) Distribution of the categorical emotion labels (bars height represents the average proportion; dots represent individual participants; top) and the distribution of the valence ratings (middle) and arousal rating (bottom), shown separately for the optimization set (left) and test set (right). In the valence and arousal subplots, the filled area represents the distribution of the ratings pooled over participants and the lines represents the distribution of the ratings of individual participants. The valence and arousal distributions were created using kernel density estimation as implemented in the Python package *seaborn* (which uses the *scipy* function `gaussian_kde` with Scott’s rule for bandwidth selection).

```{r fig-svsd-S3, fig.cap='(ref:caption-fig-svsd-S3)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_S3.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-S3) Cross-validated model performance on optimization set, obtained by repeated 10-fold cross-validation. Because the optimization set does not contain repeated observations, the noise ceiling from the test set is visualized.

```{r fig-svsd-S4, fig.cap='(ref:caption-fig-svsd-S4)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_S4.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-S4) Visualization of the comparison between the sum of static and dynamic model performance (orange) and the combined model performance (blue) for the categorical emotion model (left) and valence/arousal model (right).

```{r fig-svsd-S5, fig.cap='(ref:caption-fig-svsd-S5)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_S5.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-S5) Confusion matrices for the categorical emotions models (left) and regression plots for the valence model (middle) and arousal model (right), separately for the models based on dynamic information (top) and static information (bottom). The confusion matrices are normalized by the sum across rows, thus representing the recall (or sensitivity) on the diagonal. The categorical emotion classifier based on dynamic information relatively frequently misclassifies “anger” and “disgust” (and vice versa) as well as “surprise” and “fear” (and vice versa), replicating earlier findings from human ratings [@Jack2014-ku; @Jack2009-yy]. In contrast, the confusion rates for the static emotion classifier are relatively uniform across categorical emotion pairs. Different colors in the regression plot represent ratings from different participants. The regression plots for the valence and arousal models (middle and right) show that both the models based on dynamic and static features tend to underestimate the magnitude of the predictions (i.e., few predictions are made above 0.5 or below -0.5). These attenuated predictions is a direct consequence of the strong regularization applied to the regression models (i.e., $\lambda = 500$), which causes the parameters (i.e., $\hat{\beta}$) to be shrunk towards zero, thus shrinking predictions ($X\hat{beta}$) towards the mean as well.

```{r fig-svsd-S6, fig.cap='(ref:caption-fig-svsd-S6)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_S6.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-S6) Posterior distributions for the first ten *dynamic* features ($X_{1}-X_{10}$; in rows) for the inverted categorical emotion model (left; different emotions as separate lines), the inverted valence model (middle; different levels as separate lines), and the inverted arousal model (right; different levels as separate lines). The dashed vertical lines represent the value chosen for the reconstructions (i.e., the midpoint of the 5% HDI interval). The drop at the edges of the posterior is an artifact induced by the kernel density estimation.

```{r fig-svsd-S7, fig.cap='(ref:caption-fig-svsd-S7)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_S7.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-S7) Posterior distributions for the first ten *static* features ($X_{1}-X_{10}$; in rows) for the inverted categorical emotion model (left; different emotions as separate lines), the inverted valence model (middle; different levels as separate lines), and the inverted arousal model (right; different levels as separate lines). The dashed vertical lines represent the value chosen for the reconstructions (i.e., the midpoint of the 5% HDI interval). The drop at the edges of the posterior is an artifact induced by the kernel density estimation.

```{r fig-svsd-S8, fig.cap='(ref:caption-fig-svsd-S8)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_S8.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-S8) Correlations between dynamic categorical emotion, valence, and arousal reconstructions. The different affective properties are delineated by the magenta borders. The green boxes highlight noteworthy correlations between high and low arousal and negative emotions (anger, disgust, and fear) and happiness/sadness, respectively. The yellow borders highlight the noteworthy correlations between positive and negative valence and happiness and negative emotions (anger, disgust, and fear), respectively.

```{r fig-svsd-S9, fig.cap='(ref:caption-fig-svsd-S9)', results='show'}
knitr::include_graphics("_bookdown_files/static-vs-dynamic-files/figures/figure_S9.png", auto_pdf = TRUE)
```

(ref:caption-fig-svsd-S9) Correlations between static categorical emotion, valence, and arousal reconstructions. The different affective properties are delineated by the magenta borders. The green boxes highlight noteworthy correlations between high and low arousal and negative emotions (anger, disgust, and fear) and happiness/sadness, respectively. The yellow borders highlight the noteworthy correlations between positive and negative valence and happiness and negative emotions (anger, disgust, and fear), respectively.

<!--chapter:end:14-static-vs-dynamic-supplement.Rmd-->

```{r setup-resources-supplement, include=FALSE}
knitr::opts_chunk$set(results = 'hide', echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(kableExtra)
```

# Data, code, software and educational materials {#resources-supplement}

I value open science and transparency, so I published my code and data whenever possible. In Table \@ref(tab:tab-resources-chapters), all publicly available resources are listed per chapter.

```{r tab-resources-chapters, results='asis'}
data = read_csv('_bookdown_files/resources-files/table_1_data.csv')
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T, caption = 'Chapter resources') %>%
    kable_styling(full_width = T, font_size = 8) %>%
    column_spec(column = 1, width = "2.5em") %>%
    column_spec(column = 2, width = "5em") %>%
    column_spec(column = 3, width = "5em") %>%
    footnote(footnote_as_chunk = T, title_format = "italic", threeparttable = T, escape = F, 
             general = 'OpenNeuro repositories contain raw and preprocessed data from individual participants, while NeuroVault contains group-level aggregate data (e.g., statistical brain maps from group-level analyses).')
```

As part of my PhD, I also (co-)developed several courses, which I made publicly accessible. These course materials are listed in Table \@ref(tab:tab-resources-teaching).

```{r tab-resources-teaching, results='asis'}
data = read_csv('_bookdown_files/resources-files/table_2_data.csv')
options(knitr.kable.NA = '')
kbl(data, booktabs = T, longtable = T, caption = 'Teaching resources') %>%
    kable_styling(full_width = T, font_size = 8)
```

<!--chapter:end:15-resources-supplement.Rmd-->

\backmatter
# Bibliography {-}
```{=latex}
\markboth{\MakeUppercase{Bibliography}}{} % have to explicitly state what to put in the heading (bug in bookdown?)
%format the references so they have a hanging indent. Remove these (and the \endgroup command) if you want regular indentation.
\begingroup
\hspace{\parindent}
\setlength{\parindent}{-0.25in}
\setlength{\leftskip}{0.25in}
\setlength{\parskip}{0pt}
```

<div id="refs"></div>

\endgroup

<!--chapter:end:16-references.Rmd-->

---
output:
  pdf_document: default
  html_document: default
---
# Contributions to the chapters {-}
\chaptermark{Contributions to chapters}
\setlength{\parindent}{0pt}
\small

_The contributions below were specified according to the_ CRediT _system_ [Contributor Roles Taxonomy; <https://www.casrai.org/credit.html>; @brand2015beyond].

---

**Chapter 2**, published as:

Oosterwijk, S.\*, Snoek, L.\*, Rotteveel, M., Barrett, L. F., & Scholte, H. S. (2017). Shared states: using MVPA to test neural overlap between self-focused emotion imagery and other-focused emotion understanding. *Social cognitive and affective neuroscience, 12*(7), 1025-1035.

S.O. developed the concept of the study. S.O., L.S., and H.S.S. developed the study design. L.S. and S.O. acquired the data. L.S. and S.O. analyzed the data and wrote the analysis code. S.O., L.S., and H.S.S. wrote the manuscript. M.R. and L.F.B. provided feedback on the first draft of the manuscript.

The authors would like to thank David Amodio for his helpful comments on a previous draft of this manuscript. 

**Chapter 3**, published as:

Snoek, L.\*, Miletić, S.\*, & Scholte, H.S. (2019). How to control for confounds in decoding analyses of neuroimaging data. _NeuroImage_, 184, 741-760.

L.S. and S.M. were responsible for the conceptualization, formal analysis, and development of methods. L.S., S.M., and H.S.S. wrote the manuscript. H.S.S. supervised the study.

**Chapter 4**, published as:

Snoek, L., van der Miesen, M.M., Beemsterboer, T., van der Leij, A., Eigenhuis, A., & Scholte, H.S. (2021). The Amsterdam Open MRI Collection, a set of multimodal MRI datasets for individual difference analyses. _Nature Scientific Data, 8_, 85.

L.S. curated the datasets, did visual quality control, preprocessed and analyzed the data, and wrote the article. M.v.d.M. did visual quality control, analyzed the data, and wrote the article. T.B. designed the data acquisition protocol of PIOP1 and PIOP2, was responsible for subject recruitment of PIOP1 and PIOP2, collected the data, and did visual quality control for PIOP1 and PIOP2. A.v.d.L. designed the data acquisition protocol, collected data, and did visual quality control for ID1000. A.E. designed and implemented the questionnaires in ID1000, PIOP1 and PIOP2 and managed questionnaire data from ID1000. H.S.S. was principal investigator of the ID1000, PIOP1, and PIOP2 studies, designed the data acquisition protocol of PIOP1, PIOP2, and ID1000, and wrote the article.

We thank all research assistants and students who helped collecting the data of the three projects, Jasper Wijnen and Marco Teunisse for advice and guidance with respect to anonymization and GDPR-related concerns, Jos Bloemers, Sennay Ghebreab, Adriaan Tuiten, Joram van Driel, Christian Olivers, Ilja Sligte, Sara Jahfari, Guido van Wingen, and Suzanne Oosterwijk for help with designing the paradigms, Marcus Spaan for technical support, and Franklin Feingold and Joe Wexler for help with uploading the datasets to OpenNeuro.

**Chapter 5**, published as:

Oosterwijk, S., Snoek, L., Tekoppele, J., Engelbert, L. H., & Scholte, H. S. (2020). Choosing to view morbid information involves reward circuitry. *Scientific reports, 10*(1), 1-13.

S.O., L.S., J.T., L.E. and H.S. developed the concept of the study, including the study design. S.O., L.S., J.T. and L.E. contributed to stimulus selection and programming. J.T. and L.E. collected the data. All authors contributed to the preparation of the preregistered analysis protocol and the data-analysis. S.O., L.S. and J.T. wrote the manuscript.

**Chapter 6**, submitted as:

Snoek, L., Jack, R., Schyns, P., Garrod, O., Mittenbühler, M., Scholte, H.S., & Oosterwijk, S. (submitted). Evaluating the universality of action unit based theories of categorical emotions. Submitted to *Nature Human Behavior*.

L.S., R.J., P.S., M.M., H.S.S., and S.O. were responsible for the conceptualization of the study. L.S., O.G., and M.M. developed the methods and implemented the formal analyses. All authors wrote the article.

**Chapter 7**, manuscript in preparation:

Snoek., L, Mittenbühler, M., Jack, R., Schyns, P., Fischer, A., Scholte, H.S., & Oosterwijk, S. (in prep.). Affective face perception integrates both static and dynamic information.

L.S., S.O., A.F., and H.S.S. were responsible for the conceptualization of the study. L.S. and M.M. developed the methods and implemented the formal analyses. All authors wrote the manuscript.

We thank Maite van der Miesen and Sjoerd Evelo for their help with data acquisition and Steven Miletić for helpful discussions regarding the Bayesian multivariate reverse correlation analyses.

\* Shared first authorship

<!--chapter:end:17-contributions.Rmd-->

# List of other publications {-}
\chaptermark{List of other publications}

van der Maas, H.L.J., **Snoek, L.**, & Stevenson, C. (2021). How much intelligence is there in artificial intelligence? A 2020 update. _Intelligence, 87_, 101548.\newline

Hoogeveen, S., **Snoek, L.**, & Van Elk, M. (2020). Religious belief and cognitive conflict sensitivity: A preregistered fMRI study. _Cortex, 129_, 247--265.\newline

van Elk, M., & **Snoek, L.** (2020). The relationship between individual differences in gray matter volume and religiosity and mystical experiences: A preregistered voxel‐based morphometry study. _European Journal of Neuroscience, 51_(3), 850--865.\newline

Van Mourik, T., **Snoek, L.**, Knapen, T., & Norris, D. G. (2018). Porcupine: a visual pipeline tool for neuroimaging analysis. _PLoS computational biology, 14_(5), e1006064.\newline

\normalsize
\setlength{\parindent}{1.5em}

<!--chapter:end:18-publications.Rmd-->

# Nederlandse samenvatting (Summary in Dutch) {-}
\chaptermark{Summary in Dutch}

::: {lang=nl}

_Het belang van voorspellen: onderzoek naar de psyche en het brein in het tijdperk van machine learning_

\bigskip
<br>

The summary goes here.

:::

<!--chapter:end:19-summary-Dutch.Rmd-->

# Acknowledgments {-}
\chaptermark{Acknowledgments}

* Steven, Suzanne
* Tomas, Agneta, Han
* Lab (Jessica, Lynn, Noor)
* Kamer (incl. Leon)
* Daniel
* Steven M.
* Lesgeven: Noor, Claire, Han, Jessica, studenten
* Interns (Cas, Andreas, Maite, Max, Sjoerd, Jurriaan, Lara)
* Midas & Anne, mam
* Pap
* Pia

<!--chapter:end:20-acknowledgments.Rmd-->

